<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nipun Batra">
<meta name="dcterms.date" content="2023-04-04">
<meta name="description" content="KNN Movie Recommendation">

<title>ES654 - KNN Movie Recommendation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ES654</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../grading.html">
 <span class="menu-text">Grading Policy</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../faq.html">
 <span class="menu-text">FAQs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../schedule.html">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../quizzes.html">
 <span class="menu-text">Quizzes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notebooks/index.html">
 <span class="menu-text">Notebooks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://nipunbatra.github.io">
 <span class="menu-text">Instructor Homepage</span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">KNN Movie Recommendation</h1>
</div>

<div>
  <div class="description">
    KNN Movie Recommendation
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nipun Batra </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 4, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.figure_format <span class="op">=</span> <span class="st">'retina'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate some toy user and movie data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of users</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>n_users <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of movies</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>n_movies <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of ratings</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>n_ratings <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random user ids</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>user_ids <span class="op">=</span> np.random.randint(<span class="dv">0</span>, n_users, n_ratings)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random movie ids</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>movie_ids <span class="op">=</span> np.random.randint(<span class="dv">0</span>, n_movies, n_ratings)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random ratings</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">6</span>, n_ratings)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe with the data</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'user_id'</span>: user_ids, <span class="st">'movie_id'</span>: movie_ids, <span class="st">'rating'</span>: ratings})</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># We should not have any duplicate ratings for the same user and movie</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop any rows that have duplicate user_id and movie_id pairs</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop_duplicates([<span class="st">'user_id'</span>, <span class="st">'movie_id'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>user_id</th>
      <th>movie_id</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>65</td>
      <td>6</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>38</td>
      <td>9</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>51</td>
      <td>6</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>49</td>
      <td>6</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>30</td>
      <td>9</td>
      <td>2</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>982</th>
      <td>6</td>
      <td>4</td>
      <td>4</td>
    </tr>
    <tr>
      <th>988</th>
      <td>9</td>
      <td>3</td>
      <td>5</td>
    </tr>
    <tr>
      <th>993</th>
      <td>92</td>
      <td>7</td>
      <td>4</td>
    </tr>
    <tr>
      <th>996</th>
      <td>91</td>
      <td>8</td>
      <td>4</td>
    </tr>
    <tr>
      <th>997</th>
      <td>79</td>
      <td>9</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
<p>622 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a user-item matrix</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> df.pivot(index<span class="op">=</span><span class="st">'user_id'</span>, columns<span class="op">=</span><span class="st">'movie_id'</span>, values<span class="op">=</span><span class="st">'rating'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>movie_id</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>user_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>2.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>98</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>99</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in the missing values with zeros</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> A.fillna(<span class="dv">0</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>movie_id</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>user_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>2.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>98</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cosine similarity between U1 and U2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># User 1</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>u1 <span class="op">=</span> A.loc[<span class="dv">0</span>]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># User 2</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>u2 <span class="op">=</span> A.loc[<span class="dv">1</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the dot product</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>dot <span class="op">=</span> np.dot(u1, u2)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the L2 norm</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>norm_u1 <span class="op">=</span> np.linalg.norm(u1)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>norm_u2 <span class="op">=</span> np.linalg.norm(u2)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the cosine similarity</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>cos_sim <span class="op">=</span> dot <span class="op">/</span> (norm_u1 <span class="op">*</span> norm_u2)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>cos_sim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>0.41403933560541256</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the cosine similarity between users</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>sim_matrix <span class="op">=</span> cosine_similarity(A)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(sim_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>90</th>
      <th>91</th>
      <th>92</th>
      <th>93</th>
      <th>94</th>
      <th>95</th>
      <th>96</th>
      <th>97</th>
      <th>98</th>
      <th>99</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.000000</td>
      <td>0.414039</td>
      <td>0.444165</td>
      <td>0.506370</td>
      <td>0.242061</td>
      <td>0.726184</td>
      <td>0.250490</td>
      <td>0.466156</td>
      <td>0.584523</td>
      <td>0.577540</td>
      <td>...</td>
      <td>0.517115</td>
      <td>0.530742</td>
      <td>0.793416</td>
      <td>0.661635</td>
      <td>0.715626</td>
      <td>0.480384</td>
      <td>0.232737</td>
      <td>0.525499</td>
      <td>0.473365</td>
      <td>0.790569</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.414039</td>
      <td>1.000000</td>
      <td>0.668734</td>
      <td>0.655178</td>
      <td>0.751672</td>
      <td>0.217150</td>
      <td>0.453743</td>
      <td>0.769420</td>
      <td>0.309898</td>
      <td>0.475183</td>
      <td>...</td>
      <td>0.408491</td>
      <td>0.489979</td>
      <td>0.410632</td>
      <td>0.283965</td>
      <td>0.527068</td>
      <td>0.215473</td>
      <td>0.463281</td>
      <td>0.245652</td>
      <td>0.579066</td>
      <td>0.054554</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.444165</td>
      <td>0.668734</td>
      <td>1.000000</td>
      <td>0.572503</td>
      <td>0.690704</td>
      <td>0.612511</td>
      <td>0.859727</td>
      <td>0.763085</td>
      <td>0.598691</td>
      <td>0.693629</td>
      <td>...</td>
      <td>0.571463</td>
      <td>0.532870</td>
      <td>0.507253</td>
      <td>0.456125</td>
      <td>0.566807</td>
      <td>0.711233</td>
      <td>0.563857</td>
      <td>0.301172</td>
      <td>0.886186</td>
      <td>0.255377</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.506370</td>
      <td>0.655178</td>
      <td>0.572503</td>
      <td>1.000000</td>
      <td>0.759950</td>
      <td>0.245145</td>
      <td>0.570782</td>
      <td>0.593308</td>
      <td>0.541435</td>
      <td>0.314945</td>
      <td>...</td>
      <td>0.144707</td>
      <td>0.196116</td>
      <td>0.502202</td>
      <td>0.539319</td>
      <td>0.627182</td>
      <td>0.291903</td>
      <td>0.353553</td>
      <td>0.334767</td>
      <td>0.588348</td>
      <td>0.320256</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.242061</td>
      <td>0.751672</td>
      <td>0.690704</td>
      <td>0.759950</td>
      <td>1.000000</td>
      <td>0.171875</td>
      <td>0.636656</td>
      <td>0.536745</td>
      <td>0.455530</td>
      <td>0.286770</td>
      <td>...</td>
      <td>0.105409</td>
      <td>0.361111</td>
      <td>0.464134</td>
      <td>0.406250</td>
      <td>0.626277</td>
      <td>0.310087</td>
      <td>0.346688</td>
      <td>0.147720</td>
      <td>0.708333</td>
      <td>0.102062</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>0.480384</td>
      <td>0.215473</td>
      <td>0.711233</td>
      <td>0.291903</td>
      <td>0.310087</td>
      <td>0.589165</td>
      <td>0.481325</td>
      <td>0.447868</td>
      <td>0.630078</td>
      <td>0.469516</td>
      <td>...</td>
      <td>0.496828</td>
      <td>0.385886</td>
      <td>0.571717</td>
      <td>0.496139</td>
      <td>0.634663</td>
      <td>1.000000</td>
      <td>0.378412</td>
      <td>0.390877</td>
      <td>0.620174</td>
      <td>0.506370</td>
    </tr>
    <tr>
      <th>96</th>
      <td>0.232737</td>
      <td>0.463281</td>
      <td>0.563857</td>
      <td>0.353553</td>
      <td>0.346688</td>
      <td>0.346688</td>
      <td>0.437237</td>
      <td>0.798465</td>
      <td>0.658506</td>
      <td>0.334050</td>
      <td>...</td>
      <td>0.657794</td>
      <td>0.724192</td>
      <td>0.266333</td>
      <td>0.017334</td>
      <td>0.546964</td>
      <td>0.378412</td>
      <td>1.000000</td>
      <td>0.637312</td>
      <td>0.485363</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>97</th>
      <td>0.525499</td>
      <td>0.245652</td>
      <td>0.301172</td>
      <td>0.334767</td>
      <td>0.147720</td>
      <td>0.640119</td>
      <td>0.318465</td>
      <td>0.627896</td>
      <td>0.754019</td>
      <td>0.406671</td>
      <td>...</td>
      <td>0.498273</td>
      <td>0.641943</td>
      <td>0.504362</td>
      <td>0.393919</td>
      <td>0.629879</td>
      <td>0.390877</td>
      <td>0.637312</td>
      <td>1.000000</td>
      <td>0.415804</td>
      <td>0.428845</td>
    </tr>
    <tr>
      <th>98</th>
      <td>0.473365</td>
      <td>0.579066</td>
      <td>0.886186</td>
      <td>0.588348</td>
      <td>0.708333</td>
      <td>0.645833</td>
      <td>0.889297</td>
      <td>0.748190</td>
      <td>0.533752</td>
      <td>0.669129</td>
      <td>...</td>
      <td>0.579751</td>
      <td>0.648148</td>
      <td>0.682863</td>
      <td>0.625000</td>
      <td>0.604069</td>
      <td>0.620174</td>
      <td>0.485363</td>
      <td>0.415804</td>
      <td>1.000000</td>
      <td>0.340207</td>
    </tr>
    <tr>
      <th>99</th>
      <td>0.790569</td>
      <td>0.054554</td>
      <td>0.255377</td>
      <td>0.320256</td>
      <td>0.102062</td>
      <td>0.714435</td>
      <td>0.198030</td>
      <td>0.079682</td>
      <td>0.495918</td>
      <td>0.608781</td>
      <td>...</td>
      <td>0.430331</td>
      <td>0.272166</td>
      <td>0.836333</td>
      <td>0.867528</td>
      <td>0.522233</td>
      <td>0.506370</td>
      <td>0.000000</td>
      <td>0.428845</td>
      <td>0.340207</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 100 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap(sim_matrix, cmap<span class="op">=</span><span class="st">'Greys'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="movie-recommendation-knn_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the most similar users to user u </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> k_nearest_neighbors(A, u, k):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find the k nearest neighbors for user u"""</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the index of the user in the matrix</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    u_index <span class="op">=</span> A.index.get_loc(u)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the similarity between the user and all other users</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    sim_matrix <span class="op">=</span> cosine_similarity(A)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the k most similar users</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    k_nearest <span class="op">=</span> np.argsort(sim_matrix[u_index])[::<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>:k<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the user ids</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A.index[k_nearest]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>k_nearest_neighbors(A, <span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Int64Index([61, 68, 66, 14, 92], dtype='int64', name='user_id')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show matrix of movie ratings for u and k nearest neighbors</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_neighbors(A, u, k):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Show the movie ratings for user u and k nearest neighbors"""</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the user ids of the k nearest neighbors</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> k_nearest_neighbors(A, u, k)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the movie ratings for user u and the k nearest neighbors</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> A.loc[[u] <span class="op">+</span> <span class="bu">list</span>(neighbors)]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the dataframe</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>show_neighbors(A, <span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>movie_id</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>user_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>61</th>
      <td>2.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>68</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>66</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>3.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>92</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rating for user u for movie 0 is: (4.0 + 3.0) / 2 = 3.5 (Discard 0s)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict_rating(A, u, m, k<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Predict the rating for user u for movie m"""</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the user ids of the k nearest neighbors</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> k_nearest_neighbors(A, u, k)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the movie ratings for user u and the k nearest neighbors</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> A.loc[[u] <span class="op">+</span> <span class="bu">list</span>(neighbors)]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the ratings for movie m</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    ratings <span class="op">=</span> df[m]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the mean of the ratings</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> ratings[<span class="dv">1</span>:][ratings <span class="op">!=</span> <span class="dv">0</span>].mean()</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the mean</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>predict_rating(A, <span class="dv">0</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>3.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now working with real data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">"mov-rec.xlsx"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Timestamp</th>
      <th>Your name</th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2023-04-11 10:58:44.990</td>
      <td>Nipun</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2023-04-11 10:59:49.617</td>
      <td>Gautam Vashishtha</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-04-11 11:12:44.033</td>
      <td>Eshan Gujarathi</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2023-04-11 11:13:48.674</td>
      <td>Sai Krishna Avula</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2023-04-11 11:13:55.658</td>
      <td>Ankit Yadav</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Discard the timestamp column</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'Timestamp'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the "Your Name" column the index</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.set_index(<span class="st">'Your name'</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
    <tr>
      <th>Your name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Nipun</th>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Gautam Vashishtha</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Eshan Gujarathi</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Sai Krishna Avula</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Ankit Yadav</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Dhruv</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Saatvik Rao</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Zeel B Patel</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Neel</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Sachin Jalan</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Ayush Shrivastava</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>....</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Hari Hara Sudhan</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Etikikota Hrushikesh</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Chirag</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Aaryan Darad</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Hetvi Patel</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Kalash Kankaria</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Rachit Verma</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>shriraj</th>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Bhavini Korthi</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Hitarth Gandhi</th>
      <td>3.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Radhika Joglekar</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Medhansh Singh</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Arun Mani</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Satyam</th>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Karan Kumar</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>R Yeeshu Dhurandhar</th>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Satyam Gupta</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>rushali</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>shridhar</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Tanvi Jain</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Manish Prabhubhai Salvi</th>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Varun Barala</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Kevin Shah</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Inderjeet</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Gangaram Siddam</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Aditi</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Madhuri Awachar</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Anupam</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Jinay</th>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Shrutimoy</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Aadesh Desai</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Dhairya</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Rahul C</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>Index(['Nipun', 'Gautam Vashishtha', 'Eshan Gujarathi', 'Sai Krishna Avula',
       'Ankit Yadav ', 'Dhruv', 'Saatvik Rao ', 'Zeel B Patel', 'Neel ',
       'Sachin Jalan ', 'Ayush Shrivastava', '....', 'Hari Hara Sudhan',
       'Etikikota Hrushikesh', 'Chirag', 'Aaryan Darad', 'Hetvi Patel',
       'Kalash Kankaria', 'Rachit Verma', 'shriraj', 'Bhavini Korthi ',
       'Hitarth Gandhi ', 'Radhika Joglekar ', 'Medhansh Singh', 'Arun Mani',
       'Satyam ', 'Karan Kumar ', 'R Yeeshu Dhurandhar', 'Satyam Gupta',
       'rushali', 'shridhar', 'Tanvi Jain ', 'Manish Prabhubhai Salvi ',
       'Varun Barala', 'Kevin Shah ', 'Inderjeet', 'Gangaram Siddam ', 'Aditi',
       'Madhuri Awachar', 'Anupam', 'Jinay', 'Shrutimoy', 'Aadesh Desai',
       'Dhairya', 'Rahul C'],
      dtype='object', name='Your name')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get index for user and movie</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>user <span class="op">=</span> <span class="st">'Dhruv'</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(user <span class="kw">in</span> df.index)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the movie ratings for user</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">#user_ratings = df.loc[user]</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">#user_ratings</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df_copy <span class="op">=</span> df.copy()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>df_copy.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>show_neighbors(df_copy, user, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
    <tr>
      <th>Your name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dhruv</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>shriraj</th>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Jinay</th>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Gautam Vashishtha</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Saatvik Rao</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Medhansh Singh</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the rating for user u for movie m</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>predict_rating(df_copy, user, <span class="st">'The Dark Knight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>5.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>predict_rating(df_copy, user, <span class="st">'Sholay'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>3.4</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic Matrix Factorization (without missing values)</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># D is a matrix of size (n_users, n_movies) randomly generated values between 1 and 5</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> torch.randint(<span class="dv">1</span>, <span class="dv">6</span>, (n_users, n_movies), dtype<span class="op">=</span>torch.<span class="bu">float</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>D</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>tensor([[2., 1., 1., 5., 4., 1., 4., 3., 1., 2.],
        [2., 3., 5., 2., 1., 2., 3., 2., 3., 3.],
        [1., 3., 2., 4., 3., 1., 5., 4., 3., 2.],
        [5., 3., 1., 1., 3., 1., 1., 1., 2., 4.],
        [5., 3., 1., 4., 4., 3., 2., 3., 3., 2.],
        [2., 3., 4., 1., 2., 2., 2., 2., 2., 1.],
        [2., 3., 4., 1., 3., 5., 3., 4., 3., 4.],
        [3., 4., 2., 3., 4., 3., 3., 4., 4., 4.],
        [3., 5., 5., 2., 2., 1., 2., 5., 1., 2.],
        [1., 5., 2., 1., 3., 1., 2., 3., 5., 2.],
        [3., 1., 3., 1., 3., 4., 4., 3., 5., 1.],
        [1., 3., 5., 5., 3., 2., 5., 2., 3., 1.],
        [2., 5., 3., 2., 2., 4., 1., 5., 2., 5.],
        [1., 5., 1., 5., 1., 2., 4., 5., 5., 1.],
        [2., 4., 2., 1., 1., 4., 3., 5., 2., 4.],
        [5., 1., 1., 2., 4., 4., 4., 5., 4., 1.],
        [5., 5., 5., 2., 4., 3., 5., 5., 2., 2.],
        [2., 1., 1., 5., 3., 4., 1., 4., 4., 4.],
        [4., 1., 3., 4., 5., 5., 1., 4., 2., 4.],
        [5., 3., 2., 3., 5., 2., 3., 4., 1., 5.],
        [5., 2., 2., 1., 4., 1., 1., 5., 4., 4.],
        [5., 2., 1., 2., 5., 4., 5., 5., 2., 4.],
        [1., 4., 1., 5., 1., 2., 2., 2., 4., 2.],
        [1., 1., 1., 3., 2., 4., 4., 5., 3., 5.],
        [1., 5., 5., 4., 4., 5., 3., 5., 2., 1.],
        [2., 2., 1., 4., 4., 1., 1., 5., 4., 5.],
        [5., 4., 3., 2., 2., 3., 1., 1., 3., 4.],
        [3., 1., 5., 5., 5., 5., 2., 4., 3., 5.],
        [2., 3., 2., 5., 1., 2., 4., 5., 2., 4.],
        [2., 4., 4., 2., 2., 2., 5., 5., 4., 3.],
        [1., 1., 2., 1., 4., 5., 3., 4., 1., 3.],
        [4., 4., 1., 3., 4., 5., 5., 1., 1., 4.],
        [4., 4., 2., 3., 3., 3., 2., 4., 4., 5.],
        [3., 5., 2., 1., 5., 1., 2., 4., 2., 2.],
        [3., 3., 2., 1., 4., 1., 2., 3., 3., 2.],
        [2., 4., 4., 1., 2., 1., 2., 4., 4., 2.],
        [2., 4., 5., 4., 5., 4., 5., 4., 5., 1.],
        [2., 3., 1., 5., 5., 3., 5., 3., 5., 5.],
        [1., 4., 4., 3., 4., 4., 3., 5., 5., 3.],
        [4., 5., 2., 4., 5., 3., 4., 5., 2., 2.],
        [5., 3., 4., 3., 3., 5., 4., 1., 5., 2.],
        [1., 2., 2., 5., 3., 5., 3., 5., 3., 5.],
        [4., 4., 4., 2., 1., 2., 5., 3., 5., 3.],
        [2., 1., 5., 4., 2., 4., 3., 5., 2., 1.],
        [3., 2., 3., 4., 5., 1., 5., 5., 1., 5.],
        [2., 3., 1., 4., 1., 2., 5., 2., 2., 2.],
        [1., 1., 4., 1., 1., 5., 2., 4., 5., 3.],
        [4., 4., 1., 5., 4., 2., 4., 4., 2., 1.],
        [1., 1., 2., 5., 1., 1., 2., 2., 4., 4.],
        [4., 3., 2., 3., 4., 4., 5., 2., 2., 4.],
        [4., 2., 2., 4., 2., 3., 1., 1., 4., 1.],
        [5., 5., 3., 2., 4., 2., 1., 4., 1., 2.],
        [1., 1., 1., 2., 4., 2., 2., 2., 2., 3.],
        [3., 4., 5., 2., 5., 2., 3., 5., 2., 2.],
        [3., 4., 4., 5., 4., 1., 3., 3., 3., 1.],
        [3., 2., 3., 1., 2., 4., 5., 1., 2., 1.],
        [5., 3., 1., 4., 3., 1., 2., 5., 2., 3.],
        [3., 3., 5., 4., 4., 3., 3., 4., 2., 5.],
        [4., 5., 5., 2., 3., 5., 4., 4., 5., 5.],
        [3., 4., 3., 2., 5., 2., 3., 2., 1., 1.],
        [3., 5., 3., 3., 4., 2., 1., 5., 2., 5.],
        [1., 5., 5., 3., 5., 3., 4., 4., 3., 1.],
        [5., 5., 1., 5., 5., 3., 2., 2., 3., 5.],
        [5., 4., 4., 3., 3., 5., 1., 3., 2., 5.],
        [3., 5., 4., 2., 5., 2., 5., 2., 4., 4.],
        [3., 5., 2., 3., 1., 4., 5., 2., 1., 3.],
        [2., 4., 5., 4., 3., 1., 2., 2., 3., 5.],
        [4., 4., 3., 4., 3., 4., 5., 5., 4., 2.],
        [2., 2., 4., 5., 4., 1., 3., 5., 5., 1.],
        [5., 5., 2., 2., 4., 5., 3., 1., 4., 5.],
        [3., 2., 1., 4., 2., 2., 1., 5., 3., 5.],
        [2., 5., 3., 5., 2., 3., 2., 1., 1., 3.],
        [3., 5., 5., 4., 4., 4., 2., 3., 3., 1.],
        [1., 4., 3., 5., 4., 4., 5., 1., 4., 1.],
        [5., 1., 5., 2., 3., 5., 2., 3., 4., 1.],
        [1., 1., 1., 5., 2., 5., 1., 3., 1., 2.],
        [5., 3., 4., 3., 5., 5., 2., 3., 4., 4.],
        [5., 5., 2., 4., 4., 2., 5., 5., 4., 3.],
        [1., 4., 2., 3., 3., 2., 5., 1., 3., 4.],
        [4., 2., 1., 2., 4., 2., 5., 5., 5., 5.],
        [5., 4., 1., 1., 5., 1., 5., 5., 5., 5.],
        [3., 2., 2., 3., 2., 3., 2., 4., 2., 3.],
        [1., 4., 2., 5., 5., 5., 5., 5., 1., 3.],
        [3., 3., 1., 5., 1., 2., 2., 1., 5., 3.],
        [1., 2., 2., 1., 2., 5., 5., 4., 2., 5.],
        [1., 1., 1., 3., 5., 2., 3., 5., 2., 1.],
        [2., 3., 4., 1., 1., 3., 3., 3., 3., 4.],
        [5., 1., 3., 2., 5., 3., 4., 1., 1., 5.],
        [3., 3., 5., 4., 2., 1., 2., 1., 5., 1.],
        [3., 5., 2., 2., 4., 2., 1., 4., 3., 4.],
        [1., 3., 1., 1., 3., 4., 5., 4., 4., 3.],
        [1., 1., 3., 1., 1., 3., 1., 2., 2., 3.],
        [5., 3., 1., 4., 5., 2., 3., 2., 4., 5.],
        [1., 4., 4., 2., 3., 3., 5., 2., 2., 2.],
        [3., 3., 1., 4., 4., 5., 5., 1., 2., 1.],
        [5., 4., 4., 4., 3., 3., 1., 2., 4., 5.],
        [4., 5., 1., 1., 2., 3., 1., 2., 2., 4.],
        [1., 4., 3., 3., 2., 4., 5., 2., 2., 4.],
        [5., 3., 1., 1., 5., 1., 4., 4., 2., 5.],
        [5., 4., 3., 2., 4., 5., 5., 4., 5., 4.]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>D.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>torch.Size([100, 10])</code></pre>
</div>
</div>
<p>Let us decompose D as AB. A is of shape (n, k) and B is of shape (k, n). We can write the above equation as: D = AB</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly initialize A and B</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> torch.randn(n_users, <span class="dv">2</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> torch.randn(n_movies, <span class="dv">2</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the loss</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> torch.norm(torch.mm(A, B.t()) <span class="op">-</span> D)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>tensor(115.5283, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(torch.mm(A, B.t()).detach().numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.081995</td>
      <td>1.438427</td>
      <td>2.290493</td>
      <td>0.678477</td>
      <td>-0.751512</td>
      <td>-1.425289</td>
      <td>-1.421520</td>
      <td>-0.599862</td>
      <td>0.559827</td>
      <td>-0.649635</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.649014</td>
      <td>-1.048254</td>
      <td>-1.410401</td>
      <td>-0.872375</td>
      <td>0.753041</td>
      <td>0.766629</td>
      <td>1.244575</td>
      <td>0.877273</td>
      <td>-0.183724</td>
      <td>0.715164</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-3.911201</td>
      <td>-0.465408</td>
      <td>0.965011</td>
      <td>-2.711042</td>
      <td>1.597091</td>
      <td>-1.332324</td>
      <td>1.835400</td>
      <td>3.095583</td>
      <td>1.297227</td>
      <td>1.803867</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.651612</td>
      <td>-0.904607</td>
      <td>-1.749287</td>
      <td>0.024314</td>
      <td>0.227534</td>
      <td>1.220988</td>
      <td>0.644997</td>
      <td>-0.147965</td>
      <td>-0.619670</td>
      <td>0.120069</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.750690</td>
      <td>-0.576467</td>
      <td>-1.701260</td>
      <td>0.872011</td>
      <td>-0.320449</td>
      <td>1.394634</td>
      <td>-0.061818</td>
      <td>-1.091748</td>
      <td>-0.903110</td>
      <td>-0.471348</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>1.303457</td>
      <td>-0.348241</td>
      <td>-1.135708</td>
      <td>0.684474</td>
      <td>-0.279277</td>
      <td>0.956007</td>
      <td>-0.124401</td>
      <td>-0.843165</td>
      <td>-0.639135</td>
      <td>-0.385608</td>
    </tr>
    <tr>
      <th>96</th>
      <td>-3.208896</td>
      <td>-0.879868</td>
      <td>-0.013779</td>
      <td>-2.440943</td>
      <td>1.560616</td>
      <td>-0.586501</td>
      <td>1.987955</td>
      <td>2.726220</td>
      <td>0.859660</td>
      <td>1.693238</td>
    </tr>
    <tr>
      <th>97</th>
      <td>0.145054</td>
      <td>-0.356799</td>
      <td>-0.640791</td>
      <td>-0.062217</td>
      <td>0.128766</td>
      <td>0.429899</td>
      <td>0.294044</td>
      <td>0.025261</td>
      <td>-0.201806</td>
      <td>0.093289</td>
    </tr>
    <tr>
      <th>98</th>
      <td>-3.767568</td>
      <td>-0.869430</td>
      <td>0.248466</td>
      <td>-2.794717</td>
      <td>1.750086</td>
      <td>-0.855047</td>
      <td>2.175662</td>
      <td>3.139588</td>
      <td>1.076558</td>
      <td>1.917962</td>
    </tr>
    <tr>
      <th>99</th>
      <td>-1.015485</td>
      <td>3.436308</td>
      <td>6.003857</td>
      <td>0.843901</td>
      <td>-1.373110</td>
      <td>-3.964185</td>
      <td>-2.967005</td>
      <td>-0.528251</td>
      <td>1.798390</td>
      <td>-1.054975</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(D)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>4.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>98</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimizer</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam([A, B], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the loss</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> torch.norm(torch.mm(A, B.t()) <span class="op">-</span> D)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Zero the gradients</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Backpropagate</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the parameters</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the loss</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>115.52832794189453
112.7713623046875
110.65110778808594
108.90686798095703
107.1790542602539
104.99609375
101.8652572631836
97.41974639892578
91.5863037109375
84.70346069335938
77.42243194580078
70.35626220703125
63.86996841430664
58.18073654174805
53.417049407958984
49.60642623901367
46.68671798706055
44.5410041809082
43.025020599365234
41.98737335205078
41.2883415222168
40.816036224365234
40.49069595336914
40.25889205932617
40.085994720458984
39.950340270996094
39.83889389038086
39.74393844604492
39.660831451416016
39.58662796020508
39.519351959228516
39.45756149291992
39.400169372558594
39.34630584716797
39.2952766418457
39.246498107910156
39.19949722290039
39.15385818481445
39.10924530029297
39.06536865234375
39.02199172973633
38.978912353515625
38.93598556518555
38.893089294433594
38.85015106201172
38.8071403503418
38.76405334472656
38.72092056274414
38.67781448364258
38.63483428955078
38.59209060668945
38.549720764160156
38.507877349853516
38.466712951660156
38.4263916015625
38.38705825805664
38.34885025024414
38.31189727783203
38.276309967041016
38.24217224121094
38.209556579589844
38.17851638793945
38.14907455444336
38.121238708496094
38.09501266479492
38.07037353515625
38.047279357910156
38.025699615478516
38.00558090209961
37.98686599731445
37.969486236572266
37.95338821411133
37.93849563598633
37.92474365234375
37.91205978393555
37.9003791809082
37.88964080810547
37.8797721862793
37.8707160949707
37.86241149902344
37.854801177978516
37.84783172607422
37.841461181640625
37.83563232421875
37.83030319213867
37.82543182373047
37.82098388671875
37.81692123413086
37.81321334838867
37.80983352661133
37.80674362182617
37.80392837524414
37.80135726928711
37.79901885986328
37.79688262939453
37.7949333190918
37.793155670166016
37.791542053222656
37.79006576538086
37.788726806640625</code></pre>
</div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(torch.mm(A, B.t()).detach().numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.272087</td>
      <td>2.567247</td>
      <td>2.169096</td>
      <td>2.363732</td>
      <td>2.594773</td>
      <td>2.349150</td>
      <td>2.525624</td>
      <td>2.665625</td>
      <td>2.355196</td>
      <td>2.397679</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.586249</td>
      <td>2.788023</td>
      <td>2.934170</td>
      <td>2.762144</td>
      <td>2.419219</td>
      <td>2.773133</td>
      <td>3.164435</td>
      <td>2.794207</td>
      <td>2.655946</td>
      <td>1.722759</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.761482</td>
      <td>3.091030</td>
      <td>3.251198</td>
      <td>3.061710</td>
      <td>2.683427</td>
      <td>3.073807</td>
      <td>3.506994</td>
      <td>3.098210</td>
      <td>2.944282</td>
      <td>1.912827</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.159266</td>
      <td>2.099523</td>
      <td>0.263199</td>
      <td>1.423531</td>
      <td>3.163138</td>
      <td>1.341559</td>
      <td>0.964538</td>
      <td>2.442814</td>
      <td>1.669656</td>
      <td>4.261670</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3.736264</td>
      <td>3.079406</td>
      <td>1.938160</td>
      <td>2.611440</td>
      <td>3.569788</td>
      <td>2.563177</td>
      <td>2.545827</td>
      <td>3.312877</td>
      <td>2.712392</td>
      <td>3.886777</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>4.293660</td>
      <td>3.536465</td>
      <td>2.223963</td>
      <td>2.998411</td>
      <td>4.100918</td>
      <td>2.942899</td>
      <td>2.922329</td>
      <td>3.804914</td>
      <td>3.114660</td>
      <td>4.466512</td>
    </tr>
    <tr>
      <th>96</th>
      <td>3.784583</td>
      <td>2.498028</td>
      <td>1.077427</td>
      <td>1.951512</td>
      <td>3.236830</td>
      <td>1.889419</td>
      <td>1.704584</td>
      <td>2.773510</td>
      <td>2.116307</td>
      <td>3.906579</td>
    </tr>
    <tr>
      <th>97</th>
      <td>1.936005</td>
      <td>3.259978</td>
      <td>3.377530</td>
      <td>3.211729</td>
      <td>2.865497</td>
      <td>3.222105</td>
      <td>3.661241</td>
      <td>3.276487</td>
      <td>3.096488</td>
      <td>2.095613</td>
    </tr>
    <tr>
      <th>98</th>
      <td>5.041747</td>
      <td>3.106278</td>
      <td>1.119416</td>
      <td>2.352365</td>
      <td>4.176830</td>
      <td>2.264935</td>
      <td>1.959050</td>
      <td>3.487175</td>
      <td>2.594204</td>
      <td>5.193403</td>
    </tr>
    <tr>
      <th>99</th>
      <td>4.144527</td>
      <td>4.298673</td>
      <td>3.408732</td>
      <td>3.882595</td>
      <td>4.498625</td>
      <td>3.847826</td>
      <td>4.066271</td>
      <td>4.502244</td>
      <td>3.905708</td>
      <td>4.354776</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(D)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>4.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>98</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> factorize(D, k):</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Factorize the matrix D into A and B"""</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly initialize A and B</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> torch.randn(D.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> torch.randn(D.shape[<span class="dv">1</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optimizer</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam([A, B], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> torch.norm(torch.mm(A, B.t()) <span class="op">-</span> D)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Zero the gradients</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Backpropagate</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the parameters</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A, B, loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]:</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    A, B, loss <span class="op">=</span> factorize(D, k)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(k, loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 41.75899124145508
2 38.171913146972656
3 34.42135238647461
4 31.025142669677734
5 27.342370986938477
6 23.161325454711914</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With missing values</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly replace some entries with NaN</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> torch.randint(<span class="dv">1</span>, <span class="dv">6</span>, (n_users, n_movies), dtype<span class="op">=</span>torch.<span class="bu">float</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>D[torch.rand(D.shape) <span class="op">&lt;</span> <span class="fl">0.5</span>] <span class="op">=</span> <span class="bu">float</span>(<span class="st">'nan'</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>D</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>tensor([[nan, nan, nan, nan, 1., 2., nan, nan, 5., nan],
        [4., 4., nan, nan, 5., nan, nan, 3., 2., nan],
        [2., 5., nan, nan, 3., 1., 5., nan, 5., nan],
        [nan, nan, 4., nan, nan, nan, nan, nan, nan, nan],
        [nan, nan, 1., nan, nan, 4., nan, nan, 4., nan],
        [nan, nan, 4., nan, nan, 5., 5., 5., 3., nan],
        [1., nan, nan, 1., 2., 3., nan, nan, nan, nan],
        [5., nan, 5., 2., nan, nan, nan, 3., 3., nan],
        [nan, nan, nan, 5., nan, nan, 2., 4., 3., 2.],
        [nan, nan, 1., nan, 5., 4., 1., nan, 4., 1.],
        [nan, 5., nan, 3., nan, 2., 5., 5., nan, 4.],
        [nan, 2., nan, 4., 4., nan, 4., 5., nan, 1.],
        [nan, 2., nan, nan, nan, 1., 1., 4., nan, nan],
        [nan, 5., nan, nan, nan, nan, nan, 2., 1., 3.],
        [nan, nan, 4., 2., 5., 2., 4., nan, nan, 5.],
        [5., 5., nan, nan, 1., nan, nan, 3., 1., nan],
        [nan, nan, nan, 5., 3., 3., nan, nan, 3., 5.],
        [1., nan, 5., 1., nan, 4., nan, nan, nan, nan],
        [5., nan, nan, 4., 3., nan, nan, 2., 1., nan],
        [5., 1., nan, 4., 4., 3., 2., 1., 3., nan],
        [1., nan, nan, 3., 1., nan, 1., 1., nan, nan],
        [1., 2., nan, nan, 3., nan, 1., 4., 1., 5.],
        [nan, nan, 4., nan, nan, nan, nan, nan, 1., nan],
        [nan, nan, 5., 4., nan, 2., nan, 3., 2., nan],
        [nan, nan, 5., 3., 1., 5., 1., 1., 2., 4.],
        [nan, 1., nan, nan, 4., nan, nan, nan, nan, 5.],
        [nan, 5., nan, nan, 5., 1., nan, 4., nan, nan],
        [2., 3., nan, 5., 4., nan, 3., 1., 3., 5.],
        [1., nan, 1., nan, 3., 5., nan, 4., nan, nan],
        [nan, nan, 5., 2., 2., nan, nan, 4., nan, 3.],
        [nan, 2., nan, nan, nan, 4., 1., nan, 2., nan],
        [2., nan, 3., 4., 2., 3., nan, nan, nan, 2.],
        [nan, 2., 3., nan, 3., 1., nan, nan, nan, nan],
        [nan, 2., 5., nan, 2., nan, nan, 1., nan, nan],
        [2., 5., nan, 2., 4., 3., nan, 1., nan, nan],
        [4., 4., nan, nan, nan, nan, nan, 2., nan, nan],
        [3., 5., 3., 2., nan, 5., nan, nan, 3., nan],
        [5., nan, 3., 2., nan, 1., 4., 4., nan, 2.],
        [nan, 2., 4., 2., nan, nan, nan, 4., nan, nan],
        [nan, 2., nan, nan, nan, 4., 1., nan, 1., nan],
        [1., nan, 2., nan, nan, nan, 5., nan, 2., nan],
        [nan, 1., nan, nan, nan, nan, 1., 2., nan, nan],
        [4., 5., nan, 1., nan, 2., nan, 1., 4., 3.],
        [nan, nan, nan, nan, nan, 5., 4., 1., 5., nan],
        [nan, nan, nan, 4., 3., 2., nan, nan, 3., nan],
        [4., nan, nan, nan, 3., 1., 3., nan, nan, nan],
        [nan, nan, nan, nan, nan, 3., 4., nan, nan, nan],
        [nan, 4., 5., nan, nan, 3., nan, nan, 3., 2.],
        [2., nan, nan, 4., 4., 2., nan, nan, 2., nan],
        [nan, nan, nan, nan, nan, nan, 2., nan, nan, 5.],
        [nan, 1., nan, nan, nan, nan, 5., nan, nan, 5.],
        [3., 1., 4., 3., nan, nan, 1., 3., nan, nan],
        [4., nan, nan, 2., nan, nan, nan, nan, 2., 2.],
        [nan, nan, nan, 5., nan, nan, 3., 5., 2., nan],
        [3., 3., 2., nan, nan, nan, nan, nan, nan, 1.],
        [nan, 1., nan, nan, 4., 2., 1., nan, nan, nan],
        [nan, 4., 5., nan, nan, nan, nan, 4., nan, 3.],
        [nan, nan, 2., 1., 3., nan, nan, 4., nan, nan],
        [nan, 5., nan, nan, 1., 1., nan, 3., 1., 3.],
        [4., 3., nan, 4., nan, nan, 3., nan, 1., 3.],
        [nan, nan, nan, nan, 5., 3., 5., nan, 4., 5.],
        [2., nan, 2., nan, nan, 2., 1., 3., nan, nan],
        [nan, 2., 1., nan, 3., nan, 1., 2., 2., nan],
        [nan, nan, 1., 5., nan, nan, nan, nan, nan, 3.],
        [5., 5., 3., 2., nan, nan, 2., nan, nan, 2.],
        [nan, nan, 5., nan, nan, nan, nan, nan, 3., 3.],
        [2., nan, 5., 3., nan, 5., nan, 2., nan, nan],
        [1., 2., nan, nan, nan, nan, nan, 3., 2., nan],
        [nan, 3., nan, nan, 2., nan, 1., nan, nan, 4.],
        [3., nan, nan, 2., 2., nan, nan, nan, 3., 4.],
        [2., nan, 3., 3., nan, 1., 4., 3., nan, 1.],
        [nan, 5., 3., nan, nan, 5., nan, 3., 5., nan],
        [nan, 2., 5., 3., nan, 5., 4., 4., 1., nan],
        [nan, nan, nan, nan, 4., 4., nan, nan, nan, nan],
        [1., 3., nan, nan, 4., nan, nan, 1., 5., 2.],
        [4., 1., 1., nan, nan, 5., 4., nan, nan, 2.],
        [2., 5., nan, nan, nan, nan, nan, 4., 1., nan],
        [nan, nan, nan, nan, nan, 4., nan, 5., nan, 1.],
        [1., 3., 3., 2., nan, 2., nan, nan, nan, 1.],
        [nan, nan, 5., nan, nan, nan, nan, 3., 3., 2.],
        [5., nan, nan, nan, 2., nan, nan, 4., nan, 5.],
        [nan, 2., nan, nan, nan, 2., nan, nan, 1., nan],
        [nan, nan, 3., nan, 5., nan, 4., nan, nan, 1.],
        [nan, 1., 1., 2., nan, nan, 1., 1., nan, 2.],
        [nan, nan, nan, nan, 4., 3., 5., 3., nan, nan],
        [nan, nan, 4., 2., 2., nan, nan, nan, nan, 5.],
        [nan, nan, nan, nan, nan, nan, nan, nan, 1., nan],
        [nan, 1., nan, 3., nan, nan, nan, nan, nan, 2.],
        [3., nan, 5., 4., 3., nan, nan, nan, 1., nan],
        [nan, nan, nan, nan, nan, 4., nan, nan, nan, nan],
        [nan, 2., 4., 3., nan, 5., nan, nan, 4., 3.],
        [1., 5., 3., nan, nan, nan, 1., 5., nan, nan],
        [3., nan, 2., 5., nan, 2., 5., 5., 1., 1.],
        [1., 4., nan, nan, nan, 2., 1., 5., nan, nan],
        [nan, nan, nan, nan, 4., nan, 3., nan, nan, nan],
        [nan, nan, 5., nan, nan, 5., 1., nan, 3., nan],
        [nan, nan, nan, 4., nan, 5., 1., nan, 5., nan],
        [nan, nan, 1., 5., nan, nan, 4., 1., nan, 5.],
        [4., nan, 1., 4., 4., nan, 4., nan, 3., nan],
        [2., nan, nan, 4., nan, nan, 2., 5., nan, 1.]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>A, B, loss <span class="op">=</span> factorize(D, <span class="dv">2</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>tensor(nan, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> <span class="op">~</span>torch.isnan(D)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>mask</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>tensor([[False, False, False, False,  True,  True, False, False,  True, False],
        [ True,  True, False, False,  True, False, False,  True,  True, False],
        [ True,  True, False, False,  True,  True,  True, False,  True, False],
        [False, False,  True, False, False, False, False, False, False, False],
        [False, False,  True, False, False,  True, False, False,  True, False],
        [False, False,  True, False, False,  True,  True,  True,  True, False],
        [ True, False, False,  True,  True,  True, False, False, False, False],
        [ True, False,  True,  True, False, False, False,  True,  True, False],
        [False, False, False,  True, False, False,  True,  True,  True,  True],
        [False, False,  True, False,  True,  True,  True, False,  True,  True],
        [False,  True, False,  True, False,  True,  True,  True, False,  True],
        [False,  True, False,  True,  True, False,  True,  True, False,  True],
        [False,  True, False, False, False,  True,  True,  True, False, False],
        [False,  True, False, False, False, False, False,  True,  True,  True],
        [False, False,  True,  True,  True,  True,  True, False, False,  True],
        [ True,  True, False, False,  True, False, False,  True,  True, False],
        [False, False, False,  True,  True,  True, False, False,  True,  True],
        [ True, False,  True,  True, False,  True, False, False, False, False],
        [ True, False, False,  True,  True, False, False,  True,  True, False],
        [ True,  True, False,  True,  True,  True,  True,  True,  True, False],
        [ True, False, False,  True,  True, False,  True,  True, False, False],
        [ True,  True, False, False,  True, False,  True,  True,  True,  True],
        [False, False,  True, False, False, False, False, False,  True, False],
        [False, False,  True,  True, False,  True, False,  True,  True, False],
        [False, False,  True,  True,  True,  True,  True,  True,  True,  True],
        [False,  True, False, False,  True, False, False, False, False,  True],
        [False,  True, False, False,  True,  True, False,  True, False, False],
        [ True,  True, False,  True,  True, False,  True,  True,  True,  True],
        [ True, False,  True, False,  True,  True, False,  True, False, False],
        [False, False,  True,  True,  True, False, False,  True, False,  True],
        [False,  True, False, False, False,  True,  True, False,  True, False],
        [ True, False,  True,  True,  True,  True, False, False, False,  True],
        [False,  True,  True, False,  True,  True, False, False, False, False],
        [False,  True,  True, False,  True, False, False,  True, False, False],
        [ True,  True, False,  True,  True,  True, False,  True, False, False],
        [ True,  True, False, False, False, False, False,  True, False, False],
        [ True,  True,  True,  True, False,  True, False, False,  True, False],
        [ True, False,  True,  True, False,  True,  True,  True, False,  True],
        [False,  True,  True,  True, False, False, False,  True, False, False],
        [False,  True, False, False, False,  True,  True, False,  True, False],
        [ True, False,  True, False, False, False,  True, False,  True, False],
        [False,  True, False, False, False, False,  True,  True, False, False],
        [ True,  True, False,  True, False,  True, False,  True,  True,  True],
        [False, False, False, False, False,  True,  True,  True,  True, False],
        [False, False, False,  True,  True,  True, False, False,  True, False],
        [ True, False, False, False,  True,  True,  True, False, False, False],
        [False, False, False, False, False,  True,  True, False, False, False],
        [False,  True,  True, False, False,  True, False, False,  True,  True],
        [ True, False, False,  True,  True,  True, False, False,  True, False],
        [False, False, False, False, False, False,  True, False, False,  True],
        [False,  True, False, False, False, False,  True, False, False,  True],
        [ True,  True,  True,  True, False, False,  True,  True, False, False],
        [ True, False, False,  True, False, False, False, False,  True,  True],
        [False, False, False,  True, False, False,  True,  True,  True, False],
        [ True,  True,  True, False, False, False, False, False, False,  True],
        [False,  True, False, False,  True,  True,  True, False, False, False],
        [False,  True,  True, False, False, False, False,  True, False,  True],
        [False, False,  True,  True,  True, False, False,  True, False, False],
        [False,  True, False, False,  True,  True, False,  True,  True,  True],
        [ True,  True, False,  True, False, False,  True, False,  True,  True],
        [False, False, False, False,  True,  True,  True, False,  True,  True],
        [ True, False,  True, False, False,  True,  True,  True, False, False],
        [False,  True,  True, False,  True, False,  True,  True,  True, False],
        [False, False,  True,  True, False, False, False, False, False,  True],
        [ True,  True,  True,  True, False, False,  True, False, False,  True],
        [False, False,  True, False, False, False, False, False,  True,  True],
        [ True, False,  True,  True, False,  True, False,  True, False, False],
        [ True,  True, False, False, False, False, False,  True,  True, False],
        [False,  True, False, False,  True, False,  True, False, False,  True],
        [ True, False, False,  True,  True, False, False, False,  True,  True],
        [ True, False,  True,  True, False,  True,  True,  True, False,  True],
        [False,  True,  True, False, False,  True, False,  True,  True, False],
        [False,  True,  True,  True, False,  True,  True,  True,  True, False],
        [False, False, False, False,  True,  True, False, False, False, False],
        [ True,  True, False, False,  True, False, False,  True,  True,  True],
        [ True,  True,  True, False, False,  True,  True, False, False,  True],
        [ True,  True, False, False, False, False, False,  True,  True, False],
        [False, False, False, False, False,  True, False,  True, False,  True],
        [ True,  True,  True,  True, False,  True, False, False, False,  True],
        [False, False,  True, False, False, False, False,  True,  True,  True],
        [ True, False, False, False,  True, False, False,  True, False,  True],
        [False,  True, False, False, False,  True, False, False,  True, False],
        [False, False,  True, False,  True, False,  True, False, False,  True],
        [False,  True,  True,  True, False, False,  True,  True, False,  True],
        [False, False, False, False,  True,  True,  True,  True, False, False],
        [False, False,  True,  True,  True, False, False, False, False,  True],
        [False, False, False, False, False, False, False, False,  True, False],
        [False,  True, False,  True, False, False, False, False, False,  True],
        [ True, False,  True,  True,  True, False, False, False,  True, False],
        [False, False, False, False, False,  True, False, False, False, False],
        [False,  True,  True,  True, False,  True, False, False,  True,  True],
        [ True,  True,  True, False, False, False,  True,  True, False, False],
        [ True, False,  True,  True, False,  True,  True,  True,  True,  True],
        [ True,  True, False, False, False,  True,  True,  True, False, False],
        [False, False, False, False,  True, False,  True, False, False, False],
        [False, False,  True, False, False,  True,  True, False,  True, False],
        [False, False, False,  True, False,  True,  True, False,  True, False],
        [False, False,  True,  True, False, False,  True,  True, False,  True],
        [ True, False,  True,  True,  True, False,  True, False,  True, False],
        [ True, False, False,  True, False, False,  True,  True, False,  True]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>mask.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>tensor(462)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> torch.randn(D.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> torch.randn(D.shape[<span class="dv">1</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>diff_matrix <span class="op">=</span> torch.mm(A, B.t())<span class="op">-</span>D</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>diff_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>tensor([[     nan,      nan,      nan,      nan,  -1.0875,  -1.6179,      nan,
              nan,  -3.2226,      nan],
        [ -5.3536,  -1.1332,      nan,      nan,  -5.4539,      nan,      nan,
          -3.7636,  -2.8529,      nan],
        [ -1.1229,  -2.7055,      nan,      nan,  -3.0259,  -0.8099,  -6.1392,
              nan,  -6.1499,      nan],
        [     nan,      nan,  -4.2913,      nan,      nan,      nan,      nan,
              nan,      nan,      nan],
        [     nan,      nan,   0.2508,      nan,      nan,  -4.8223,      nan,
              nan,  -5.0302,      nan],
        [     nan,      nan,  -5.3843,      nan,      nan,  -6.0856,  -4.8328,
          -5.6402,  -2.3883,      nan],
        [ -6.2670,      nan,      nan,  -2.7164,  -3.7729,  -5.8571,      nan,
              nan,      nan,      nan],
        [ -2.1594,      nan,  -3.9958,  -0.8645,      nan,      nan,      nan,
          -0.6030,  -1.3679,      nan],
        [     nan,      nan,      nan,  -6.0974,      nan,      nan,  -3.2005,
          -2.6826,  -1.8593,   0.1303],
        [     nan,      nan,  -0.5760,      nan,  -9.2839,  -5.2274,   0.0943,
              nan,  -5.6115,  -1.4179],
        [     nan,  -6.3743,      nan,  -5.3184,      nan,   1.2307,  -8.4597,
          -3.3925,      nan,  -5.4302],
        [     nan,  -1.1075,      nan,  -3.4763,  -4.7020,      nan,  -3.2019,
          -6.4975,      nan,  -4.0291],
        [     nan,  -2.6489,      nan,      nan,      nan,  -2.3974,   0.2434,
          -4.2370,      nan,      nan],
        [     nan,  -1.9618,      nan,      nan,      nan,      nan,      nan,
          -2.9674,  -1.0745,  -1.6275],
        [     nan,      nan,  -5.7666,  -3.4573,  -2.9547,  -1.5023,  -7.2379,
              nan,      nan,  -2.4695],
        [ -6.0293,  -3.1063,      nan,      nan,  -1.4092,      nan,      nan,
          -3.0276,  -2.0239,      nan],
        [     nan,      nan,      nan,  -3.7305,  -5.1694,  -5.0255,      nan,
              nan,  -4.6522,  -4.3462],
        [  0.7323,      nan,  -3.8675,  -0.6094,      nan,  -3.4884,      nan,
              nan,      nan,      nan],
        [ -5.9471,      nan,      nan,  -4.1877,  -1.6429,      nan,      nan,
          -3.8453,  -1.1983,      nan],
        [ -7.8288,  -1.2207,      nan,  -5.7854, -12.9095,  -2.2950,  -2.9184,
          -0.7185,  -6.2754,      nan],
        [  1.1750,      nan,      nan,  -2.3464,   0.6139,      nan,  -1.0799,
          -2.2425,      nan,      nan],
        [ -0.0700,  -2.0423,      nan,      nan,  -3.6953,      nan,  -2.4930,
          -3.8397,  -0.4132,  -6.8713],
        [     nan,      nan,  -1.3359,      nan,      nan,      nan,      nan,
              nan,   0.4773,      nan],
        [     nan,      nan,  -6.1488,  -0.9026,      nan,  -5.6070,      nan,
          -0.6927,  -2.2772,      nan],
        [     nan,      nan,  -7.3866,  -1.6025,  -1.5699,  -5.8169,  -2.7112,
          -0.6286,  -1.0068,  -2.1232],
        [     nan,  -1.3495,      nan,      nan,  -0.8714,      nan,      nan,
              nan,      nan,  -6.7614],
        [     nan,  -3.6185,      nan,      nan,  -1.2801,   0.6748,      nan,
          -5.5565,      nan,      nan],
        [ -3.9604,  -3.3208,      nan,  -5.1994,  -4.3533,      nan,  -1.9486,
           0.0566,  -2.6962,  -1.6666],
        [  1.7502,      nan,   0.2363,      nan,  -2.0160,  -1.5403,      nan,
          -5.6352,      nan,      nan],
        [     nan,      nan,  -4.9055,  -2.5472,  -2.2661,      nan,      nan,
          -1.9970,      nan,   0.0856],
        [     nan,   1.0048,      nan,      nan,      nan,  -3.7504,   2.2281,
              nan,  -6.2537,      nan],
        [  0.9157,      nan,  -4.4330,  -2.3623,  -2.7523,  -0.2199,      nan,
              nan,      nan,  -7.8501],
        [     nan,  -4.2148,   1.0533,      nan,  -9.1908,   1.2820,      nan,
              nan,      nan,      nan],
        [     nan,  -2.1784,  -5.9513,      nan,   0.1330,      nan,      nan,
           1.0919,      nan,      nan],
        [ -0.3821,  -0.8814,      nan,  -1.9763,  -1.0561,  -1.7959,      nan,
          -3.5920,      nan,      nan],
        [ -7.1427,  -2.8409,      nan,      nan,      nan,      nan,      nan,
          -2.4435,      nan,      nan],
        [ -3.6026,  -2.6141,  -4.1256,  -1.9275,      nan,  -4.5525,      nan,
              nan,  -4.4410,      nan],
        [ -3.9984,      nan,  -3.7111,  -1.1603,      nan,  -3.5345,  -4.1828,
          -2.2677,      nan,   4.6206],
        [     nan,  -0.9397,  -4.3903,  -0.6050,      nan,      nan,      nan,
          -6.6030,      nan,      nan],
        [     nan,  -2.4433,      nan,      nan,      nan,  -1.6935,  -2.4027,
              nan,   0.5553,      nan],
        [  1.9455,      nan,  -1.0993,      nan,      nan,      nan,  -3.6012,
              nan,  -3.1352,      nan],
        [     nan,  -1.1477,      nan,      nan,      nan,      nan,  -1.2739,
          -0.1774,      nan,      nan],
        [ -4.9210,  -1.7002,      nan,  -1.7316,      nan,  -2.0105,      nan,
          -2.9550,  -6.0387,  -4.4239],
        [     nan,      nan,      nan,      nan,      nan,  -2.7793,  -3.8788,
           1.0518,  -0.8512,      nan],
        [     nan,      nan,      nan,  -3.2997,  -2.7361,   0.2323,      nan,
              nan,  -3.5663,      nan],
        [ -8.5818,      nan,      nan,      nan,  -5.0021,   0.1958,  -5.2938,
              nan,      nan,      nan],
        [     nan,      nan,      nan,      nan,      nan,  -2.1650,  -5.2428,
              nan,      nan,      nan],
        [     nan,  -0.9358,  -8.6548,      nan,      nan,  -4.9832,      nan,
              nan,  -5.1091,  -1.7252],
        [ -1.3611,      nan,      nan,  -3.5845,  -6.5787,  -4.2956,      nan,
              nan,   0.0277,      nan],
        [     nan,      nan,      nan,      nan,      nan,      nan,  -2.3115,
              nan,      nan,  -3.9221],
        [     nan,  -4.2030,      nan,      nan,      nan,      nan,  -5.0549,
              nan,      nan,  -2.5311],
        [ -3.9313,  -0.9649,  -3.1441,  -3.2613,      nan,      nan,   0.9296,
          -3.8308,      nan,      nan],
        [ -3.1522,      nan,      nan,  -1.2927,      nan,      nan,      nan,
              nan,  -2.9687,  -1.5822],
        [     nan,      nan,      nan,  -3.8781,      nan,      nan,  -4.0484,
          -2.8660,  -0.1360,      nan],
        [ -3.6747,  -3.7626,   0.4408,      nan,      nan,      nan,      nan,
              nan,      nan,   3.5041],
        [     nan,   1.6641,      nan,      nan,  -1.7835,   0.3267,  -1.4169,
              nan,      nan,      nan],
        [     nan,  -2.4139,  -5.3680,      nan,      nan,      nan,      nan,
          -7.0341,      nan,  -6.5761],
        [     nan,      nan,  -3.4734,   1.5191,   2.2005,      nan,      nan,
          -7.1815,      nan,      nan],
        [     nan,  -2.0594,      nan,      nan,   3.1304,   2.5634,      nan,
          -5.9391,  -2.3575,  -7.3445],
        [ -4.8362,  -2.3614,      nan,  -4.2621,      nan,      nan,  -3.3042,
              nan,   0.6227,  -0.7491],
        [     nan,      nan,      nan,      nan,  -9.9005,  -3.0431,  -7.2163,
              nan,  -2.6029,  -4.1517],
        [  0.6501,      nan,  -4.7168,      nan,      nan,  -2.9948,  -1.0174,
          -4.1782,      nan,      nan],
        [     nan,   0.5427,  -4.1514,      nan,  -0.5437,      nan,  -1.3782,
          -2.9676,  -1.7994,      nan],
        [     nan,      nan,   0.0912,  -3.2550,      nan,      nan,      nan,
              nan,      nan,  -6.2089],
        [ -8.2676,  -2.1852,  -5.5479,  -2.4950,      nan,      nan,  -3.7798,
              nan,      nan,  -3.9021],
        [     nan,      nan,  -5.7667,      nan,      nan,      nan,      nan,
              nan,   1.7698,   3.9342],
        [ -3.8674,      nan,  -7.7032,  -1.9284,      nan,  -6.2558,      nan,
          -3.6683,      nan,      nan],
        [  0.1347,  -2.8090,      nan,      nan,      nan,      nan,      nan,
          -4.1402,  -3.3092,      nan],
        [     nan,  -6.5303,      nan,      nan,  -7.7821,      nan,  -1.7277,
              nan,      nan,  -3.1784],
        [ -5.2342,      nan,      nan,  -3.9704,   3.0787,      nan,      nan,
              nan,  -0.0880,  -0.8664],
        [ -3.6461,      nan,  -5.2195,  -2.3390,      nan,  -2.2075,  -4.8458,
          -3.8071,      nan,  -0.1326],
        [     nan,  -5.2014,  -1.7569,      nan,      nan,  -2.2990,      nan,
          -3.5876,  -5.2753,      nan],
        [     nan,  -4.3513,  -2.4056,  -5.2791,      nan,  -4.1342,  -3.9433,
          -2.1919,   1.8394,      nan],
        [     nan,      nan,      nan,      nan,  -7.9399,  -5.1014,      nan,
              nan,      nan,      nan],
        [ -2.2478,  -1.0907,      nan,      nan,  -4.1513,      nan,      nan,
          -2.8990,  -6.3821,  -1.9002],
        [ -3.3218,  -1.8374,   0.8239,      nan,      nan,  -4.0694,  -3.9844,
              nan,      nan,  -2.5121],
        [ -0.8202,  -4.4472,      nan,      nan,      nan,      nan,      nan,
          -3.3135,   0.4229,      nan],
        [     nan,      nan,      nan,      nan,      nan,  -3.9118,      nan,
          -8.6628,      nan,  -4.5694],
        [  0.0875,  -6.0042,  -1.1351,  -3.1878,      nan,   0.2818,      nan,
              nan,      nan,  -1.3885],
        [     nan,      nan,  -2.2341,      nan,      nan,      nan,      nan,
          -2.6142,  -4.7219,  -3.8768],
        [ -4.3706,      nan,      nan,      nan,  -2.3430,      nan,      nan,
          -3.6671,      nan,  -7.6500],
        [     nan,  -4.5741,      nan,      nan,      nan,  -2.2173,      nan,
              nan,   1.1973,      nan],
        [     nan,      nan,  -2.9699,      nan,  -9.3627,      nan,  -6.1069,
              nan,      nan,   2.2171],
        [     nan,   0.6351,  -3.6975,   0.8350,      nan,      nan,  -0.5505,
          -3.2935,      nan,  -2.4398],
        [     nan,      nan,      nan,      nan,  -1.0396,  -0.9411,  -2.8798,
          -2.5139,      nan,      nan],
        [     nan,      nan,  -2.4603,  -3.4707,  -0.5753,      nan,      nan,
              nan,      nan,  -9.7519],
        [     nan,      nan,      nan,      nan,      nan,      nan,      nan,
              nan,  -3.0689,      nan],
        [     nan,  -5.2569,      nan,  -5.8377,      nan,      nan,      nan,
              nan,      nan,   2.5229],
        [ -5.6065,      nan,  -6.7366,  -4.3207, -10.9712,      nan,      nan,
              nan,  -4.7729,      nan],
        [     nan,      nan,      nan,      nan,      nan,  -2.8219,      nan,
              nan,      nan,      nan],
        [     nan,  -0.8012,  -1.2969,  -4.7953,      nan,  -2.2873,      nan,
              nan,  -6.0858,  -7.5438],
        [ -2.6096,  -3.1130,  -1.2283,      nan,      nan,      nan,  -2.8651,
          -4.3938,      nan,      nan],
        [  0.4996,      nan,  -2.5488,  -2.7458,      nan,  -0.8354,  -3.3738,
          -7.7740,  -4.9556,  -5.0643],
        [ -0.6502,  -7.3368,      nan,      nan,      nan,  -2.4572,  -0.5994,
          -0.6192,      nan,      nan],
        [     nan,      nan,      nan,      nan,   0.6426,      nan,  -3.5426,
              nan,      nan,      nan],
        [     nan,      nan,  -6.1969,      nan,      nan,  -4.9482,  -2.5562,
              nan,  -0.9199,      nan],
        [     nan,      nan,      nan,  -2.3875,      nan,  -6.1729,   0.0248,
              nan,  -3.5454,      nan],
        [     nan,      nan,  -2.3841,  -4.3877,      nan,      nan,  -4.4218,
          -3.6599,      nan,  -7.3191],
        [ -4.4790,      nan,  -3.4689,  -2.8583,  -3.6989,      nan,  -4.4161,
              nan,  -5.4254,      nan],
        [ -4.2543,      nan,      nan,  -4.6518,      nan,      nan,  -3.5668,
          -5.3078,      nan,  -0.7323]], grad_fn=&lt;SubBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask the matrix</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>diff_matrix[mask].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<pre><code>torch.Size([462])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify the loss function to ignore NaN values</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> factorize(D, k):</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Factorize the matrix D into A and B"""</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly initialize A and B</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> torch.randn(D.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> torch.randn(D.shape[<span class="dv">1</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optimizer</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam([A, B], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>        diff_matrix <span class="op">=</span> torch.mm(A, B.t())<span class="op">-</span>D</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>        diff_vector <span class="op">=</span> diff_matrix[mask]</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> torch.norm(diff_vector)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Zero the gradients</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Backpropagate</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the parameters</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A, B, loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>A, B, loss <span class="op">=</span> factorize(D, <span class="dv">2</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>tensor(21.2660, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now use matrix factorization to predict the ratings</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a class for the model</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MatrixFactorization(nn.Module):</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n_users, n_movies, n_factors<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.user_factors <span class="op">=</span> nn.Embedding(n_users, n_factors)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.movie_factors <span class="op">=</span> nn.Embedding(n_movies, n_factors)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, user, movie):</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="va">self</span>.user_factors(user) <span class="op">*</span> <span class="va">self</span>.movie_factors(movie)).<span class="bu">sum</span>(<span class="dv">1</span>)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>mf <span class="op">=</span> MatrixFactorization(n_users, n_movies, n_factors<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>mf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>MatrixFactorization(
  (user_factors): Embedding(100, 5)
  (movie_factors): Embedding(10, 5)
)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>mf.user_factors.weight.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>torch.Size([100, 5])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Learning the embeddings</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>loss_func <span class="op">=</span> nn.MSELoss()</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.AdamW(mf.parameters(), lr<span class="op">=</span><span class="fl">1e-3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>mask.values()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>RuntimeError: values expected sparse tensor layout but got Strided</code></pre>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>