<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nipun Batra">
<meta name="dcterms.date" content="2023-04-04">
<meta name="description" content="KNN Movie Recommendation">

<title>ES654 - KNN Movie Recommendation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ES654</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../grading.html">
 <span class="menu-text">Grading Policy</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../faq.html">
 <span class="menu-text">FAQs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../schedule.html">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../quizzes.html">
 <span class="menu-text">Quizzes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notebooks/index.html">
 <span class="menu-text">Notebooks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://nipunbatra.github.io">
 <span class="menu-text">Instructor Homepage</span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">KNN Movie Recommendation</h1>
</div>

<div>
  <div class="description">
    KNN Movie Recommendation
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nipun Batra </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 4, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.figure_format <span class="op">=</span> <span class="st">'retina'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate some toy user and movie data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of users</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>n_users <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of movies</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>n_movies <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of ratings</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>n_ratings <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random user ids</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>user_ids <span class="op">=</span> np.random.randint(<span class="dv">0</span>, n_users, n_ratings)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random movie ids</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>movie_ids <span class="op">=</span> np.random.randint(<span class="dv">0</span>, n_movies, n_ratings)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random ratings</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">6</span>, n_ratings)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe with the data</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'user_id'</span>: user_ids, <span class="st">'movie_id'</span>: movie_ids, <span class="st">'rating'</span>: ratings})</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># We should not have any duplicate ratings for the same user and movie</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop any rows that have duplicate user_id and movie_id pairs</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop_duplicates([<span class="st">'user_id'</span>, <span class="st">'movie_id'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>user_id</th>
      <th>movie_id</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>98</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>76</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>98</td>
      <td>9</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11</td>
      <td>6</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>97</td>
      <td>7</td>
      <td>4</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>991</th>
      <td>65</td>
      <td>5</td>
      <td>3</td>
    </tr>
    <tr>
      <th>992</th>
      <td>75</td>
      <td>4</td>
      <td>3</td>
    </tr>
    <tr>
      <th>996</th>
      <td>72</td>
      <td>7</td>
      <td>2</td>
    </tr>
    <tr>
      <th>997</th>
      <td>20</td>
      <td>8</td>
      <td>4</td>
    </tr>
    <tr>
      <th>999</th>
      <td>90</td>
      <td>2</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>633 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a user-item matrix</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> df.pivot(index<span class="op">=</span><span class="st">'user_id'</span>, columns<span class="op">=</span><span class="st">'movie_id'</span>, values<span class="op">=</span><span class="st">'rating'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>movie_id</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>user_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>NaN</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>98</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in the missing values with zeros</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> A.fillna(<span class="dv">0</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>movie_id</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>user_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>0.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>98</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cosine similarity between U1 and U2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># User 1</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>u1 <span class="op">=</span> A.loc[<span class="dv">0</span>]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># User 2</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>u2 <span class="op">=</span> A.loc[<span class="dv">1</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the dot product</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>dot <span class="op">=</span> np.dot(u1, u2)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the L2 norm</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>norm_u1 <span class="op">=</span> np.linalg.norm(u1)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>norm_u2 <span class="op">=</span> np.linalg.norm(u2)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the cosine similarity</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>cos_sim <span class="op">=</span> dot <span class="op">/</span> (norm_u1 <span class="op">*</span> norm_u2)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>cos_sim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>0.7758801774444579</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the cosine similarity between users</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>sim_matrix <span class="op">=</span> cosine_similarity(A)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(sim_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>90</th>
      <th>91</th>
      <th>92</th>
      <th>93</th>
      <th>94</th>
      <th>95</th>
      <th>96</th>
      <th>97</th>
      <th>98</th>
      <th>99</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.000000</td>
      <td>0.775880</td>
      <td>0.666163</td>
      <td>0.580948</td>
      <td>0.603352</td>
      <td>0.511208</td>
      <td>0.384974</td>
      <td>0.432801</td>
      <td>0.506664</td>
      <td>0.674561</td>
      <td>...</td>
      <td>0.620946</td>
      <td>0.666806</td>
      <td>0.919188</td>
      <td>0.786796</td>
      <td>0.541749</td>
      <td>0.544804</td>
      <td>0.487417</td>
      <td>0.418957</td>
      <td>0.566667</td>
      <td>0.800075</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.775880</td>
      <td>1.000000</td>
      <td>0.872626</td>
      <td>0.450746</td>
      <td>0.492767</td>
      <td>0.424967</td>
      <td>0.503147</td>
      <td>0.438832</td>
      <td>0.659767</td>
      <td>0.483863</td>
      <td>...</td>
      <td>0.625688</td>
      <td>0.777482</td>
      <td>0.906955</td>
      <td>0.640342</td>
      <td>0.333244</td>
      <td>0.648464</td>
      <td>0.534114</td>
      <td>0.328874</td>
      <td>0.587788</td>
      <td>0.695749</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.666163</td>
      <td>0.872626</td>
      <td>1.000000</td>
      <td>0.337862</td>
      <td>0.440714</td>
      <td>0.217186</td>
      <td>0.538772</td>
      <td>0.214521</td>
      <td>0.757259</td>
      <td>0.516827</td>
      <td>...</td>
      <td>0.545204</td>
      <td>0.696088</td>
      <td>0.835441</td>
      <td>0.403180</td>
      <td>0.194834</td>
      <td>0.587329</td>
      <td>0.641944</td>
      <td>0.353690</td>
      <td>0.581571</td>
      <td>0.625809</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.580948</td>
      <td>0.450746</td>
      <td>0.337862</td>
      <td>1.000000</td>
      <td>0.522699</td>
      <td>0.883883</td>
      <td>0.482382</td>
      <td>0.715891</td>
      <td>0.704416</td>
      <td>0.476018</td>
      <td>...</td>
      <td>0.214724</td>
      <td>0.434813</td>
      <td>0.450000</td>
      <td>0.574289</td>
      <td>0.817316</td>
      <td>0.412113</td>
      <td>0.471940</td>
      <td>0.536510</td>
      <td>0.580948</td>
      <td>0.519984</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.603352</td>
      <td>0.492767</td>
      <td>0.440714</td>
      <td>0.522699</td>
      <td>1.000000</td>
      <td>0.405840</td>
      <td>0.449448</td>
      <td>0.558341</td>
      <td>0.412547</td>
      <td>0.825977</td>
      <td>...</td>
      <td>0.293428</td>
      <td>0.615794</td>
      <td>0.467354</td>
      <td>0.480481</td>
      <td>0.410082</td>
      <td>0.256804</td>
      <td>0.566610</td>
      <td>0.665207</td>
      <td>0.767421</td>
      <td>0.696073</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>0.544804</td>
      <td>0.648464</td>
      <td>0.587329</td>
      <td>0.412113</td>
      <td>0.256804</td>
      <td>0.093250</td>
      <td>0.202410</td>
      <td>0.460531</td>
      <td>0.547421</td>
      <td>0.262781</td>
      <td>...</td>
      <td>0.868388</td>
      <td>0.677672</td>
      <td>0.659380</td>
      <td>0.556420</td>
      <td>0.225221</td>
      <td>1.000000</td>
      <td>0.777970</td>
      <td>0.155311</td>
      <td>0.666818</td>
      <td>0.545788</td>
    </tr>
    <tr>
      <th>96</th>
      <td>0.487417</td>
      <td>0.534114</td>
      <td>0.641944</td>
      <td>0.471940</td>
      <td>0.566610</td>
      <td>0.095346</td>
      <td>0.295656</td>
      <td>0.400249</td>
      <td>0.593647</td>
      <td>0.403030</td>
      <td>...</td>
      <td>0.675580</td>
      <td>0.621835</td>
      <td>0.539360</td>
      <td>0.521515</td>
      <td>0.180937</td>
      <td>0.777970</td>
      <td>1.000000</td>
      <td>0.441115</td>
      <td>0.855882</td>
      <td>0.686837</td>
    </tr>
    <tr>
      <th>97</th>
      <td>0.418957</td>
      <td>0.328874</td>
      <td>0.353690</td>
      <td>0.536510</td>
      <td>0.665207</td>
      <td>0.518163</td>
      <td>0.459073</td>
      <td>0.621478</td>
      <td>0.618903</td>
      <td>0.718506</td>
      <td>...</td>
      <td>0.284726</td>
      <td>0.565531</td>
      <td>0.324523</td>
      <td>0.503039</td>
      <td>0.536350</td>
      <td>0.155311</td>
      <td>0.441115</td>
      <td>1.000000</td>
      <td>0.777098</td>
      <td>0.633216</td>
    </tr>
    <tr>
      <th>98</th>
      <td>0.566667</td>
      <td>0.587788</td>
      <td>0.581571</td>
      <td>0.580948</td>
      <td>0.767421</td>
      <td>0.334719</td>
      <td>0.377426</td>
      <td>0.661224</td>
      <td>0.692874</td>
      <td>0.666939</td>
      <td>...</td>
      <td>0.665299</td>
      <td>0.771136</td>
      <td>0.559431</td>
      <td>0.615315</td>
      <td>0.377964</td>
      <td>0.666818</td>
      <td>0.855882</td>
      <td>0.777098</td>
      <td>1.000000</td>
      <td>0.812862</td>
    </tr>
    <tr>
      <th>99</th>
      <td>0.800075</td>
      <td>0.695749</td>
      <td>0.625809</td>
      <td>0.519984</td>
      <td>0.696073</td>
      <td>0.390195</td>
      <td>0.111687</td>
      <td>0.385407</td>
      <td>0.576659</td>
      <td>0.554486</td>
      <td>...</td>
      <td>0.656247</td>
      <td>0.626412</td>
      <td>0.772547</td>
      <td>0.716391</td>
      <td>0.248548</td>
      <td>0.545788</td>
      <td>0.686837</td>
      <td>0.633216</td>
      <td>0.812862</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 100 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap(sim_matrix, cmap<span class="op">=</span><span class="st">'Greys'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="movie-recommendation-knn_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the most similar users to user u </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> k_nearest_neighbors(A, u, k):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find the k nearest neighbors for user u"""</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the index of the user in the matrix</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    u_index <span class="op">=</span> A.index.get_loc(u)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the similarity between the user and all other users</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    sim_matrix <span class="op">=</span> cosine_similarity(A)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the k most similar users</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    k_nearest <span class="op">=</span> np.argsort(sim_matrix[u_index])[::<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>:k<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the user ids</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A.index[k_nearest]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>k_nearest_neighbors(A, <span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Int64Index([92, 20, 50, 68, 30], dtype='int64', name='user_id')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show matrix of movie ratings for u and k nearest neighbors</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_neighbors(A, u, k):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Show the movie ratings for user u and k nearest neighbors"""</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the user ids of the k nearest neighbors</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> k_nearest_neighbors(A, u, k)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the movie ratings for user u and the k nearest neighbors</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> A.loc[[u] <span class="op">+</span> <span class="bu">list</span>(neighbors)]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the dataframe</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>show_neighbors(A, <span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>movie_id</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>user_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>92</th>
      <td>0.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>50</th>
      <td>3.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>68</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>30</th>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rating for user u for movie 0 is: (4.0 + 3.0) / 2 = 3.5 (Discard 0s)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict_rating(A, u, m, k<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Predict the rating for user u for movie m"""</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the user ids of the k nearest neighbors</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> k_nearest_neighbors(A, u, k)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the movie ratings for user u and the k nearest neighbors</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> A.loc[[u] <span class="op">+</span> <span class="bu">list</span>(neighbors)]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the ratings for movie m</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    ratings <span class="op">=</span> df[m]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the mean of the ratings</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> ratings[<span class="dv">1</span>:][ratings <span class="op">!=</span> <span class="dv">0</span>].mean()</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the mean</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>predict_rating(A, <span class="dv">0</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>2.25</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now working with real data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">"mov-rec.xlsx"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Timestamp</th>
      <th>Your name</th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2023-04-11 10:58:44.990</td>
      <td>Nipun</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2023-04-11 10:59:49.617</td>
      <td>Gautam Vashishtha</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-04-11 11:12:44.033</td>
      <td>Eshan Gujarathi</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2023-04-11 11:13:48.674</td>
      <td>Sai Krishna Avula</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2023-04-11 11:13:55.658</td>
      <td>Ankit Yadav</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Discard the timestamp column</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'Timestamp'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the "Your Name" column the index</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.set_index(<span class="st">'Your name'</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
    <tr>
      <th>Your name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Nipun</th>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Gautam Vashishtha</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Eshan Gujarathi</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Sai Krishna Avula</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Ankit Yadav</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Dhruv</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Saatvik Rao</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Zeel B Patel</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Neel</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Sachin Jalan</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Ayush Shrivastava</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>....</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Hari Hara Sudhan</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Etikikota Hrushikesh</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Chirag</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Aaryan Darad</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Hetvi Patel</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Kalash Kankaria</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Rachit Verma</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>shriraj</th>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Bhavini Korthi</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Hitarth Gandhi</th>
      <td>3.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Radhika Joglekar</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Medhansh Singh</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Arun Mani</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Satyam</th>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Karan Kumar</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>R Yeeshu Dhurandhar</th>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Satyam Gupta</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>rushali</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>shridhar</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Tanvi Jain</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Manish Prabhubhai Salvi</th>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Varun Barala</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Kevin Shah</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Inderjeet</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Gangaram Siddam</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Aditi</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Madhuri Awachar</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Anupam</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Jinay</th>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Shrutimoy</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Aadesh Desai</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Dhairya</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Rahul C</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>Index(['Nipun', 'Gautam Vashishtha', 'Eshan Gujarathi', 'Sai Krishna Avula',
       'Ankit Yadav ', 'Dhruv', 'Saatvik Rao ', 'Zeel B Patel', 'Neel ',
       'Sachin Jalan ', 'Ayush Shrivastava', '....', 'Hari Hara Sudhan',
       'Etikikota Hrushikesh', 'Chirag', 'Aaryan Darad', 'Hetvi Patel',
       'Kalash Kankaria', 'Rachit Verma', 'shriraj', 'Bhavini Korthi ',
       'Hitarth Gandhi ', 'Radhika Joglekar ', 'Medhansh Singh', 'Arun Mani',
       'Satyam ', 'Karan Kumar ', 'R Yeeshu Dhurandhar', 'Satyam Gupta',
       'rushali', 'shridhar', 'Tanvi Jain ', 'Manish Prabhubhai Salvi ',
       'Varun Barala', 'Kevin Shah ', 'Inderjeet', 'Gangaram Siddam ', 'Aditi',
       'Madhuri Awachar', 'Anupam', 'Jinay', 'Shrutimoy', 'Aadesh Desai',
       'Dhairya', 'Rahul C'],
      dtype='object', name='Your name')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get index for user and movie</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>user <span class="op">=</span> <span class="st">'Dhruv'</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(user <span class="kw">in</span> df.index)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the movie ratings for user</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">#user_ratings = df.loc[user]</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">#user_ratings</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df_copy <span class="op">=</span> df.copy()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>df_copy.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>show_neighbors(df_copy, user, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
    <tr>
      <th>Your name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dhruv</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>shriraj</th>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Jinay</th>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Gautam Vashishtha</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Saatvik Rao</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Medhansh Singh</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the rating for user u for movie m</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>predict_rating(df_copy, user, <span class="st">'The Dark Knight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>5.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>predict_rating(df_copy, user, <span class="st">'Sholay'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>3.4</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic Matrix Factorization (without missing values)</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># D is a matrix of size (n_users, n_movies) randomly generated values between 1 and 5</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> torch.randint(<span class="dv">1</span>, <span class="dv">6</span>, (n_users, n_movies), dtype<span class="op">=</span>torch.<span class="bu">float</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>D</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>tensor([[4., 3., 3., 4., 4., 1., 1., 1., 5., 3.],
        [3., 1., 5., 5., 2., 3., 3., 2., 2., 5.],
        [3., 4., 4., 4., 1., 1., 3., 1., 3., 2.],
        [5., 3., 4., 4., 3., 4., 2., 2., 2., 3.],
        [5., 4., 5., 1., 3., 3., 4., 4., 1., 1.],
        [4., 5., 1., 1., 2., 4., 1., 4., 5., 2.],
        [4., 2., 1., 4., 1., 2., 1., 1., 2., 2.],
        [4., 2., 2., 4., 1., 2., 1., 5., 3., 2.],
        [5., 1., 1., 4., 3., 4., 4., 3., 5., 1.],
        [2., 2., 2., 4., 1., 5., 4., 4., 4., 1.],
        [2., 4., 5., 5., 4., 3., 4., 2., 2., 5.],
        [3., 5., 5., 1., 3., 1., 3., 1., 3., 4.],
        [3., 5., 1., 4., 3., 3., 3., 2., 2., 1.],
        [5., 5., 4., 5., 4., 4., 1., 2., 3., 1.],
        [3., 5., 1., 5., 2., 5., 3., 3., 2., 1.],
        [2., 4., 4., 1., 4., 3., 4., 4., 1., 2.],
        [2., 4., 3., 3., 2., 3., 1., 1., 5., 4.],
        [2., 2., 4., 4., 2., 1., 2., 5., 1., 5.],
        [4., 2., 1., 3., 2., 3., 2., 4., 4., 1.],
        [3., 1., 3., 1., 1., 5., 2., 1., 5., 4.],
        [1., 4., 3., 2., 2., 4., 2., 4., 4., 5.],
        [3., 2., 5., 2., 3., 5., 3., 1., 2., 3.],
        [3., 5., 4., 1., 4., 5., 4., 5., 2., 2.],
        [1., 1., 5., 5., 2., 3., 1., 1., 4., 3.],
        [4., 3., 2., 2., 1., 2., 2., 4., 5., 2.],
        [1., 2., 4., 4., 4., 4., 1., 1., 2., 3.],
        [1., 5., 4., 2., 2., 5., 4., 2., 3., 2.],
        [5., 4., 1., 5., 3., 2., 2., 2., 5., 5.],
        [2., 3., 2., 4., 3., 4., 1., 1., 1., 5.],
        [3., 5., 5., 5., 1., 5., 2., 2., 5., 3.],
        [1., 1., 4., 5., 4., 2., 3., 2., 1., 3.],
        [4., 5., 3., 3., 3., 1., 4., 3., 1., 2.],
        [2., 4., 5., 5., 4., 1., 2., 2., 1., 2.],
        [2., 1., 1., 5., 4., 2., 1., 2., 5., 4.],
        [1., 4., 2., 4., 2., 2., 3., 5., 3., 1.],
        [5., 1., 4., 4., 4., 3., 3., 2., 4., 4.],
        [4., 4., 1., 3., 4., 3., 4., 1., 1., 5.],
        [3., 4., 2., 2., 5., 3., 2., 2., 2., 4.],
        [4., 4., 2., 2., 5., 4., 5., 1., 4., 2.],
        [4., 5., 5., 4., 1., 1., 3., 5., 3., 2.],
        [4., 4., 4., 2., 1., 2., 5., 1., 5., 4.],
        [4., 4., 3., 3., 3., 5., 1., 3., 3., 5.],
        [5., 4., 1., 3., 5., 1., 5., 4., 4., 1.],
        [3., 1., 4., 2., 5., 3., 1., 2., 5., 2.],
        [1., 3., 2., 2., 3., 2., 3., 5., 3., 4.],
        [5., 3., 4., 1., 2., 4., 4., 5., 2., 5.],
        [4., 5., 5., 4., 4., 2., 3., 2., 2., 3.],
        [3., 4., 4., 4., 1., 4., 5., 2., 1., 5.],
        [4., 2., 2., 4., 1., 3., 3., 5., 5., 4.],
        [4., 4., 3., 5., 1., 4., 5., 1., 5., 1.],
        [3., 3., 3., 5., 3., 1., 2., 1., 4., 2.],
        [3., 2., 2., 3., 4., 1., 3., 3., 4., 2.],
        [3., 4., 5., 4., 4., 2., 5., 5., 4., 2.],
        [2., 5., 4., 5., 1., 4., 5., 4., 5., 5.],
        [1., 3., 4., 2., 3., 1., 3., 3., 3., 4.],
        [3., 3., 1., 2., 4., 4., 2., 2., 5., 5.],
        [5., 4., 5., 1., 5., 1., 5., 5., 4., 2.],
        [3., 3., 2., 3., 5., 3., 5., 3., 2., 5.],
        [2., 1., 2., 5., 5., 3., 2., 5., 5., 4.],
        [1., 3., 3., 2., 3., 5., 5., 5., 3., 2.],
        [4., 1., 2., 2., 3., 3., 1., 4., 5., 3.],
        [1., 5., 2., 4., 3., 1., 2., 4., 2., 1.],
        [4., 5., 1., 1., 2., 3., 3., 1., 2., 1.],
        [1., 3., 3., 1., 4., 5., 1., 1., 3., 2.],
        [2., 1., 1., 5., 1., 3., 1., 4., 3., 3.],
        [3., 2., 2., 5., 3., 4., 1., 3., 3., 2.],
        [3., 1., 1., 5., 3., 1., 2., 2., 2., 4.],
        [3., 2., 3., 2., 4., 3., 4., 2., 4., 3.],
        [1., 3., 1., 3., 4., 5., 5., 5., 5., 3.],
        [4., 1., 5., 5., 4., 4., 5., 5., 2., 4.],
        [5., 3., 3., 3., 3., 3., 4., 4., 3., 5.],
        [2., 4., 4., 1., 4., 3., 5., 4., 3., 5.],
        [3., 4., 3., 2., 4., 3., 5., 3., 4., 2.],
        [1., 1., 5., 2., 1., 3., 2., 3., 2., 4.],
        [2., 5., 3., 3., 1., 4., 3., 1., 4., 5.],
        [1., 1., 5., 2., 2., 5., 4., 1., 1., 3.],
        [2., 4., 4., 2., 5., 1., 2., 2., 1., 5.],
        [3., 4., 5., 4., 1., 1., 1., 1., 3., 1.],
        [3., 1., 4., 3., 1., 2., 5., 5., 2., 2.],
        [5., 4., 5., 5., 3., 3., 5., 4., 2., 3.],
        [3., 5., 1., 3., 4., 4., 2., 4., 3., 2.],
        [3., 5., 4., 2., 1., 4., 5., 5., 2., 2.],
        [2., 2., 5., 3., 5., 3., 3., 5., 4., 4.],
        [5., 4., 3., 4., 4., 5., 2., 4., 5., 4.],
        [1., 1., 4., 1., 3., 4., 1., 5., 5., 4.],
        [3., 5., 3., 2., 4., 3., 5., 4., 3., 5.],
        [1., 1., 5., 3., 5., 2., 5., 2., 5., 3.],
        [3., 2., 4., 3., 4., 1., 4., 2., 2., 2.],
        [2., 3., 4., 2., 1., 5., 4., 2., 5., 4.],
        [4., 3., 5., 1., 1., 4., 5., 3., 4., 4.],
        [2., 3., 2., 1., 3., 3., 3., 5., 5., 3.],
        [3., 3., 3., 5., 2., 3., 1., 4., 4., 4.],
        [5., 4., 3., 5., 4., 2., 4., 2., 1., 5.],
        [5., 2., 1., 4., 5., 4., 4., 1., 2., 3.],
        [5., 3., 2., 4., 1., 2., 4., 5., 1., 5.],
        [4., 2., 4., 1., 1., 3., 3., 5., 5., 4.],
        [2., 4., 1., 4., 2., 5., 1., 4., 3., 3.],
        [1., 2., 5., 1., 3., 1., 3., 4., 2., 4.],
        [3., 3., 1., 4., 2., 1., 3., 4., 2., 3.],
        [4., 3., 2., 3., 5., 1., 5., 5., 3., 2.]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>D.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>torch.Size([100, 10])</code></pre>
</div>
</div>
<p>Let us decompose D as AB. A is of shape (n, k) and B is of shape (k, n). We can write the above equation as: D = AB</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly initialize A and B</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> torch.randn(n_users, <span class="dv">2</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> torch.randn(n_movies, <span class="dv">2</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the loss</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> torch.norm(torch.mm(A, B.t()) <span class="op">-</span> D)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>tensor(111.2077, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(torch.mm(A, B.t()).detach().numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.639249</td>
      <td>1.358015</td>
      <td>0.030638</td>
      <td>-0.086800</td>
      <td>-0.848678</td>
      <td>0.798009</td>
      <td>0.141926</td>
      <td>2.183101</td>
      <td>4.017639</td>
      <td>-0.436320</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.489252</td>
      <td>0.824605</td>
      <td>-0.064779</td>
      <td>-0.215449</td>
      <td>-0.467532</td>
      <td>0.470820</td>
      <td>0.015148</td>
      <td>1.532731</td>
      <td>2.797126</td>
      <td>-0.345083</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.611320</td>
      <td>-0.967687</td>
      <td>-0.901781</td>
      <td>-1.655594</td>
      <td>1.109152</td>
      <td>-0.713653</td>
      <td>-0.850740</td>
      <td>0.630157</td>
      <td>0.910516</td>
      <td>-0.534849</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.300554</td>
      <td>0.206345</td>
      <td>-0.163133</td>
      <td>-0.340670</td>
      <td>-0.032774</td>
      <td>0.093603</td>
      <td>-0.121369</td>
      <td>0.748497</td>
      <td>1.329971</td>
      <td>-0.227566</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.442911</td>
      <td>-0.185317</td>
      <td>0.289191</td>
      <td>0.584435</td>
      <td>-0.052355</td>
      <td>-0.060551</td>
      <td>0.230549</td>
      <td>-1.026641</td>
      <td>-1.806286</td>
      <td>0.341514</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>-0.156855</td>
      <td>1.181981</td>
      <td>0.614964</td>
      <td>1.072665</td>
      <td>-1.075892</td>
      <td>0.791515</td>
      <td>0.624686</td>
      <td>0.438792</td>
      <td>0.974120</td>
      <td>0.185679</td>
    </tr>
    <tr>
      <th>96</th>
      <td>0.046780</td>
      <td>1.348210</td>
      <td>0.515292</td>
      <td>0.860185</td>
      <td>-1.120491</td>
      <td>0.872153</td>
      <td>0.553955</td>
      <td>0.962916</td>
      <td>1.909397</td>
      <td>0.032866</td>
    </tr>
    <tr>
      <th>97</th>
      <td>0.820526</td>
      <td>-0.342274</td>
      <td>-0.817404</td>
      <td>-1.558424</td>
      <td>0.678028</td>
      <td>-0.334563</td>
      <td>-0.725520</td>
      <td>1.461008</td>
      <td>2.459459</td>
      <td>-0.668253</td>
    </tr>
    <tr>
      <th>98</th>
      <td>0.960636</td>
      <td>0.808613</td>
      <td>-0.460158</td>
      <td>-0.985405</td>
      <td>-0.231104</td>
      <td>0.396325</td>
      <td>-0.323030</td>
      <td>2.488239</td>
      <td>4.443720</td>
      <td>-0.719614</td>
    </tr>
    <tr>
      <th>99</th>
      <td>0.258562</td>
      <td>-1.585716</td>
      <td>-0.864719</td>
      <td>-1.516542</td>
      <td>1.466146</td>
      <td>-1.068419</td>
      <td>-0.871881</td>
      <td>-0.490063</td>
      <td>-1.136621</td>
      <td>-0.287258</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(D)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>4.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>2.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>98</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimizer</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam([A, B], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the loss</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> torch.norm(torch.mm(A, B.t()) <span class="op">-</span> D)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Zero the gradients</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Backpropagate</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the parameters</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the loss</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>111.20771026611328
108.27051544189453
105.80335998535156
103.40086364746094
100.72842407226562
97.58438110351562
93.81680297851562
89.25970458984375
83.7423324584961
77.26307678222656
70.19258117675781
63.19015884399414
56.88321304321289
51.72879409790039
47.9384880065918
45.35057830810547
43.641456604003906
42.52534866333008
41.79496383666992
41.31401443481445
40.99107360839844
40.76564025878906
40.59902572631836
40.467525482177734
40.3569221496582
40.258819580078125
40.16835021972656
40.08271026611328
40.00034713745117
39.92043685913086
39.84257888793945
39.76660919189453
39.69248580932617
39.620243072509766
39.5499267578125
39.48160934448242
39.41535186767578
39.3512077331543
39.28923416137695
39.229454040527344
39.17189407348633
39.11655044555664
39.06340789794922
39.01244354248047
38.96361541748047
38.916866302490234
38.87213897705078
38.82937240600586
38.788490295410156
38.74942398071289
38.712100982666016
38.67644500732422
38.642391204833984
38.609859466552734
38.57879638671875
38.549129486083984
38.52079772949219
38.49374771118164
38.46791458129883
38.44325256347656
38.419708251953125
38.39723205566406
38.37577819824219
38.35530471801758
38.33576202392578
38.31711959838867
38.29933547973633
38.28236389160156
38.266178131103516
38.25074005126953
38.236019134521484
38.221981048583984
38.20859146118164
38.195831298828125
38.18366241455078
38.172061920166016
38.161006927490234
38.15047073364258
38.14042663574219
38.1308479309082
38.12172317504883
38.11302185058594
38.10472869873047
38.09682083129883
38.08927917480469
38.082088470458984
38.07522964477539
38.06869125366211
38.06245040893555
38.056495666503906
38.05081558227539
38.045387268066406
38.040199279785156
38.035247802734375
38.030517578125
38.025997161865234
38.02166748046875
38.01752853393555
38.013572692871094
38.0097770690918</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(torch.mm(A, B.t()).detach().numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.877245</td>
      <td>2.349408</td>
      <td>2.698709</td>
      <td>4.299346</td>
      <td>2.512763</td>
      <td>3.261262</td>
      <td>1.645051</td>
      <td>2.041291</td>
      <td>3.709695</td>
      <td>3.603064</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.078172</td>
      <td>2.634752</td>
      <td>2.939233</td>
      <td>4.346404</td>
      <td>2.733289</td>
      <td>3.407181</td>
      <td>2.005698</td>
      <td>2.346127</td>
      <td>3.832465</td>
      <td>3.734734</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.589829</td>
      <td>2.570027</td>
      <td>2.624593</td>
      <td>2.919368</td>
      <td>2.430893</td>
      <td>2.628291</td>
      <td>2.403398</td>
      <td>2.446646</td>
      <td>2.827454</td>
      <td>2.792843</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.156364</td>
      <td>2.959182</td>
      <td>3.124442</td>
      <td>3.919249</td>
      <td>2.898377</td>
      <td>3.319995</td>
      <td>2.578469</td>
      <td>2.750297</td>
      <td>3.640440</td>
      <td>3.574934</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3.024203</td>
      <td>4.092069</td>
      <td>3.533165</td>
      <td>1.131455</td>
      <td>3.243889</td>
      <td>2.333030</td>
      <td>5.017376</td>
      <td>4.316901</td>
      <td>2.075642</td>
      <td>2.182275</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>3.160691</td>
      <td>3.446825</td>
      <td>3.336332</td>
      <td>2.915082</td>
      <td>3.081992</td>
      <td>2.998272</td>
      <td>3.561985</td>
      <td>3.401173</td>
      <td>3.101982</td>
      <td>3.101566</td>
    </tr>
    <tr>
      <th>96</th>
      <td>2.865848</td>
      <td>2.545350</td>
      <td>2.776134</td>
      <td>3.853841</td>
      <td>2.579055</td>
      <td>3.109865</td>
      <td>2.054467</td>
      <td>2.307856</td>
      <td>3.464347</td>
      <td>3.385802</td>
    </tr>
    <tr>
      <th>97</th>
      <td>2.556723</td>
      <td>3.140626</td>
      <td>2.850108</td>
      <td>1.622281</td>
      <td>2.623988</td>
      <td>2.187548</td>
      <td>3.595559</td>
      <td>3.222872</td>
      <td>2.113160</td>
      <td>2.160327</td>
    </tr>
    <tr>
      <th>98</th>
      <td>2.566484</td>
      <td>2.721295</td>
      <td>2.675820</td>
      <td>2.528903</td>
      <td>2.473780</td>
      <td>2.486909</td>
      <td>2.735221</td>
      <td>2.658010</td>
      <td>2.605940</td>
      <td>2.595152</td>
    </tr>
    <tr>
      <th>99</th>
      <td>3.217502</td>
      <td>4.044358</td>
      <td>3.626226</td>
      <td>1.849402</td>
      <td>3.336344</td>
      <td>2.690812</td>
      <td>4.711350</td>
      <td>4.178985</td>
      <td>2.555862</td>
      <td>2.627626</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(D)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>4.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>2.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>98</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> factorize(D, k):</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Factorize the matrix D into A and B"""</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly initialize A and B</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> torch.randn(D.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> torch.randn(D.shape[<span class="dv">1</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optimizer</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam([A, B], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> torch.norm(torch.mm(A, B.t()) <span class="op">-</span> D)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Zero the gradients</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Backpropagate</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the parameters</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A, B, loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]:</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    A, B, loss <span class="op">=</span> factorize(D, k)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(k, loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 41.48448181152344
2 38.06168746948242
3 34.44601821899414
4 30.515527725219727
5 26.882482528686523
6 23.882381439208984</code></pre>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With missing values</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly replace some entries with NaN</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> torch.randint(<span class="dv">1</span>, <span class="dv">6</span>, (n_users, n_movies), dtype<span class="op">=</span>torch.<span class="bu">float</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>D[torch.rand(D.shape) <span class="op">&lt;</span> <span class="fl">0.5</span>] <span class="op">=</span> <span class="bu">float</span>(<span class="st">'nan'</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>D</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>tensor([[nan, nan, nan, nan, nan, 4., 1., nan, 5., 4.],
        [nan, 1., 3., 4., 4., nan, 2., nan, 5., nan],
        [4., 1., 4., 4., 1., 5., 3., nan, 3., nan],
        [1., nan, nan, 5., nan, 5., nan, nan, 1., nan],
        [nan, nan, nan, 3., 1., nan, 2., 3., nan, nan],
        [nan, nan, 4., nan, nan, 5., 3., 3., nan, nan],
        [nan, nan, nan, nan, nan, 2., 3., 2., 3., nan],
        [4., nan, 3., 4., 2., 5., 3., 5., nan, 2.],
        [4., 4., 4., nan, nan, 2., 4., nan, nan, 3.],
        [1., nan, 4., nan, nan, 3., nan, 2., 2., nan],
        [nan, nan, 2., 5., nan, 3., 2., 5., 3., nan],
        [nan, 2., nan, 3., 5., 2., 3., 5., nan, nan],
        [nan, 5., nan, 5., nan, 4., nan, 3., 2., 5.],
        [nan, nan, 2., nan, nan, nan, nan, 4., 4., 1.],
        [nan, 2., nan, 1., 4., 3., nan, nan, 4., nan],
        [nan, 3., 1., nan, 3., nan, 1., nan, 5., 1.],
        [4., 4., nan, nan, 4., 3., nan, 3., 2., 2.],
        [3., nan, nan, 1., nan, 1., 4., 1., 5., 2.],
        [2., nan, nan, 1., nan, 1., 4., nan, nan, 2.],
        [2., nan, nan, 2., 2., nan, 5., 5., nan, 4.],
        [nan, 2., 3., 3., nan, nan, nan, 3., nan, 4.],
        [1., nan, 5., 1., nan, nan, nan, 2., 3., nan],
        [nan, nan, 1., nan, nan, 5., nan, 2., 3., 1.],
        [nan, nan, 2., 3., nan, 5., 3., nan, 4., 3.],
        [nan, 3., 3., nan, 4., 2., nan, 2., 1., 5.],
        [4., nan, 2., 3., 3., nan, nan, nan, nan, 1.],
        [nan, 5., nan, nan, nan, 5., nan, nan, nan, nan],
        [5., 5., nan, 4., nan, 4., 4., 2., 2., 4.],
        [nan, nan, 1., nan, 2., nan, 3., 4., nan, nan],
        [nan, nan, 3., nan, 2., nan, 4., 2., nan, 2.],
        [4., nan, nan, nan, 1., nan, nan, nan, 5., 2.],
        [1., 5., nan, nan, nan, nan, nan, nan, 2., nan],
        [4., nan, 3., nan, nan, 1., nan, 4., 2., 4.],
        [nan, nan, 1., 4., nan, nan, 1., 2., 1., nan],
        [nan, 4., nan, nan, 4., 4., 1., nan, nan, nan],
        [1., nan, nan, 3., nan, nan, 5., 2., 3., 2.],
        [3., 1., nan, 2., nan, nan, nan, 1., nan, nan],
        [nan, nan, 4., 5., nan, 4., nan, 5., 2., 4.],
        [nan, nan, nan, nan, nan, nan, 1., 3., 2., nan],
        [3., 3., 5., 2., 5., 2., 3., nan, 4., nan],
        [2., 5., nan, nan, nan, 4., nan, 3., 4., nan],
        [4., 4., nan, 5., 4., 4., 5., 5., nan, nan],
        [3., 2., nan, nan, 5., 4., 4., nan, 5., 4.],
        [nan, 5., nan, 3., nan, nan, 4., 1., nan, nan],
        [5., 1., nan, nan, 2., 5., 2., nan, 5., 1.],
        [4., 1., nan, nan, nan, 5., nan, 4., 1., 4.],
        [nan, nan, nan, nan, 5., nan, nan, 2., nan, 1.],
        [1., 2., 2., 3., nan, 3., nan, nan, 5., 4.],
        [4., 5., nan, nan, nan, nan, 1., 4., nan, nan],
        [3., 3., nan, nan, nan, nan, nan, nan, nan, 4.],
        [nan, 3., 3., nan, nan, 3., nan, 4., nan, nan],
        [4., 2., 1., nan, 3., nan, nan, nan, 4., nan],
        [4., nan, 5., 1., 1., 5., 1., nan, 2., 5.],
        [3., 1., nan, 3., nan, nan, 3., 4., nan, 2.],
        [nan, nan, 3., 2., 2., nan, 1., 1., 2., nan],
        [2., nan, nan, 1., nan, 5., 1., nan, nan, 2.],
        [1., 4., 2., 3., 1., nan, nan, nan, nan, 1.],
        [4., 2., nan, nan, 1., nan, 2., nan, 5., nan],
        [nan, nan, nan, 3., nan, 1., 3., 2., nan, 5.],
        [5., 5., 1., nan, nan, 2., 5., 3., nan, nan],
        [nan, 3., 4., 5., 4., nan, 1., 2., nan, nan],
        [2., nan, 5., 1., nan, nan, nan, nan, 1., nan],
        [nan, 4., nan, 2., nan, 1., nan, nan, 1., 3.],
        [3., 4., nan, 2., 1., 5., nan, nan, nan, 3.],
        [4., nan, 4., nan, nan, nan, nan, 2., 4., nan],
        [nan, 4., nan, 3., 5., 2., 2., nan, 5., 4.],
        [nan, 2., 1., nan, 4., nan, nan, 2., 1., 1.],
        [nan, nan, 5., nan, nan, nan, 4., 2., nan, nan],
        [4., nan, 4., nan, nan, nan, nan, nan, nan, 5.],
        [3., 3., nan, nan, nan, 2., 2., nan, 1., 3.],
        [nan, nan, nan, nan, nan, 3., 2., 2., 1., 2.],
        [nan, nan, 1., 3., nan, nan, 1., nan, 2., 1.],
        [2., 4., nan, nan, 4., nan, 3., 3., nan, nan],
        [nan, 3., 5., 2., 2., 2., 4., 4., 2., 3.],
        [nan, 5., nan, nan, nan, nan, nan, 4., nan, nan],
        [nan, 1., nan, nan, nan, 5., 5., 5., 3., 3.],
        [3., 3., nan, 5., 5., 5., 4., nan, nan, 3.],
        [4., nan, 4., 1., nan, nan, 3., 1., 1., nan],
        [nan, nan, nan, nan, 4., 1., 2., nan, 3., nan],
        [4., 4., nan, nan, 4., 3., 1., 3., 4., nan],
        [5., nan, 4., 5., nan, 2., nan, 5., 3., nan],
        [nan, nan, nan, 4., 4., nan, nan, 2., nan, nan],
        [3., 2., 2., 2., nan, 1., nan, 1., nan, nan],
        [nan, nan, nan, nan, nan, 2., 1., 1., nan, 2.],
        [nan, nan, 5., 2., 4., nan, nan, nan, 2., nan],
        [nan, nan, nan, 5., nan, nan, 2., nan, 5., nan],
        [3., 1., nan, 1., 5., 1., 2., nan, 5., 5.],
        [3., nan, nan, 3., 2., 5., nan, 2., nan, nan],
        [nan, nan, 2., 4., nan, 2., 4., nan, 1., 1.],
        [2., 4., nan, nan, 3., 4., nan, nan, 3., 5.],
        [nan, nan, nan, 2., nan, nan, nan, nan, 2., 4.],
        [nan, nan, 2., 4., nan, nan, 2., 1., nan, 5.],
        [nan, nan, 3., 4., 5., nan, nan, 2., nan, 1.],
        [nan, 3., nan, nan, 3., nan, nan, 4., 2., 5.],
        [nan, 3., nan, nan, 3., nan, 3., 5., 5., 3.],
        [4., 1., nan, nan, 5., 4., nan, 2., 4., 4.],
        [nan, nan, nan, 3., nan, 1., nan, 2., 1., 1.],
        [nan, nan, nan, 4., nan, 5., 5., 2., 1., nan],
        [nan, 1., nan, 5., 4., nan, nan, nan, nan, 3.],
        [nan, nan, nan, nan, nan, nan, 1., 4., 4., nan]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>A, B, loss <span class="op">=</span> factorize(D, <span class="dv">2</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>tensor(nan, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> <span class="op">~</span>torch.isnan(D)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>mask</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>tensor([[False, False, False, False, False,  True,  True, False,  True,  True],
        [False,  True,  True,  True,  True, False,  True, False,  True, False],
        [ True,  True,  True,  True,  True,  True,  True, False,  True, False],
        [ True, False, False,  True, False,  True, False, False,  True, False],
        [False, False, False,  True,  True, False,  True,  True, False, False],
        [False, False,  True, False, False,  True,  True,  True, False, False],
        [False, False, False, False, False,  True,  True,  True,  True, False],
        [ True, False,  True,  True,  True,  True,  True,  True, False,  True],
        [ True,  True,  True, False, False,  True,  True, False, False,  True],
        [ True, False,  True, False, False,  True, False,  True,  True, False],
        [False, False,  True,  True, False,  True,  True,  True,  True, False],
        [False,  True, False,  True,  True,  True,  True,  True, False, False],
        [False,  True, False,  True, False,  True, False,  True,  True,  True],
        [False, False,  True, False, False, False, False,  True,  True,  True],
        [False,  True, False,  True,  True,  True, False, False,  True, False],
        [False,  True,  True, False,  True, False,  True, False,  True,  True],
        [ True,  True, False, False,  True,  True, False,  True,  True,  True],
        [ True, False, False,  True, False,  True,  True,  True,  True,  True],
        [ True, False, False,  True, False,  True,  True, False, False,  True],
        [ True, False, False,  True,  True, False,  True,  True, False,  True],
        [False,  True,  True,  True, False, False, False,  True, False,  True],
        [ True, False,  True,  True, False, False, False,  True,  True, False],
        [False, False,  True, False, False,  True, False,  True,  True,  True],
        [False, False,  True,  True, False,  True,  True, False,  True,  True],
        [False,  True,  True, False,  True,  True, False,  True,  True,  True],
        [ True, False,  True,  True,  True, False, False, False, False,  True],
        [False,  True, False, False, False,  True, False, False, False, False],
        [ True,  True, False,  True, False,  True,  True,  True,  True,  True],
        [False, False,  True, False,  True, False,  True,  True, False, False],
        [False, False,  True, False,  True, False,  True,  True, False,  True],
        [ True, False, False, False,  True, False, False, False,  True,  True],
        [ True,  True, False, False, False, False, False, False,  True, False],
        [ True, False,  True, False, False,  True, False,  True,  True,  True],
        [False, False,  True,  True, False, False,  True,  True,  True, False],
        [False,  True, False, False,  True,  True,  True, False, False, False],
        [ True, False, False,  True, False, False,  True,  True,  True,  True],
        [ True,  True, False,  True, False, False, False,  True, False, False],
        [False, False,  True,  True, False,  True, False,  True,  True,  True],
        [False, False, False, False, False, False,  True,  True,  True, False],
        [ True,  True,  True,  True,  True,  True,  True, False,  True, False],
        [ True,  True, False, False, False,  True, False,  True,  True, False],
        [ True,  True, False,  True,  True,  True,  True,  True, False, False],
        [ True,  True, False, False,  True,  True,  True, False,  True,  True],
        [False,  True, False,  True, False, False,  True,  True, False, False],
        [ True,  True, False, False,  True,  True,  True, False,  True,  True],
        [ True,  True, False, False, False,  True, False,  True,  True,  True],
        [False, False, False, False,  True, False, False,  True, False,  True],
        [ True,  True,  True,  True, False,  True, False, False,  True,  True],
        [ True,  True, False, False, False, False,  True,  True, False, False],
        [ True,  True, False, False, False, False, False, False, False,  True],
        [False,  True,  True, False, False,  True, False,  True, False, False],
        [ True,  True,  True, False,  True, False, False, False,  True, False],
        [ True, False,  True,  True,  True,  True,  True, False,  True,  True],
        [ True,  True, False,  True, False, False,  True,  True, False,  True],
        [False, False,  True,  True,  True, False,  True,  True,  True, False],
        [ True, False, False,  True, False,  True,  True, False, False,  True],
        [ True,  True,  True,  True,  True, False, False, False, False,  True],
        [ True,  True, False, False,  True, False,  True, False,  True, False],
        [False, False, False,  True, False,  True,  True,  True, False,  True],
        [ True,  True,  True, False, False,  True,  True,  True, False, False],
        [False,  True,  True,  True,  True, False,  True,  True, False, False],
        [ True, False,  True,  True, False, False, False, False,  True, False],
        [False,  True, False,  True, False,  True, False, False,  True,  True],
        [ True,  True, False,  True,  True,  True, False, False, False,  True],
        [ True, False,  True, False, False, False, False,  True,  True, False],
        [False,  True, False,  True,  True,  True,  True, False,  True,  True],
        [False,  True,  True, False,  True, False, False,  True,  True,  True],
        [False, False,  True, False, False, False,  True,  True, False, False],
        [ True, False,  True, False, False, False, False, False, False,  True],
        [ True,  True, False, False, False,  True,  True, False,  True,  True],
        [False, False, False, False, False,  True,  True,  True,  True,  True],
        [False, False,  True,  True, False, False,  True, False,  True,  True],
        [ True,  True, False, False,  True, False,  True,  True, False, False],
        [False,  True,  True,  True,  True,  True,  True,  True,  True,  True],
        [False,  True, False, False, False, False, False,  True, False, False],
        [False,  True, False, False, False,  True,  True,  True,  True,  True],
        [ True,  True, False,  True,  True,  True,  True, False, False,  True],
        [ True, False,  True,  True, False, False,  True,  True,  True, False],
        [False, False, False, False,  True,  True,  True, False,  True, False],
        [ True,  True, False, False,  True,  True,  True,  True,  True, False],
        [ True, False,  True,  True, False,  True, False,  True,  True, False],
        [False, False, False,  True,  True, False, False,  True, False, False],
        [ True,  True,  True,  True, False,  True, False,  True, False, False],
        [False, False, False, False, False,  True,  True,  True, False,  True],
        [False, False,  True,  True,  True, False, False, False,  True, False],
        [False, False, False,  True, False, False,  True, False,  True, False],
        [ True,  True, False,  True,  True,  True,  True, False,  True,  True],
        [ True, False, False,  True,  True,  True, False,  True, False, False],
        [False, False,  True,  True, False,  True,  True, False,  True,  True],
        [ True,  True, False, False,  True,  True, False, False,  True,  True],
        [False, False, False,  True, False, False, False, False,  True,  True],
        [False, False,  True,  True, False, False,  True,  True, False,  True],
        [False, False,  True,  True,  True, False, False,  True, False,  True],
        [False,  True, False, False,  True, False, False,  True,  True,  True],
        [False,  True, False, False,  True, False,  True,  True,  True,  True],
        [ True,  True, False, False,  True,  True, False,  True,  True,  True],
        [False, False, False,  True, False,  True, False,  True,  True,  True],
        [False, False, False,  True, False,  True,  True,  True,  True, False],
        [False,  True, False,  True,  True, False, False, False, False,  True],
        [False, False, False, False, False, False,  True,  True,  True, False]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>mask.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>tensor(526)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> torch.randn(D.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> torch.randn(D.shape[<span class="dv">1</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>diff_matrix <span class="op">=</span> torch.mm(A, B.t())<span class="op">-</span>D</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>diff_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>tensor([[        nan,         nan,         nan,         nan,         nan,
         -6.0304e+00, -2.6199e+00,         nan, -4.3819e+00, -3.3468e+00],
        [        nan,  3.7142e+00, -4.9707e+00, -1.3741e+00, -4.6438e+00,
                 nan, -1.5472e-01,         nan, -2.6138e+00,         nan],
        [-2.9280e+00, -1.5343e+00, -5.0341e+00, -5.7782e+00, -1.9360e+00,
         -4.8420e+00, -5.7149e+00,         nan, -2.6162e+00,         nan],
        [-6.0626e+00,         nan,         nan, -6.1760e+00,         nan,
         -4.3476e+00,         nan,         nan, -3.0672e+00,         nan],
        [        nan,         nan,         nan, -7.0873e+00, -3.4614e-01,
                 nan, -5.7674e+00, -3.2510e+00,         nan,         nan],
        [        nan,         nan, -3.1821e+00,         nan,         nan,
         -5.5434e+00, -6.3621e+00, -4.1019e+00,         nan,         nan],
        [        nan,         nan,         nan,         nan,         nan,
         -2.3834e+00, -4.7265e+00, -1.7893e+00, -4.3101e+00,         nan],
        [-1.8048e+00,         nan, -5.8478e+00, -3.5702e+00, -5.6700e+00,
         -1.5390e+00, -3.8177e+00, -7.2935e+00,         nan, -3.7210e+00],
        [-9.1891e+00, -8.6787e+00, -1.8440e+00,         nan,         nan,
         -2.3273e+00, -7.8584e+00,         nan,         nan,  5.5473e-01],
        [ 4.5222e+00,         nan, -7.3660e+00,         nan,         nan,
         -6.4290e+00,         nan, -4.3229e+00,  8.2571e-01,         nan],
        [        nan,         nan, -3.0912e+00,  7.7749e-01,         nan,
         -5.7369e+00,  2.2210e+00, -5.8065e+00, -1.7718e-01,         nan],
        [        nan, -3.1650e+00,         nan, -3.6764e+00, -5.4935e+00,
         -1.3642e+00, -2.6643e+00, -4.5469e+00,         nan,         nan],
        [        nan, -7.0699e+00,         nan, -6.6076e+00,         nan,
         -3.5243e+00,         nan, -3.2664e+00, -3.4629e+00, -2.0581e+00],
        [        nan,         nan,  1.4691e+00,         nan,         nan,
                 nan,         nan, -2.9002e-01, -7.6711e+00,  6.3447e+00],
        [        nan, -4.4159e+00,         nan, -2.0398e+00, -3.3301e+00,
         -3.2728e+00,         nan,         nan, -3.4351e+00,         nan],
        [        nan, -5.3571e+00,  2.2411e+00,         nan, -4.9198e+00,
                 nan,  6.8641e+00,         nan, -8.5952e+00,  3.6790e+00],
        [ 1.9719e+00,  4.9249e-02,         nan,         nan, -4.3543e+00,
         -6.8446e+00,         nan, -1.1369e+01,  3.4215e+00, -1.0512e+01],
        [-4.5999e+00,         nan,         nan,  7.7475e-01,         nan,
          5.3207e-01, -1.6624e+00,  2.5414e+00, -7.2319e+00,  1.1230e-01],
        [ 2.6226e+00,         nan,         nan, -2.2811e+00,         nan,
         -4.0714e+00, -1.5009e+00,         nan,         nan, -2.0551e+00],
        [ 1.6093e+00,         nan,         nan, -9.6548e-01, -5.6932e+00,
                 nan, -2.1572e+00, -5.5852e+00,         nan, -5.2825e+00],
        [        nan, -2.0973e+00, -8.3666e-01, -2.4242e+00,         nan,
                 nan,         nan, -1.8161e+00,         nan, -4.7464e-01],
        [-2.9232e+00,         nan, -5.4571e+00, -9.5743e-01,         nan,
                 nan,         nan, -6.2493e-01, -4.9348e+00,         nan],
        [        nan,         nan, -1.6285e+00,         nan,         nan,
         -3.2003e+00,         nan,  1.3713e+00, -4.3429e+00,  1.3923e+00],
        [        nan,         nan, -1.3194e+00, -3.6369e+00,         nan,
         -3.2742e+00, -6.7289e+00,         nan, -5.6799e+00, -9.9545e-01],
        [        nan, -3.8384e+00, -3.5466e+00,         nan, -6.8673e+00,
         -1.3128e-01,         nan, -1.9009e+00, -1.5824e+00, -3.6302e+00],
        [-2.7206e+00,         nan, -2.0689e+00, -3.5334e+00, -2.2079e+00,
                 nan,         nan,         nan,         nan, -1.7230e+00],
        [        nan, -6.4481e+00,         nan,         nan,         nan,
         -7.2316e+00,         nan,         nan,         nan,         nan],
        [-8.8492e+00, -7.7699e+00,         nan, -4.5965e+00,         nan,
         -2.9004e+00, -2.4343e+00,  7.1743e-01, -3.7019e+00, -8.6159e-01],
        [        nan,         nan, -2.2678e+00,         nan, -5.4813e+00,
                 nan, -4.8448e-01, -3.8009e+00,         nan,         nan],
        [        nan,         nan, -5.1900e+00,         nan, -5.2518e+00,
                 nan,  6.7297e-01, -1.2989e+00,         nan, -4.2074e+00],
        [ 1.1340e-01,         nan,         nan,         nan,  7.0775e-01,
                 nan,         nan,         nan,  3.6655e-01, -1.0596e+01],
        [ 3.1408e+00, -1.7511e+00,         nan,         nan,         nan,
                 nan,         nan,         nan, -6.7022e-01,         nan],
        [-8.5044e+00,         nan,  4.0904e-02,         nan,         nan,
         -1.1067e+00,         nan, -7.0333e-01, -3.2839e+00, -3.6806e+00],
        [        nan,         nan, -1.8555e+00, -5.1376e+00,         nan,
                 nan, -4.0138e+00, -3.8689e+00,  1.0433e+00,         nan],
        [        nan, -7.6005e+00,         nan,         nan, -2.2323e-01,
         -5.4352e+00, -3.5469e+00,         nan,         nan,         nan],
        [-5.3686e-01,         nan,         nan, -4.1766e+00,         nan,
                 nan, -3.9135e+00, -2.7297e+00, -3.1737e+00, -1.0176e+00],
        [ 1.2857e-01, -1.1689e+00,         nan, -2.1021e+00,         nan,
                 nan,         nan, -9.2162e-01,         nan,         nan],
        [        nan,         nan, -2.6571e+00, -3.1551e+00,         nan,
         -4.4716e+00,         nan, -4.3905e+00, -2.4636e+00, -4.5063e+00],
        [        nan,         nan,         nan,         nan,         nan,
                 nan,  3.9218e+00, -3.2185e+00, -7.2626e-03,         nan],
        [-5.1156e+00, -3.2533e+00, -3.2710e+00, -1.4600e+00, -1.5257e+00,
         -3.5308e+00, -2.6255e+00,         nan, -3.7027e+00,         nan],
        [-3.0103e+00, -6.4385e+00,         nan,         nan,         nan,
         -5.4578e+00,         nan, -3.7163e+00, -4.6529e+00,         nan],
        [-6.6312e+00, -9.6576e+00,         nan, -8.8036e+00, -2.8216e+00,
         -6.5281e+00, -6.2341e+00, -5.0450e+00,         nan,         nan],
        [-3.7711e+00, -4.4230e+00,         nan,         nan, -4.6927e+00,
         -5.6237e+00, -8.8137e+00,         nan, -2.9191e+00, -6.2458e+00],
        [        nan, -7.5681e+00,         nan, -3.7730e+00,         nan,
                 nan, -2.0465e+00,  9.5495e-01,         nan,         nan],
        [-2.8522e+00, -2.4908e+00,         nan,         nan, -5.1231e+00,
         -6.4239e+00,  2.4724e-01,         nan, -3.1210e+00, -1.8229e+00],
        [-5.7241e+00, -4.4338e+00,         nan,         nan,         nan,
         -5.6479e+00,         nan, -2.2349e+00, -1.8314e+00, -1.3640e+00],
        [        nan,         nan,         nan,         nan, -5.3468e+00,
                 nan,         nan, -3.7458e+00,         nan, -3.2797e+00],
        [-1.5698e+00, -4.6222e+00, -2.8198e+00, -5.7588e+00,         nan,
         -3.4668e+00,         nan,         nan, -4.6710e+00, -2.7051e+00],
        [-6.2213e+00, -9.4411e+00,         nan,         nan,         nan,
                 nan, -2.5562e+00, -4.6591e+00,         nan,         nan],
        [-3.2887e-01, -1.8545e+00,         nan,         nan,         nan,
                 nan,         nan,         nan,         nan, -6.1853e+00],
        [        nan, -4.7608e+00,  3.5690e-01,         nan,         nan,
         -3.3117e+00,         nan, -3.6426e+00,         nan,         nan],
        [-2.6063e+00,  8.7667e-03, -1.1688e+00,         nan, -8.3006e-01,
                 nan,         nan,         nan, -2.8002e+00,         nan],
        [-6.5494e+00,         nan, -6.0824e+00, -5.1816e+00, -1.2169e+00,
         -4.9843e+00, -5.2471e+00,         nan, -2.0449e+00, -2.7246e+00],
        [-3.3903e+00,  1.5740e+00,         nan, -1.6916e+00,         nan,
                 nan, -2.1206e+00, -5.1092e+00,         nan, -5.5805e+00],
        [        nan,         nan, -4.4310e+00, -3.5368e+00, -3.2439e+00,
                 nan, -4.1826e+00, -5.3769e+00, -3.6738e-01,         nan],
        [-4.2177e+00,         nan,         nan, -3.6193e+00,         nan,
         -3.3759e+00,  3.4593e+00,         nan,         nan,  5.4685e+00],
        [-3.6940e+00, -4.4312e+00, -8.9987e-01, -2.0332e+00,  1.0388e+00,
                 nan,         nan,         nan,         nan, -1.2108e+00],
        [-3.3912e+00, -3.4252e+00,         nan,         nan, -5.8306e+00,
                 nan,  1.2478e+00,         nan, -6.1592e+00,         nan],
        [        nan,         nan,         nan, -4.8705e+00,         nan,
          4.2100e+00, -6.7648e-01, -2.1734e+00,         nan, -3.7227e+00],
        [-4.4092e+00, -3.5956e+00, -1.0465e+00,         nan,         nan,
         -4.2762e+00, -6.3421e+00, -3.2727e+00,         nan,         nan],
        [        nan, -7.8789e+00, -2.9399e+00, -9.4482e+00, -6.6236e+00,
                 nan, -2.5003e+00, -3.3477e+00,         nan,         nan],
        [-4.9606e+00,         nan, -1.9732e+00, -1.6150e+00,         nan,
                 nan,         nan,         nan, -2.2729e+00,         nan],
        [        nan, -2.6050e+00,         nan, -4.9396e-02,         nan,
          2.7216e+00,         nan,         nan, -3.7328e+00, -6.7042e-01],
        [ 3.9412e-01, -3.2638e+00,         nan, -4.2766e+00,  3.7745e-01,
         -9.1380e+00,         nan,         nan,         nan, -5.3271e+00],
        [-1.3629e+00,         nan, -4.1160e+00,         nan,         nan,
                 nan,         nan, -3.2923e+00, -3.4510e+00,         nan],
        [        nan, -1.6663e+00,         nan, -4.3503e-01, -5.1977e+00,
          6.6591e-02, -3.5834e-01,         nan, -5.1552e+00, -6.2403e+00],
        [        nan, -3.2995e+00, -5.4693e-01,         nan, -5.3688e+00,
                 nan,         nan, -1.9024e+00, -1.8534e+00,  1.2597e+00],
        [        nan,         nan, -5.0898e+00,         nan,         nan,
                 nan, -3.4055e+00, -2.6834e+00,         nan,         nan],
        [ 5.6282e-01,         nan, -7.9931e+00,         nan,         nan,
                 nan,         nan,         nan,         nan, -1.2176e+01],
        [-7.7695e+00, -1.1636e+01,         nan,         nan,         nan,
         -8.8278e-02, -3.2852e+00,         nan, -6.5349e+00,  9.7152e+00],
        [        nan,         nan,         nan,         nan,         nan,
         -6.3835e+00, -4.0647e+00, -3.9835e+00,  5.7625e-01, -2.8484e+00],
        [        nan,         nan, -3.2028e-01, -3.9904e+00,         nan,
                 nan, -3.0386e+00,         nan, -2.6512e+00, -7.1161e-03],
        [-4.7407e-01, -1.8129e-01,         nan,         nan, -9.9984e-01,
                 nan, -7.0781e+00, -4.3260e+00,         nan,         nan],
        [        nan, -1.3338e+00, -7.4338e+00, -3.7102e+00,  2.1818e-01,
         -8.0975e+00, -1.0603e+01, -1.0163e+01,  1.8949e+00, -6.9030e+00],
        [        nan, -3.4706e+00,         nan,         nan,         nan,
                 nan,         nan, -1.3030e+00,         nan,         nan],
        [        nan, -4.1920e+00,         nan,         nan,         nan,
         -6.1148e+00, -8.7831e+00, -5.8274e+00, -3.2902e+00, -1.1183e+00],
        [ 2.8902e-02, -2.1984e+00,         nan, -5.1863e+00, -6.3952e+00,
         -7.2007e+00, -2.2951e+00,         nan,         nan, -4.1651e+00],
        [-7.9337e+00,         nan, -3.3115e+00, -3.7880e+00,         nan,
                 nan, -1.2550e+01, -4.6526e+00, -3.8061e-01,         nan],
        [        nan,         nan,         nan,         nan, -3.1006e+00,
         -1.0088e+00, -6.5533e-01,         nan, -3.4102e+00,         nan],
        [-3.6533e+00, -1.7507e+00,         nan,         nan, -5.7092e+00,
         -1.5757e+00,  5.5547e+00,  7.0222e-01, -4.2877e+00,         nan],
        [ 4.9376e-01,         nan, -5.0033e+00, -3.6642e+00,         nan,
         -1.8556e+00,         nan, -6.2923e+00, -2.1185e+00,         nan],
        [        nan,         nan,         nan, -4.4143e+00, -1.6468e+00,
                 nan,         nan, -1.1552e+00,         nan,         nan],
        [-5.7876e+00, -1.7824e+00, -4.5490e-01, -2.5792e-01,         nan,
         -1.0862e+00,         nan,  1.7383e+00,         nan,         nan],
        [        nan,         nan,         nan,         nan,         nan,
         -6.1896e+00, -4.3076e+00, -8.3521e-02,         nan, -2.8832e+00],
        [        nan,         nan, -3.4513e+00,  9.8537e-01,  2.1297e+00,
                 nan,         nan,         nan, -1.1612e+00,         nan],
        [        nan,         nan,         nan, -1.7456e+00,         nan,
                 nan,  1.0641e+00,         nan, -4.5182e+00,         nan],
        [-1.4305e+00,  9.7037e-01,         nan,  3.0612e-01, -4.3903e+00,
         -3.1949e+00, -1.2446e+00,         nan, -2.9667e+00, -8.9420e+00],
        [-2.6755e+00,         nan,         nan, -3.6448e+00, -1.0129e+00,
         -5.3764e+00,         nan, -4.3563e+00,         nan,         nan],
        [        nan,         nan, -2.0812e+00, -1.7250e+00,         nan,
         -3.7295e+00,  1.4498e+00,         nan,  3.0831e-01, -3.5334e+00],
        [-1.3590e+00, -7.3685e+00,         nan,         nan, -5.3494e+00,
         -5.5876e+00,         nan,         nan, -3.4156e+00, -1.6558e+00],
        [        nan,         nan,         nan, -3.8178e+00,         nan,
                 nan,         nan,         nan, -6.4946e+00,  3.6649e+00],
        [        nan,         nan, -1.9537e+00, -5.2543e+00,         nan,
                 nan, -3.4006e+00, -1.6907e+00,         nan, -2.7041e+00],
        [        nan,         nan, -3.2630e+00, -4.4340e+00, -7.7332e+00,
                 nan,         nan, -2.4860e+00,         nan,  2.7911e-01],
        [        nan, -6.4864e+00,         nan,         nan, -7.6792e-01,
                 nan,         nan, -3.4496e+00, -4.1828e+00, -1.2553e+00],
        [        nan, -7.5132e-01,         nan,         nan, -4.3850e+00,
                 nan,  1.0178e+00, -1.9984e+00, -7.1012e+00, -1.2813e+00],
        [-1.0243e+01, -5.7015e+00,         nan,         nan, -3.7788e+00,
         -2.0630e-01,         nan,  9.0008e-01, -7.4515e+00,  2.1192e+00],
        [        nan,         nan,         nan, -4.5565e+00,         nan,
          2.2640e+00,         nan, -1.3832e+00, -2.3747e+00,  1.4261e+00],
        [        nan,         nan,         nan, -6.8734e+00,         nan,
         -2.0299e-01, -6.1801e+00, -2.1181e+00, -3.9194e+00,         nan],
        [        nan, -4.4435e-01,         nan, -5.6697e+00, -2.1061e+00,
                 nan,         nan,         nan,         nan, -7.5760e+00],
        [        nan,         nan,         nan,         nan,         nan,
                 nan, -2.3671e-01, -3.3826e+00, -4.3018e+00,         nan]],
       grad_fn=&lt;SubBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask the matrix</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>diff_matrix[mask].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>torch.Size([526])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify the loss function to ignore NaN values</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> factorize(D, k):</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Factorize the matrix D into A and B"""</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly initialize A and B</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> torch.randn(D.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> torch.randn(D.shape[<span class="dv">1</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optimizer</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam([A, B], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>        diff_matrix <span class="op">=</span> torch.mm(A, B.t())<span class="op">-</span>D</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>        diff_vector <span class="op">=</span> diff_matrix[mask]</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> torch.norm(diff_vector)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Zero the gradients</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Backpropagate</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the parameters</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A, B, loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>A, B, loss <span class="op">=</span> factorize(D, <span class="dv">2</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>tensor(22.5991, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now use matrix factorization to predict the ratings</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a class for the model</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MatrixFactorization(nn.Module):</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n_users, n_movies, n_factors<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.user_factors <span class="op">=</span> nn.Embedding(n_users, n_factors)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.movie_factors <span class="op">=</span> nn.Embedding(n_movies, n_factors)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, user, movie):</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="va">self</span>.user_factors(user) <span class="op">*</span> <span class="va">self</span>.movie_factors(movie)).<span class="bu">sum</span>(<span class="dv">1</span>)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> MatrixFactorization(n_users, n_movies, <span class="dv">2</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>MatrixFactorization(
  (user_factors): Embedding(100, 2)
  (movie_factors): Embedding(10, 2)
)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>model(torch.tensor([<span class="dv">0</span>]), torch.tensor([<span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>tensor([2.0891], grad_fn=&lt;SumBackward1&gt;)</code></pre>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>