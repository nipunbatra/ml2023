<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nipun Batra">
<meta name="dcterms.date" content="2023-04-14">
<meta name="description" content="Movie Recommendation using KNN and Matrix Factorization">

<title>ES654 - Movie Recommendation using KNN and Matrix Factorization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ES654</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../grading.html">
 <span class="menu-text">Grading Policy</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../faq.html">
 <span class="menu-text">FAQs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../schedule.html">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../quizzes.html">
 <span class="menu-text">Quizzes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notebooks/index.html">
 <span class="menu-text">Notebooks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://nipunbatra.github.io">
 <span class="menu-text">Instructor Homepage</span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Movie Recommendation using KNN and Matrix Factorization</h1>
</div>

<div>
  <div class="description">
    Movie Recommendation using KNN and Matrix Factorization
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nipun Batra </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 14, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.figure_format <span class="op">=</span> <span class="st">'retina'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate some toy user and movie data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of users</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>n_users <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of movies</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>n_movies <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of ratings</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>n_ratings <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random user ids</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>user_ids <span class="op">=</span> np.random.randint(<span class="dv">0</span>, n_users, n_ratings)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random movie ids</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>movie_ids <span class="op">=</span> np.random.randint(<span class="dv">0</span>, n_movies, n_ratings)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random ratings</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">6</span>, n_ratings)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe with the data</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'user_id'</span>: user_ids, <span class="st">'movie_id'</span>: movie_ids, <span class="st">'rating'</span>: ratings})</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># We should not have any duplicate ratings for the same user and movie</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop any rows that have duplicate user_id and movie_id pairs</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop_duplicates([<span class="st">'user_id'</span>, <span class="st">'movie_id'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>user_id</th>
      <th>movie_id</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>42</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>89</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>86</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12</td>
      <td>6</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>80</td>
      <td>6</td>
      <td>3</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>981</th>
      <td>27</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>982</th>
      <td>1</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>984</th>
      <td>81</td>
      <td>4</td>
      <td>5</td>
    </tr>
    <tr>
      <th>988</th>
      <td>11</td>
      <td>7</td>
      <td>5</td>
    </tr>
    <tr>
      <th>997</th>
      <td>56</td>
      <td>4</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
<p>623 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a user-item matrix</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> df.pivot(index<span class="op">=</span><span class="st">'user_id'</span>, columns<span class="op">=</span><span class="st">'movie_id'</span>, values<span class="op">=</span><span class="st">'rating'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>movie_id</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>user_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>3.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>98</th>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>99</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in the missing values with zeros</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> A.fillna(<span class="dv">0</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>movie_id</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>user_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>3.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>98</th>
      <td>0.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cosine similarity between U1 and U2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># User 1</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>u1 <span class="op">=</span> A.loc[<span class="dv">0</span>]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># User 2</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>u2 <span class="op">=</span> A.loc[<span class="dv">1</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the dot product</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>dot <span class="op">=</span> np.dot(u1, u2)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the L2 norm</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>norm_u1 <span class="op">=</span> np.linalg.norm(u1)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>norm_u2 <span class="op">=</span> np.linalg.norm(u2)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the cosine similarity</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>cos_sim <span class="op">=</span> dot <span class="op">/</span> (norm_u1 <span class="op">*</span> norm_u2)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>cos_sim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>0.6602414870635759</code></pre>
</div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the cosine similarity between users</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>sim_matrix <span class="op">=</span> cosine_similarity(A)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(sim_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>90</th>
      <th>91</th>
      <th>92</th>
      <th>93</th>
      <th>94</th>
      <th>95</th>
      <th>96</th>
      <th>97</th>
      <th>98</th>
      <th>99</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.000000</td>
      <td>0.660241</td>
      <td>0.777679</td>
      <td>0.469409</td>
      <td>0.699862</td>
      <td>0.479770</td>
      <td>0.755574</td>
      <td>0.416966</td>
      <td>0.545591</td>
      <td>0.554525</td>
      <td>...</td>
      <td>0.583891</td>
      <td>0.888070</td>
      <td>0.424048</td>
      <td>0.299175</td>
      <td>0.603374</td>
      <td>0.503721</td>
      <td>0.430077</td>
      <td>0.434429</td>
      <td>0.461384</td>
      <td>0.666361</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.660241</td>
      <td>1.000000</td>
      <td>0.792212</td>
      <td>0.766282</td>
      <td>0.507726</td>
      <td>0.526331</td>
      <td>0.537985</td>
      <td>0.504328</td>
      <td>0.414964</td>
      <td>0.461888</td>
      <td>...</td>
      <td>0.250122</td>
      <td>0.782586</td>
      <td>0.194625</td>
      <td>0.269131</td>
      <td>0.480750</td>
      <td>0.514929</td>
      <td>0.132647</td>
      <td>0.907222</td>
      <td>0.272428</td>
      <td>0.350325</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.777679</td>
      <td>0.792212</td>
      <td>1.000000</td>
      <td>0.550823</td>
      <td>0.816830</td>
      <td>0.520153</td>
      <td>0.812736</td>
      <td>0.786007</td>
      <td>0.598532</td>
      <td>0.679392</td>
      <td>...</td>
      <td>0.540720</td>
      <td>0.721315</td>
      <td>0.156556</td>
      <td>0.510296</td>
      <td>0.723532</td>
      <td>0.792913</td>
      <td>0.391239</td>
      <td>0.729769</td>
      <td>0.515625</td>
      <td>0.626224</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.469409</td>
      <td>0.766282</td>
      <td>0.550823</td>
      <td>1.000000</td>
      <td>0.468293</td>
      <td>0.663451</td>
      <td>0.395348</td>
      <td>0.525726</td>
      <td>0.338742</td>
      <td>0.639021</td>
      <td>...</td>
      <td>0.420539</td>
      <td>0.754386</td>
      <td>0.544510</td>
      <td>0.413714</td>
      <td>0.350438</td>
      <td>0.459105</td>
      <td>0.404418</td>
      <td>0.650814</td>
      <td>0.569050</td>
      <td>0.356026</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.699862</td>
      <td>0.507726</td>
      <td>0.816830</td>
      <td>0.468293</td>
      <td>1.000000</td>
      <td>0.489525</td>
      <td>0.967349</td>
      <td>0.709197</td>
      <td>0.438397</td>
      <td>0.606478</td>
      <td>...</td>
      <td>0.733388</td>
      <td>0.561951</td>
      <td>0.447214</td>
      <td>0.588968</td>
      <td>0.742392</td>
      <td>0.676123</td>
      <td>0.486834</td>
      <td>0.489979</td>
      <td>0.721117</td>
      <td>0.614919</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>0.503721</td>
      <td>0.514929</td>
      <td>0.792913</td>
      <td>0.459105</td>
      <td>0.676123</td>
      <td>0.335847</td>
      <td>0.611577</td>
      <td>0.826380</td>
      <td>0.819761</td>
      <td>0.589453</td>
      <td>...</td>
      <td>0.500921</td>
      <td>0.538260</td>
      <td>0.037796</td>
      <td>0.690654</td>
      <td>0.722806</td>
      <td>1.000000</td>
      <td>0.622541</td>
      <td>0.542105</td>
      <td>0.311211</td>
      <td>0.774827</td>
    </tr>
    <tr>
      <th>96</th>
      <td>0.430077</td>
      <td>0.132647</td>
      <td>0.391239</td>
      <td>0.404418</td>
      <td>0.486834</td>
      <td>0.394961</td>
      <td>0.325482</td>
      <td>0.459922</td>
      <td>0.709876</td>
      <td>0.731717</td>
      <td>...</td>
      <td>0.593057</td>
      <td>0.475786</td>
      <td>0.340777</td>
      <td>0.729291</td>
      <td>0.452563</td>
      <td>0.622541</td>
      <td>1.000000</td>
      <td>0.067884</td>
      <td>0.491035</td>
      <td>0.823545</td>
    </tr>
    <tr>
      <th>97</th>
      <td>0.434429</td>
      <td>0.907222</td>
      <td>0.729769</td>
      <td>0.650814</td>
      <td>0.489979</td>
      <td>0.277054</td>
      <td>0.483494</td>
      <td>0.532327</td>
      <td>0.395437</td>
      <td>0.303915</td>
      <td>...</td>
      <td>0.024001</td>
      <td>0.525657</td>
      <td>0.000000</td>
      <td>0.236113</td>
      <td>0.428571</td>
      <td>0.542105</td>
      <td>0.067884</td>
      <td>1.000000</td>
      <td>0.196827</td>
      <td>0.298807</td>
    </tr>
    <tr>
      <th>98</th>
      <td>0.461384</td>
      <td>0.272428</td>
      <td>0.515625</td>
      <td>0.569050</td>
      <td>0.721117</td>
      <td>0.620299</td>
      <td>0.624518</td>
      <td>0.500069</td>
      <td>0.105939</td>
      <td>0.739759</td>
      <td>...</td>
      <td>0.644826</td>
      <td>0.465586</td>
      <td>0.658710</td>
      <td>0.365978</td>
      <td>0.311643</td>
      <td>0.311211</td>
      <td>0.491035</td>
      <td>0.196827</td>
      <td>1.000000</td>
      <td>0.391109</td>
    </tr>
    <tr>
      <th>99</th>
      <td>0.666361</td>
      <td>0.350325</td>
      <td>0.626224</td>
      <td>0.356026</td>
      <td>0.614919</td>
      <td>0.386334</td>
      <td>0.556215</td>
      <td>0.485866</td>
      <td>0.900638</td>
      <td>0.644160</td>
      <td>...</td>
      <td>0.542173</td>
      <td>0.628281</td>
      <td>0.350000</td>
      <td>0.518558</td>
      <td>0.657376</td>
      <td>0.774827</td>
      <td>0.823545</td>
      <td>0.298807</td>
      <td>0.391109</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 100 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap(sim_matrix, cmap<span class="op">=</span><span class="st">'Greys'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="movie-recommendation-knn-mf_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the most similar users to user u </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> k_nearest_neighbors(A, u, k):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find the k nearest neighbors for user u"""</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the index of the user in the matrix</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    u_index <span class="op">=</span> A.index.get_loc(u)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the similarity between the user and all other users</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    sim_matrix <span class="op">=</span> cosine_similarity(A)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the k most similar users</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    k_nearest <span class="op">=</span> np.argsort(sim_matrix[u_index])[::<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>:k<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the user ids</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A.index[k_nearest]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>k_nearest_neighbors(A, <span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>Int64Index([20, 91, 65, 12, 2], dtype='int64', name='user_id')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show matrix of movie ratings for u and k nearest neighbors</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_neighbors(A, u, k):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Show the movie ratings for user u and k nearest neighbors"""</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the user ids of the k nearest neighbors</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> k_nearest_neighbors(A, u, k)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the movie ratings for user u and the k nearest neighbors</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> A.loc[[u] <span class="op">+</span> <span class="bu">list</span>(neighbors)]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the dataframe</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>show_neighbors(A, <span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>movie_id</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>user_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>91</th>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>65</th>
      <td>2.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rating for user u for movie 0 is: (4.0 + 3.0) / 2 = 3.5 (Discard 0s)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict_rating(A, u, m, k<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Predict the rating for user u for movie m"""</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the user ids of the k nearest neighbors</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> k_nearest_neighbors(A, u, k)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the movie ratings for user u and the k nearest neighbors</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> A.loc[[u] <span class="op">+</span> <span class="bu">list</span>(neighbors)]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the ratings for movie m</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    ratings <span class="op">=</span> df[m]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the mean of the ratings</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> ratings[<span class="dv">1</span>:][ratings <span class="op">!=</span> <span class="dv">0</span>].mean()</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the mean</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>predict_rating(A, <span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>2.25</code></pre>
</div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now working with real data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">"mov-rec.xlsx"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Timestamp</th>
      <th>Your name</th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2023-04-11 10:58:44.990</td>
      <td>Nipun</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2023-04-11 10:59:49.617</td>
      <td>Gautam Vashishtha</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-04-11 11:12:44.033</td>
      <td>Eshan Gujarathi</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2023-04-11 11:13:48.674</td>
      <td>Sai Krishna Avula</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2023-04-11 11:13:55.658</td>
      <td>Ankit Yadav</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Discard the timestamp column</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'Timestamp'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the "Your Name" column the index</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.set_index(<span class="st">'Your name'</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
    <tr>
      <th>Your name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Nipun</th>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Gautam Vashishtha</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Eshan Gujarathi</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Sai Krishna Avula</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Ankit Yadav</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Dhruv</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Saatvik Rao</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Zeel B Patel</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Neel</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Sachin Jalan</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Ayush Shrivastava</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>....</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Hari Hara Sudhan</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Etikikota Hrushikesh</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Chirag</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Aaryan Darad</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Hetvi Patel</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Kalash Kankaria</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Rachit Verma</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>shriraj</th>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Bhavini Korthi</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Hitarth Gandhi</th>
      <td>3.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Radhika Joglekar</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Medhansh Singh</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Arun Mani</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Satyam</th>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Karan Kumar</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>R Yeeshu Dhurandhar</th>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Satyam Gupta</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>rushali</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>shridhar</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Tanvi Jain</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Manish Prabhubhai Salvi</th>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Varun Barala</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Kevin Shah</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Inderjeet</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Gangaram Siddam</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Aditi</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Madhuri Awachar</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Anupam</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Jinay</th>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Shrutimoy</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Aadesh Desai</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Dhairya</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Rahul C</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>Index(['Nipun', 'Gautam Vashishtha', 'Eshan Gujarathi', 'Sai Krishna Avula',
       'Ankit Yadav ', 'Dhruv', 'Saatvik Rao ', 'Zeel B Patel', 'Neel ',
       'Sachin Jalan ', 'Ayush Shrivastava', '....', 'Hari Hara Sudhan',
       'Etikikota Hrushikesh', 'Chirag', 'Aaryan Darad', 'Hetvi Patel',
       'Kalash Kankaria', 'Rachit Verma', 'shriraj', 'Bhavini Korthi ',
       'Hitarth Gandhi ', 'Radhika Joglekar ', 'Medhansh Singh', 'Arun Mani',
       'Satyam ', 'Karan Kumar ', 'R Yeeshu Dhurandhar', 'Satyam Gupta',
       'rushali', 'shridhar', 'Tanvi Jain ', 'Manish Prabhubhai Salvi ',
       'Varun Barala', 'Kevin Shah ', 'Inderjeet', 'Gangaram Siddam ', 'Aditi',
       'Madhuri Awachar', 'Anupam', 'Jinay', 'Shrutimoy', 'Aadesh Desai',
       'Dhairya', 'Rahul C'],
      dtype='object', name='Your name')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get index for user and movie</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>user <span class="op">=</span> <span class="st">'Rahul C'</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(user <span class="kw">in</span> df.index)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the movie ratings for user</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>user_ratings <span class="op">=</span> df.loc[user]</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>user_ratings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="83">
<pre><code>Sholay                      3.0
Swades (We The People)      3.0
The Matrix (I)              4.0
Interstellar                4.0
Dangal                      4.0
Taare Zameen Par            4.0
Shawshank Redemption        4.0
The Dark Knight             5.0
Notting Hill                NaN
Uri: The Surgical Strike    NaN
Name: Rahul C, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df_copy <span class="op">=</span> df.copy()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df_copy.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>show_neighbors(df_copy, user, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
    <tr>
      <th>Your name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Rahul C</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Shrutimoy</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Hitarth Gandhi</th>
      <td>3.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>R Yeeshu Dhurandhar</th>
      <td>5.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>shridhar</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Sachin Jalan</th>
      <td>4.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>39.000000</td>
      <td>32.000000</td>
      <td>38.000000</td>
      <td>43.000000</td>
      <td>45.000000</td>
      <td>44.000000</td>
      <td>35.000000</td>
      <td>40.000000</td>
      <td>21.000000</td>
      <td>39.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>4.102564</td>
      <td>3.718750</td>
      <td>4.131579</td>
      <td>4.581395</td>
      <td>3.644444</td>
      <td>3.977273</td>
      <td>4.400000</td>
      <td>4.250000</td>
      <td>3.476190</td>
      <td>4.230769</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.753758</td>
      <td>0.958304</td>
      <td>0.991070</td>
      <td>0.793802</td>
      <td>1.003529</td>
      <td>1.067242</td>
      <td>0.976187</td>
      <td>1.080123</td>
      <td>0.813575</td>
      <td>0.902089</td>
    </tr>
    <tr>
      <th>min</th>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>4.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>3.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>5.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the rating for user u for movie m</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>predict_rating(df_copy, user, <span class="st">'The Dark Knight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<pre><code>4.8</code></pre>
</div>
</div>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>predict_rating(df_copy, user, <span class="st">'Sholay'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<pre><code>4.4</code></pre>
</div>
</div>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic Matrix Factorization (without missing values)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># D is a matrix of size (n_users, n_movies) randomly generated values between 1 and 5</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> torch.randint(<span class="dv">1</span>, <span class="dv">6</span>, (n_users, n_movies), dtype<span class="op">=</span>torch.<span class="bu">float</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>D</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">
<pre><code>tensor([[4., 4., 2., 5., 2., 3., 5., 5., 3., 2.],
        [5., 3., 5., 1., 2., 3., 5., 5., 2., 3.],
        [1., 3., 4., 3., 1., 2., 5., 1., 4., 3.],
        [3., 5., 1., 2., 2., 2., 4., 2., 1., 1.],
        [2., 5., 3., 1., 2., 5., 4., 2., 4., 5.],
        [3., 5., 1., 1., 3., 1., 5., 3., 3., 3.],
        [1., 2., 5., 1., 1., 4., 3., 4., 4., 5.],
        [2., 5., 1., 4., 3., 1., 5., 3., 3., 1.],
        [4., 3., 2., 2., 4., 5., 5., 5., 3., 3.],
        [1., 2., 5., 1., 2., 1., 3., 5., 3., 3.],
        [3., 2., 3., 3., 2., 1., 5., 3., 1., 5.],
        [5., 5., 5., 3., 5., 4., 4., 2., 4., 5.],
        [5., 2., 2., 1., 4., 3., 3., 5., 3., 3.],
        [4., 4., 5., 4., 1., 1., 1., 1., 3., 1.],
        [2., 5., 5., 2., 4., 5., 1., 1., 4., 4.],
        [3., 2., 1., 2., 1., 1., 2., 1., 2., 2.],
        [5., 5., 3., 3., 3., 3., 4., 1., 4., 3.],
        [5., 2., 4., 4., 2., 1., 4., 4., 5., 5.],
        [3., 3., 4., 2., 2., 3., 4., 1., 3., 4.],
        [3., 5., 3., 5., 5., 4., 1., 3., 1., 4.],
        [2., 1., 2., 4., 5., 2., 2., 1., 1., 1.],
        [2., 4., 3., 1., 4., 4., 2., 4., 1., 4.],
        [5., 3., 2., 5., 1., 4., 3., 5., 3., 3.],
        [5., 3., 3., 5., 5., 4., 3., 1., 1., 4.],
        [4., 4., 1., 5., 2., 5., 5., 4., 5., 5.],
        [3., 1., 2., 3., 3., 5., 4., 4., 4., 3.],
        [4., 1., 2., 2., 4., 5., 4., 3., 4., 4.],
        [5., 2., 4., 2., 3., 1., 2., 4., 2., 1.],
        [5., 3., 1., 3., 2., 4., 1., 2., 1., 5.],
        [1., 2., 1., 3., 3., 2., 2., 5., 2., 4.],
        [3., 2., 4., 5., 4., 2., 2., 3., 5., 1.],
        [5., 5., 3., 3., 1., 3., 3., 4., 5., 4.],
        [5., 1., 3., 5., 4., 2., 3., 4., 3., 2.],
        [3., 2., 2., 3., 5., 5., 1., 1., 4., 1.],
        [3., 4., 4., 3., 5., 1., 5., 5., 4., 1.],
        [2., 5., 1., 5., 4., 2., 4., 1., 4., 5.],
        [5., 5., 2., 4., 2., 4., 4., 1., 2., 1.],
        [2., 5., 5., 1., 1., 4., 2., 4., 4., 5.],
        [4., 2., 2., 3., 3., 3., 3., 2., 2., 2.],
        [5., 2., 1., 4., 3., 1., 3., 1., 4., 5.],
        [4., 1., 3., 3., 5., 1., 1., 2., 4., 1.],
        [4., 4., 1., 1., 4., 2., 2., 3., 1., 3.],
        [3., 5., 4., 3., 1., 1., 4., 1., 3., 1.],
        [1., 2., 4., 1., 4., 2., 4., 1., 2., 5.],
        [4., 4., 1., 1., 5., 5., 3., 3., 3., 3.],
        [1., 1., 1., 5., 5., 2., 5., 2., 1., 4.],
        [3., 4., 4., 5., 2., 2., 3., 2., 5., 5.],
        [1., 2., 5., 3., 2., 1., 3., 1., 2., 5.],
        [5., 4., 4., 2., 4., 5., 4., 2., 3., 2.],
        [4., 2., 4., 5., 3., 2., 1., 4., 3., 3.],
        [4., 2., 3., 2., 1., 4., 5., 2., 1., 1.],
        [2., 3., 3., 5., 3., 4., 1., 5., 3., 2.],
        [3., 5., 5., 3., 2., 5., 4., 4., 4., 5.],
        [5., 3., 5., 5., 2., 5., 3., 3., 4., 3.],
        [4., 3., 1., 2., 5., 3., 3., 4., 4., 5.],
        [2., 2., 1., 1., 3., 5., 1., 2., 3., 5.],
        [1., 3., 5., 1., 3., 5., 3., 4., 4., 2.],
        [4., 5., 5., 3., 4., 1., 3., 3., 2., 5.],
        [1., 4., 4., 5., 2., 1., 3., 1., 1., 5.],
        [1., 2., 3., 3., 5., 4., 3., 5., 1., 4.],
        [1., 1., 5., 2., 1., 3., 5., 5., 4., 5.],
        [5., 1., 4., 4., 2., 3., 5., 4., 3., 4.],
        [4., 3., 2., 4., 3., 3., 4., 4., 5., 2.],
        [2., 5., 1., 2., 1., 1., 3., 2., 1., 4.],
        [5., 3., 3., 3., 2., 3., 1., 2., 2., 5.],
        [2., 2., 3., 5., 4., 4., 1., 2., 1., 2.],
        [5., 5., 4., 4., 4., 3., 2., 4., 2., 2.],
        [2., 5., 3., 5., 5., 2., 3., 4., 1., 3.],
        [4., 1., 4., 2., 4., 1., 4., 3., 4., 2.],
        [3., 3., 2., 1., 5., 2., 2., 2., 2., 5.],
        [2., 5., 2., 5., 4., 5., 4., 3., 4., 3.],
        [3., 1., 5., 4., 3., 2., 5., 3., 4., 1.],
        [5., 3., 1., 3., 2., 3., 1., 1., 1., 1.],
        [1., 4., 5., 2., 4., 5., 3., 2., 4., 5.],
        [4., 1., 4., 5., 3., 2., 3., 5., 5., 4.],
        [4., 2., 4., 3., 4., 5., 5., 5., 1., 5.],
        [3., 2., 1., 3., 2., 2., 4., 5., 5., 4.],
        [5., 5., 5., 1., 4., 1., 4., 4., 1., 3.],
        [5., 5., 5., 2., 2., 3., 2., 5., 3., 4.],
        [2., 4., 4., 4., 4., 5., 3., 1., 3., 2.],
        [5., 1., 2., 2., 1., 5., 4., 3., 2., 3.],
        [5., 1., 2., 5., 3., 5., 2., 4., 5., 4.],
        [2., 5., 5., 1., 4., 2., 2., 5., 4., 3.],
        [1., 3., 1., 2., 4., 3., 2., 3., 4., 4.],
        [2., 3., 5., 3., 3., 4., 4., 1., 5., 5.],
        [1., 5., 2., 4., 1., 5., 2., 1., 1., 1.],
        [4., 3., 5., 5., 3., 3., 3., 1., 1., 5.],
        [2., 2., 4., 3., 5., 2., 5., 2., 4., 1.],
        [2., 1., 1., 5., 1., 3., 2., 2., 3., 5.],
        [2., 2., 1., 5., 5., 4., 4., 1., 3., 2.],
        [5., 3., 3., 3., 3., 2., 1., 3., 4., 2.],
        [1., 1., 5., 4., 5., 1., 2., 1., 5., 5.],
        [3., 4., 4., 4., 5., 1., 5., 3., 2., 1.],
        [5., 5., 3., 1., 5., 1., 1., 1., 1., 3.],
        [3., 2., 4., 3., 2., 4., 2., 2., 3., 5.],
        [4., 2., 4., 5., 4., 3., 1., 2., 4., 3.],
        [1., 1., 2., 2., 4., 3., 5., 2., 4., 4.],
        [5., 1., 3., 1., 1., 5., 2., 1., 4., 1.],
        [1., 4., 1., 2., 5., 2., 2., 4., 1., 5.],
        [5., 3., 4., 5., 5., 4., 5., 1., 4., 1.]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>D.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">
<pre><code>torch.Size([100, 10])</code></pre>
</div>
</div>
<p>Let us decompose D as AB. A is of shape (n, k) and B is of shape (k, n). We can write the above equation as: D = AB</p>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly initialize A and B</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> torch.randn(n_users, <span class="dv">2</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> torch.randn(n_movies, <span class="dv">2</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the loss</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> torch.norm(torch.mm(A, B.t()) <span class="op">-</span> D)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>tensor(120.8659, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(torch.mm(A, B.t()).detach().numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="91">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.264860</td>
      <td>-1.512566</td>
      <td>-2.037402</td>
      <td>-1.262417</td>
      <td>-0.132023</td>
      <td>-1.027238</td>
      <td>3.666524</td>
      <td>2.496095</td>
      <td>-0.179421</td>
      <td>-0.089113</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.775146</td>
      <td>-1.131623</td>
      <td>-0.252141</td>
      <td>-1.085573</td>
      <td>-0.387802</td>
      <td>0.962701</td>
      <td>0.262229</td>
      <td>0.092588</td>
      <td>1.281358</td>
      <td>0.974351</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.072980</td>
      <td>0.693813</td>
      <td>0.178206</td>
      <td>0.662960</td>
      <td>0.232401</td>
      <td>-0.558108</td>
      <td>-0.206829</td>
      <td>-0.089713</td>
      <td>-0.759340</td>
      <td>-0.578063</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-2.261358</td>
      <td>-1.489118</td>
      <td>-0.446266</td>
      <td>-1.415824</td>
      <td>-0.484307</td>
      <td>1.111051</td>
      <td>0.568306</td>
      <td>0.281543</td>
      <td>1.558778</td>
      <td>1.188488</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-2.327101</td>
      <td>-1.577842</td>
      <td>-0.578746</td>
      <td>-1.488436</td>
      <td>-0.489104</td>
      <td>1.033144</td>
      <td>0.808672</td>
      <td>0.446056</td>
      <td>1.533820</td>
      <td>1.172646</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>0.050433</td>
      <td>-0.142864</td>
      <td>-0.453207</td>
      <td>-0.090314</td>
      <td>0.046777</td>
      <td>-0.451902</td>
      <td>0.854854</td>
      <td>0.599582</td>
      <td>-0.307123</td>
      <td>-0.221812</td>
    </tr>
    <tr>
      <th>96</th>
      <td>3.034490</td>
      <td>1.814688</td>
      <td>0.116038</td>
      <td>1.772819</td>
      <td>0.687387</td>
      <td>-1.936142</td>
      <td>0.141715</td>
      <td>0.253754</td>
      <td>-2.375615</td>
      <td>-1.798406</td>
    </tr>
    <tr>
      <th>97</th>
      <td>5.616947</td>
      <td>4.195326</td>
      <td>2.414580</td>
      <td>3.860471</td>
      <td>1.101509</td>
      <td>-1.555234</td>
      <td>-3.858034</td>
      <td>-2.407849</td>
      <td>-3.103768</td>
      <td>-2.401302</td>
    </tr>
    <tr>
      <th>98</th>
      <td>-1.941730</td>
      <td>-1.688903</td>
      <td>-1.462366</td>
      <td>-1.499716</td>
      <td>-0.332028</td>
      <td>-0.041199</td>
      <td>2.509351</td>
      <td>1.653427</td>
      <td>0.703850</td>
      <td>0.565434</td>
    </tr>
    <tr>
      <th>99</th>
      <td>1.936188</td>
      <td>1.340739</td>
      <td>0.555041</td>
      <td>1.257751</td>
      <td>0.401233</td>
      <td>-0.791799</td>
      <td>-0.810526</td>
      <td>-0.467291</td>
      <td>-1.232934</td>
      <td>-0.944662</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(D)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>98</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>5.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimizer</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam([A, B], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the loss</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> torch.norm(torch.mm(A, B.t()) <span class="op">-</span> D)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Zero the gradients</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Backpropagate</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the parameters</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the loss</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>115.35802459716797
111.52149200439453
108.49187469482422
106.08045959472656
103.93647766113281
101.58767700195312
98.55469512939453
94.49311828613281
89.3100814819336
83.21151733398438
76.62467956542969
70.03575134277344
63.89227294921875
58.51639175415039
54.00450897216797
50.31562805175781
47.390052795410156
45.16101837158203
43.53628158569336
42.39887619018555
41.624820709228516
41.10096740722656
40.736263275146484
40.46616744995117
40.25019073486328
40.065284729003906
39.89917755126953
39.74546432495117
39.60075759887695
39.463157653808594
39.331581115722656
39.20536422729492
39.08412170410156
38.96763610839844
38.855804443359375
38.748600006103516
38.64604568481445
38.548213958740234
38.45516586303711
38.36697769165039
38.28369903564453
38.20534896850586
38.131935119628906
38.06340789794922
37.99967956542969
37.940650939941406
37.88616180419922
37.8360481262207
37.790103912353516
37.748111724853516
37.70984649658203
37.6750602722168
37.64350128173828
37.61494827270508
37.589141845703125
37.56585693359375
37.54487609863281
37.5259895324707
37.50899124145508
37.49371337890625
37.479976654052734
37.467628479003906
37.45652389526367
37.44654083251953
37.437557220458984
37.42947006225586
37.422183990478516
37.415611267089844
37.40968322753906
37.404327392578125
37.39948272705078
37.39509582519531
37.391117095947266
37.387508392333984
37.38422393798828
37.3812370300293
37.37851333618164
37.37602615356445
37.37375259399414
37.37166213989258
37.369754791259766
37.36799621582031
37.36637878417969
37.364891052246094
37.36351013183594
37.362239837646484
37.361061096191406
37.35996627807617
37.35894775390625
37.35799789428711
37.357112884521484
37.356292724609375
37.35552215576172
37.354793548583984
37.354122161865234
37.353485107421875
37.35288619995117
37.352325439453125
37.3517951965332
37.351295471191406</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(torch.mm(A, B.t()).detach().numpy()).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.760296</td>
      <td>3.178874</td>
      <td>2.978039</td>
      <td>3.232967</td>
      <td>2.928783</td>
      <td>3.293471</td>
      <td>3.438638</td>
      <td>3.024349</td>
      <td>3.257597</td>
      <td>3.163118</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.100434</td>
      <td>3.274340</td>
      <td>3.823128</td>
      <td>3.091235</td>
      <td>2.616060</td>
      <td>3.863670</td>
      <td>1.691365</td>
      <td>3.049109</td>
      <td>3.051083</td>
      <td>2.469662</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(D).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> factorize(D, k):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Factorize the matrix D into A and B"""</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly initialize A and B</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> torch.randn(D.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> torch.randn(D.shape[<span class="dv">1</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optimizer</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam([A, B], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> torch.norm(torch.mm(A, B.t()) <span class="op">-</span> D)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Zero the gradients</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Backpropagate</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the parameters</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A, B, loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">9</span>]:</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    A, B, loss <span class="op">=</span> factorize(D, k)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(k, loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 41.327362060546875
2 37.35048294067383</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>KeyboardInterrupt: </code></pre>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(torch.mm(A, B.t()).detach().numpy()).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.793340</td>
      <td>3.182317</td>
      <td>3.004699</td>
      <td>3.226319</td>
      <td>2.927514</td>
      <td>3.308313</td>
      <td>3.400554</td>
      <td>3.022366</td>
      <td>3.250936</td>
      <td>3.144955</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.119824</td>
      <td>3.272779</td>
      <td>3.811543</td>
      <td>3.107022</td>
      <td>2.594617</td>
      <td>3.870888</td>
      <td>1.656050</td>
      <td>3.066180</td>
      <td>3.058107</td>
      <td>2.471609</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(D).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With missing values</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly replace some entries with NaN</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> torch.randint(<span class="dv">1</span>, <span class="dv">6</span>, (n_users, n_movies), dtype<span class="op">=</span>torch.<span class="bu">float</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>D[torch.rand(D.shape) <span class="op">&lt;</span> <span class="fl">0.5</span>] <span class="op">=</span> <span class="bu">float</span>(<span class="st">'nan'</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>D</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>tensor([[nan, nan, nan, 4., 4., 2., nan, 3., nan, 1.],
        [nan, nan, 3., nan, 2., nan, nan, 2., 4., 4.],
        [nan, 5., 5., nan, nan, nan, 1., 2., nan, nan],
        [5., 3., 5., nan, nan, nan, 4., 3., 4., nan],
        [nan, nan, 5., 3., 4., nan, nan, 3., 5., nan],
        [nan, 5., nan, 2., 1., 4., nan, 5., nan, nan],
        [nan, nan, nan, nan, 4., nan, nan, nan, nan, 4.],
        [4., 3., nan, nan, 3., nan, 1., nan, nan, 3.],
        [2., 4., 5., nan, 3., nan, 2., 2., nan, nan],
        [nan, 2., 1., nan, 2., nan, nan, nan, 3., 1.],
        [nan, nan, nan, nan, 1., 4., nan, 5., nan, 5.],
        [nan, nan, 4., 3., nan, nan, nan, nan, nan, 3.],
        [nan, 5., 2., 2., 4., nan, nan, 3., nan, nan],
        [5., nan, nan, 1., 4., 1., 3., nan, nan, nan],
        [nan, nan, nan, nan, 4., 5., nan, 1., 3., 1.],
        [1., nan, nan, 5., nan, nan, 4., 2., nan, nan],
        [4., nan, nan, nan, nan, nan, 1., nan, 4., nan],
        [1., nan, 4., nan, nan, nan, 5., nan, nan, 2.],
        [nan, 2., 1., nan, nan, 4., 2., 2., nan, 3.],
        [nan, nan, 3., nan, 3., 1., nan, 1., nan, nan],
        [nan, 5., nan, 2., 2., nan, 1., 3., 2., 3.],
        [3., nan, nan, 5., nan, 5., 1., 2., nan, nan],
        [nan, 4., nan, 3., 1., nan, nan, 4., 1., nan],
        [nan, nan, nan, 5., 3., nan, nan, nan, nan, 4.],
        [nan, 1., 5., nan, 3., nan, nan, 2., nan, nan],
        [nan, nan, 2., nan, 5., nan, nan, 1., 4., 4.],
        [nan, nan, nan, 5., 2., nan, nan, nan, nan, nan],
        [2., 5., 1., nan, nan, nan, nan, 1., 4., nan],
        [nan, 5., nan, nan, 2., 5., nan, 2., 3., nan],
        [1., nan, nan, nan, 5., nan, 2., nan, 1., nan],
        [nan, nan, 5., nan, 3., nan, 2., nan, 2., nan],
        [nan, nan, 3., 4., 1., nan, 5., nan, nan, nan],
        [nan, 2., nan, 1., 1., nan, nan, 3., nan, nan],
        [nan, nan, nan, nan, 2., nan, 1., 3., nan, nan],
        [4., nan, nan, 3., nan, 4., 5., 3., 1., nan],
        [4., 1., 5., nan, nan, nan, nan, 5., nan, 3.],
        [nan, 4., nan, 3., nan, nan, 3., 4., nan, nan],
        [2., 4., nan, 3., 4., 4., 1., nan, nan, nan],
        [nan, 2., nan, 5., nan, nan, 2., 1., 4., 1.],
        [2., nan, 5., 5., 4., nan, nan, nan, 5., 2.],
        [nan, nan, nan, nan, nan, 4., 2., 4., 4., nan],
        [5., nan, nan, 3., 1., nan, 1., 2., 1., 4.],
        [3., nan, nan, 2., 5., 4., nan, nan, nan, nan],
        [nan, 3., nan, nan, 2., 5., nan, nan, 2., nan],
        [1., 1., nan, 4., 5., 2., nan, 5., 5., nan],
        [nan, 4., nan, nan, 1., nan, nan, nan, 3., 4.],
        [4., nan, 5., 2., 5., nan, 1., nan, 1., 1.],
        [1., 4., 1., 4., 2., 1., 2., nan, 2., nan],
        [1., nan, 5., 3., nan, 5., 2., nan, nan, 4.],
        [4., 4., 5., nan, 2., nan, nan, nan, nan, 3.],
        [nan, 4., 5., nan, nan, nan, 3., 1., nan, nan],
        [nan, nan, 5., 1., 5., nan, 2., nan, 2., 2.],
        [4., nan, 5., 1., nan, 2., 5., nan, nan, nan],
        [nan, nan, 2., nan, 4., 2., 3., nan, 3., 5.],
        [4., nan, nan, nan, nan, nan, 4., nan, 3., 2.],
        [3., 3., nan, nan, 5., 2., nan, nan, nan, 4.],
        [5., nan, nan, nan, 3., nan, nan, nan, 1., nan],
        [nan, nan, 4., nan, nan, nan, nan, 4., nan, 4.],
        [5., 2., 2., 2., 5., nan, nan, 3., nan, nan],
        [2., nan, nan, 2., 1., 1., nan, 3., 2., 5.],
        [5., nan, nan, nan, 4., 5., nan, nan, 2., 2.],
        [nan, nan, 3., 1., nan, nan, 2., nan, nan, 2.],
        [nan, 2., 3., nan, 4., 3., 2., 1., nan, 1.],
        [4., nan, 4., 3., 2., nan, 2., nan, 2., 5.],
        [nan, 1., 3., 5., 5., 4., nan, nan, 3., nan],
        [5., nan, 5., nan, nan, 3., nan, 5., nan, 1.],
        [nan, nan, 5., nan, nan, 2., 3., nan, nan, nan],
        [nan, nan, 4., 4., 1., 4., nan, nan, nan, 5.],
        [nan, nan, 1., nan, nan, 4., nan, nan, nan, 1.],
        [nan, nan, nan, nan, 1., nan, 3., 3., nan, nan],
        [nan, nan, 1., 1., nan, 5., 5., nan, 1., 5.],
        [nan, nan, nan, 3., nan, 4., 1., nan, nan, nan],
        [nan, nan, 3., 2., nan, nan, nan, nan, 2., 4.],
        [1., 5., nan, 5., nan, 4., 4., nan, nan, 3.],
        [nan, nan, nan, 2., nan, 5., 5., 2., nan, nan],
        [nan, 5., 5., 2., nan, 3., 5., nan, nan, nan],
        [1., 4., nan, nan, nan, nan, nan, 1., 5., nan],
        [nan, nan, nan, nan, nan, 5., 2., 5., 5., 1.],
        [5., nan, 2., 3., nan, 4., nan, nan, 5., 3.],
        [3., nan, nan, nan, 5., 2., nan, nan, nan, nan],
        [nan, nan, nan, nan, 1., 1., nan, 1., 3., nan],
        [4., 2., 4., 4., 1., nan, 2., nan, 4., 4.],
        [1., 1., nan, nan, nan, nan, 2., nan, 5., nan],
        [2., 5., nan, 5., 3., 5., nan, nan, nan, nan],
        [3., nan, nan, 1., nan, 3., 4., 5., 3., 4.],
        [5., 2., nan, nan, 3., 1., 2., nan, 1., nan],
        [1., nan, nan, nan, 1., nan, 2., nan, nan, 2.],
        [1., 5., 1., 5., 5., 2., nan, 1., nan, 3.],
        [nan, nan, nan, nan, 1., 4., 1., 2., nan, nan],
        [2., nan, 4., nan, 5., nan, 2., nan, nan, 5.],
        [nan, nan, 5., nan, nan, nan, nan, nan, nan, nan],
        [3., 5., nan, nan, nan, nan, 5., nan, 4., 4.],
        [2., 2., nan, nan, 3., 5., nan, nan, 4., nan],
        [2., nan, 3., nan, 5., nan, nan, nan, nan, nan],
        [nan, nan, nan, nan, 2., 5., 4., 3., nan, 3.],
        [nan, 3., nan, nan, nan, 3., 3., 5., nan, nan],
        [nan, 4., nan, nan, nan, 5., nan, nan, nan, nan],
        [2., 5., nan, nan, nan, 3., 2., 4., nan, nan],
        [1., 4., nan, 4., 5., 3., nan, nan, 1., nan],
        [4., nan, nan, 5., 4., 1., 5., nan, 4., nan]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>A, B, loss <span class="op">=</span> factorize(D, <span class="dv">2</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="98">
<pre><code>tensor(nan, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> <span class="op">~</span>torch.isnan(D)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>mask</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>tensor([[False, False, False,  True,  True,  True, False,  True, False,  True],
        [False, False,  True, False,  True, False, False,  True,  True,  True],
        [False,  True,  True, False, False, False,  True,  True, False, False],
        [ True,  True,  True, False, False, False,  True,  True,  True, False],
        [False, False,  True,  True,  True, False, False,  True,  True, False],
        [False,  True, False,  True,  True,  True, False,  True, False, False],
        [False, False, False, False,  True, False, False, False, False,  True],
        [ True,  True, False, False,  True, False,  True, False, False,  True],
        [ True,  True,  True, False,  True, False,  True,  True, False, False],
        [False,  True,  True, False,  True, False, False, False,  True,  True],
        [False, False, False, False,  True,  True, False,  True, False,  True],
        [False, False,  True,  True, False, False, False, False, False,  True],
        [False,  True,  True,  True,  True, False, False,  True, False, False],
        [ True, False, False,  True,  True,  True,  True, False, False, False],
        [False, False, False, False,  True,  True, False,  True,  True,  True],
        [ True, False, False,  True, False, False,  True,  True, False, False],
        [ True, False, False, False, False, False,  True, False,  True, False],
        [ True, False,  True, False, False, False,  True, False, False,  True],
        [False,  True,  True, False, False,  True,  True,  True, False,  True],
        [False, False,  True, False,  True,  True, False,  True, False, False],
        [False,  True, False,  True,  True, False,  True,  True,  True,  True],
        [ True, False, False,  True, False,  True,  True,  True, False, False],
        [False,  True, False,  True,  True, False, False,  True,  True, False],
        [False, False, False,  True,  True, False, False, False, False,  True],
        [False,  True,  True, False,  True, False, False,  True, False, False],
        [False, False,  True, False,  True, False, False,  True,  True,  True],
        [False, False, False,  True,  True, False, False, False, False, False],
        [ True,  True,  True, False, False, False, False,  True,  True, False],
        [False,  True, False, False,  True,  True, False,  True,  True, False],
        [ True, False, False, False,  True, False,  True, False,  True, False],
        [False, False,  True, False,  True, False,  True, False,  True, False],
        [False, False,  True,  True,  True, False,  True, False, False, False],
        [False,  True, False,  True,  True, False, False,  True, False, False],
        [False, False, False, False,  True, False,  True,  True, False, False],
        [ True, False, False,  True, False,  True,  True,  True,  True, False],
        [ True,  True,  True, False, False, False, False,  True, False,  True],
        [False,  True, False,  True, False, False,  True,  True, False, False],
        [ True,  True, False,  True,  True,  True,  True, False, False, False],
        [False,  True, False,  True, False, False,  True,  True,  True,  True],
        [ True, False,  True,  True,  True, False, False, False,  True,  True],
        [False, False, False, False, False,  True,  True,  True,  True, False],
        [ True, False, False,  True,  True, False,  True,  True,  True,  True],
        [ True, False, False,  True,  True,  True, False, False, False, False],
        [False,  True, False, False,  True,  True, False, False,  True, False],
        [ True,  True, False,  True,  True,  True, False,  True,  True, False],
        [False,  True, False, False,  True, False, False, False,  True,  True],
        [ True, False,  True,  True,  True, False,  True, False,  True,  True],
        [ True,  True,  True,  True,  True,  True,  True, False,  True, False],
        [ True, False,  True,  True, False,  True,  True, False, False,  True],
        [ True,  True,  True, False,  True, False, False, False, False,  True],
        [False,  True,  True, False, False, False,  True,  True, False, False],
        [False, False,  True,  True,  True, False,  True, False,  True,  True],
        [ True, False,  True,  True, False,  True,  True, False, False, False],
        [False, False,  True, False,  True,  True,  True, False,  True,  True],
        [ True, False, False, False, False, False,  True, False,  True,  True],
        [ True,  True, False, False,  True,  True, False, False, False,  True],
        [ True, False, False, False,  True, False, False, False,  True, False],
        [False, False,  True, False, False, False, False,  True, False,  True],
        [ True,  True,  True,  True,  True, False, False,  True, False, False],
        [ True, False, False,  True,  True,  True, False,  True,  True,  True],
        [ True, False, False, False,  True,  True, False, False,  True,  True],
        [False, False,  True,  True, False, False,  True, False, False,  True],
        [False,  True,  True, False,  True,  True,  True,  True, False,  True],
        [ True, False,  True,  True,  True, False,  True, False,  True,  True],
        [False,  True,  True,  True,  True,  True, False, False,  True, False],
        [ True, False,  True, False, False,  True, False,  True, False,  True],
        [False, False,  True, False, False,  True,  True, False, False, False],
        [False, False,  True,  True,  True,  True, False, False, False,  True],
        [False, False,  True, False, False,  True, False, False, False,  True],
        [False, False, False, False,  True, False,  True,  True, False, False],
        [False, False,  True,  True, False,  True,  True, False,  True,  True],
        [False, False, False,  True, False,  True,  True, False, False, False],
        [False, False,  True,  True, False, False, False, False,  True,  True],
        [ True,  True, False,  True, False,  True,  True, False, False,  True],
        [False, False, False,  True, False,  True,  True,  True, False, False],
        [False,  True,  True,  True, False,  True,  True, False, False, False],
        [ True,  True, False, False, False, False, False,  True,  True, False],
        [False, False, False, False, False,  True,  True,  True,  True,  True],
        [ True, False,  True,  True, False,  True, False, False,  True,  True],
        [ True, False, False, False,  True,  True, False, False, False, False],
        [False, False, False, False,  True,  True, False,  True,  True, False],
        [ True,  True,  True,  True,  True, False,  True, False,  True,  True],
        [ True,  True, False, False, False, False,  True, False,  True, False],
        [ True,  True, False,  True,  True,  True, False, False, False, False],
        [ True, False, False,  True, False,  True,  True,  True,  True,  True],
        [ True,  True, False, False,  True,  True,  True, False,  True, False],
        [ True, False, False, False,  True, False,  True, False, False,  True],
        [ True,  True,  True,  True,  True,  True, False,  True, False,  True],
        [False, False, False, False,  True,  True,  True,  True, False, False],
        [ True, False,  True, False,  True, False,  True, False, False,  True],
        [False, False,  True, False, False, False, False, False, False, False],
        [ True,  True, False, False, False, False,  True, False,  True,  True],
        [ True,  True, False, False,  True,  True, False, False,  True, False],
        [ True, False,  True, False,  True, False, False, False, False, False],
        [False, False, False, False,  True,  True,  True,  True, False,  True],
        [False,  True, False, False, False,  True,  True,  True, False, False],
        [False,  True, False, False, False,  True, False, False, False, False],
        [ True,  True, False, False, False,  True,  True,  True, False, False],
        [ True,  True, False,  True,  True,  True, False, False,  True, False],
        [ True, False, False,  True,  True,  True,  True, False,  True, False]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>mask.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>tensor(522)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> torch.randn(D.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> torch.randn(D.shape[<span class="dv">1</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>diff_matrix <span class="op">=</span> torch.mm(A, B.t())<span class="op">-</span>D</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>diff_matrix.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>torch.Size([100, 10])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask the matrix</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>diff_matrix[mask].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>torch.Size([522])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify the loss function to ignore NaN values</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> factorize(D, k):</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Factorize the matrix D into A and B"""</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly initialize A and B</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> torch.randn(D.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> torch.randn(D.shape[<span class="dv">1</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optimizer</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam([A, B], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>        diff_matrix <span class="op">=</span> torch.mm(A, B.t())<span class="op">-</span>D</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>        diff_vector <span class="op">=</span> diff_matrix[mask]</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> torch.norm(diff_vector)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Zero the gradients</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Backpropagate</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the parameters</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A, B, loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>A, B, loss <span class="op">=</span> factorize(D, <span class="dv">5</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>tensor(8.3795, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>torch.mm(A, B.t())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>tensor([[ 1.0002e+00, -6.1860e-01,  1.6844e+00,  9.9991e-01, -2.2450e+00,
         -4.0025e-01, -9.3873e-01,  4.5819e+00,  8.8804e-01,  2.8812e-01],
        [ 3.4045e+00,  4.3689e+00,  3.4459e+00,  7.1197e+00,  2.2094e+00,
          3.5827e+00,  6.9298e-01,  3.9435e+00,  3.7188e+00,  3.8646e+00],
        [ 1.8525e+00,  3.5934e+00,  2.3619e+00,  6.9679e+00,  2.2771e+00,
          3.0910e+00,  6.2187e-01,  7.6504e-01,  2.4307e+00,  4.5831e+00],
        [ 2.5042e+00,  2.7107e+00,  2.6498e+00,  1.0070e+00,  3.5360e+00,
          4.0030e+00,  2.0012e+00,  2.9972e+00,  2.6560e+00,  3.0001e+00],
        [-2.0035e+00, -7.5789e-01,  4.0035e+00, -2.6083e+00,  2.0150e+00,
         -3.2294e+00,  3.9778e+00,  1.5164e+00,  2.0601e+00,  1.9979e+00],
        [ 3.3313e+00,  5.0005e+00,  2.9979e+00,  1.9324e+00,  6.2719e+00,
          5.0010e+00,  3.4474e+00,  1.9747e+00,  3.9212e+00,  3.0002e+00],
        [ 2.4918e+00, -8.6924e-01,  2.9974e+00,  3.9993e+00, -3.6196e+00,
          3.3461e+00, -2.6180e+00,  7.8752e+00,  1.0047e+00,  4.7184e+00],
        [ 4.0137e+00,  5.0133e+00, -3.1814e-01,  5.7423e-01,  1.9839e+00,
         -1.9341e+00,  1.0108e+00,  2.9967e+00,  3.5993e+00, -8.8937e+00],
        [ 1.8884e+00,  3.0018e+00,  1.9986e+00,  3.6214e+00,  1.3445e+00,
         -8.3828e-02,  9.5663e-01,  2.3653e+00,  2.7723e+00, -3.0290e-01],
        [ 3.0752e+00,  9.4665e-01,  4.2899e+00, -4.5431e+00,  2.8226e+00,
          2.9628e+00,  3.0004e+00,  8.1094e+00,  3.4849e+00,  1.0188e+00],
        [ 2.9752e+00,  3.0103e+00, -1.8524e+00,  5.1349e-01,  9.8893e-01,
          1.0100e+00, -6.7139e-01,  6.4309e-01,  1.0123e+00, -5.1665e+00],
        [ 2.4924e+00,  1.6909e+00,  6.5299e+00,  2.1961e+00,  1.5871e+00,
          1.9187e+00,  2.5060e+00,  8.5766e+00,  4.5608e+00,  4.9586e+00],
        [ 3.7808e+00,  5.4975e+00,  4.4300e+00,  7.1002e+00,  3.5630e+00,
          2.9987e+00,  1.9959e+00,  4.5226e+00,  5.0039e+00,  3.2930e+00],
        [ 4.1509e+00,  2.9077e+00,  4.4567e+00,  1.6394e+00,  1.6263e+00,
          2.7120e+00,  1.4758e+00,  8.4248e+00,  4.3598e+00,  1.2115e+00],
        [ 1.3388e+00,  2.8519e+00,  3.6300e+00, -2.3746e-01,  5.0226e+00,
          2.0026e+00,  3.9996e+00,  1.9982e+00,  3.3924e+00,  2.7614e+00],
        [ 2.0062e+00,  3.4421e+00,  3.3045e+00,  3.3703e+00,  4.1875e+00,
          3.7794e+00,  2.4669e+00,  1.8015e+00,  3.0830e+00,  4.6786e+00],
        [ 1.9932e+00,  5.4306e+00,  2.6564e+00,  3.9896e+00,  2.9713e+00,
         -4.4742e+00,  3.0714e+00,  1.9850e+00,  5.0565e+00, -5.1447e+00],
        [ 9.7504e-01,  5.0209e+00,  5.1434e+00,  7.9740e+00,  4.0114e+00,
         -8.0306e-01,  3.5290e+00,  1.2679e+00,  4.9996e+00,  4.0012e+00],
        [ 2.9039e+00,  4.2371e+00,  5.1783e+00,  1.4304e+01, -6.2558e-01,
          2.9950e+00, -1.1585e+00,  4.9986e+00,  4.0041e+00,  8.1423e+00],
        [ 2.8765e+00,  3.6266e+00,  3.5521e+00,  3.5769e+00,  3.3101e+00,
          3.4339e+00,  1.9543e+00,  3.7925e+00,  3.5855e+00,  3.3947e+00],
        [ 3.1678e+00,  4.4892e+00,  4.0685e+00,  4.2476e+00,  3.7637e+00,
          2.5998e+00,  2.4894e+00,  4.1890e+00,  4.4521e+00,  2.5758e+00],
        [ 4.6850e+00,  5.1159e+00, -1.6040e+00,  2.1407e+00,  2.4447e+00,
          2.7884e+00, -4.1521e-01,  1.3369e+00,  2.1819e+00, -5.2731e+00],
        [ 4.3464e+00,  4.2727e+00,  1.2831e+00,  9.1247e-01,  4.8015e+00,
          6.7635e+00,  1.5292e+00,  2.7263e+00,  2.6805e+00,  1.8472e+00],
        [ 5.0499e+00,  3.7718e+00,  3.2828e+00,  1.8760e+00,  2.4281e+00,
          4.7329e+00,  9.9891e-01,  7.4524e+00,  4.0032e+00,  1.0007e+00],
        [ 3.1683e+00, -4.8069e+00,  4.1563e+00, -2.2212e+01,  3.1175e+00,
          4.8951e+00,  4.9131e+00,  1.3957e+01,  1.7452e+00, -2.0775e+00],
        [ 4.9331e+00,  9.8587e+00,  2.0322e+00,  6.3511e+00,  1.1053e+00,
         -1.3336e+01,  2.8553e+00,  5.8145e+00,  8.9757e+00, -1.9562e+01],
        [ 9.5013e-01,  2.2910e+00,  4.5609e+00,  2.4319e+00,  3.0765e+00,
          8.9028e-01,  3.0615e+00,  3.1779e+00,  3.5110e+00,  4.0518e+00],
        [ 1.5621e+00,  3.5200e-01,  2.2187e+00, -6.1495e-01,  2.0550e+00,
          5.0016e+00,  1.0059e+00,  3.0014e+00,  9.9065e-01,  5.0016e+00],
        [ 1.0132e+00,  9.9005e-01,  2.9984e+00,  3.0045e+00,  2.0013e+00,
          4.6599e+00,  9.4810e-01,  1.9943e+00,  1.3488e+00,  7.2230e+00],
        [ 1.0710e+00,  3.9048e+00,  7.0985e+00,  9.8046e+00,  2.7144e+00,
          9.9892e-01,  2.8371e+00,  3.9444e+00,  5.1068e+00,  8.5642e+00],
        [ 2.9798e+00,  6.6238e+00,  3.9980e+00,  1.9979e+00,  4.8557e+00,
         -4.9116e+00,  4.9889e+00,  4.0151e+00,  6.8644e+00, -6.7965e+00],
        [ 2.6444e+00,  5.0009e+00,  1.9984e+00,  8.4371e+00,  3.1761e+00,
          4.0003e+00,  5.9719e-01,  1.1233e-01,  2.8453e+00,  4.3426e+00],
        [ 4.9523e+00,  5.0456e+00,  9.8821e-01,  1.1904e+00,  2.4383e+00,
          1.0191e+00,  1.0017e+00,  5.0290e+00,  4.0249e+00, -5.5541e+00],
        [ 1.2343e+00,  2.6635e+00,  6.2834e+00,  2.4751e+00,  2.9971e+00,
         -8.9346e-01,  3.9848e+00,  5.6039e+00,  5.0170e+00,  3.1984e+00],
        [ 7.3295e+00,  4.9896e+00,  3.0382e+00,  2.0068e+00,  4.8380e+00,
          1.1694e+01,  7.3273e-01,  7.9437e+00,  3.8515e+00,  4.9996e+00],
        [-8.1543e-01,  3.9929e+00,  1.9948e+00,  2.0048e+00,  7.6522e+00,
          2.0035e+00,  5.0092e+00, -5.3936e+00,  2.2828e+00,  4.6745e+00],
        [ 2.4622e+00,  5.9762e+00,  5.4107e+00,  9.1516e+00,  4.0038e+00,
          6.4204e-01,  3.0174e+00,  2.9985e+00,  5.6616e+00,  3.9994e+00],
        [ 5.2110e+00,  5.8611e+00,  2.4634e+00,  5.0137e+00,  3.8820e+00,
          5.0464e+00,  1.1397e+00,  4.4904e+00,  4.2950e+00,  9.7386e-01],
        [ 4.5880e-01,  1.0057e+00,  1.2943e+00, -5.0455e+00,  1.2572e+00,
         -5.5712e+00,  2.9910e+00,  2.9993e+00,  2.6805e+00, -7.6303e+00],
        [ 1.7154e+00,  2.7432e+00,  2.2357e+00,  2.1176e+00,  4.0797e+00,
          4.5664e+00,  2.0245e+00,  7.0967e-01,  2.0460e+00,  4.6899e+00],
        [ 2.9886e+00,  1.6741e+00,  9.7626e-01, -4.9624e+00,  3.2646e+00,
          2.9619e+00,  2.0996e+00,  4.0057e+00,  2.0244e+00, -2.1930e+00],
        [-2.9729e+00,  3.1319e-01,  3.7236e+00,  3.3254e+00,  1.0136e+00,
         -5.0190e+00,  2.9824e+00, -1.2713e+00,  1.9980e+00,  2.9977e+00],
        [ 1.5646e+00,  2.5216e+00,  3.5026e+00,  1.0177e+00,  4.0812e+00,
          2.9980e+00,  2.9738e+00,  2.3976e+00,  2.9533e+00,  3.9814e+00],
        [ 1.1377e+00, -7.9534e-02,  3.6606e+00, -1.7493e+00,  1.0072e+00,
          1.0560e+00,  1.8801e+00,  5.4316e+00,  2.2340e+00,  2.2851e+00],
        [ 2.7395e+00,  4.2341e+00,  5.3765e+00,  8.3817e+00,  2.5022e+00,
          3.1207e+00,  1.6137e+00,  4.6686e+00,  4.5147e+00,  6.4826e+00],
        [ 5.0039e+00,  5.2292e+00,  5.3792e+00,  4.9980e+00,  3.9950e+00,
          5.0192e+00,  2.3338e+00,  7.4932e+00,  5.5430e+00,  4.0016e+00],
        [ 4.1034e+00,  4.9254e+00,  2.9669e+00,  3.8318e+00,  4.4845e+00,
          5.2453e+00,  1.9372e+00,  3.6188e+00,  3.8836e+00,  2.9346e+00],
        [ 2.7524e+00,  1.9983e+00,  3.0011e+00, -3.2032e+00,  3.8101e+00,
          3.0059e+00,  3.0024e+00,  4.9954e+00,  3.0806e+00,  5.4398e-01],
        [ 1.7170e+00,  3.1087e+00,  4.7616e+00,  3.3576e+00,  2.0605e+00,
         -1.3493e+00,  2.7543e+00,  4.8920e+00,  4.5341e+00,  9.0290e-01],
        [ 4.0465e+00,  2.5043e+00,  9.9836e-01,  1.0001e+00,  9.9855e-01,
          4.0019e+00, -3.8940e-01,  5.0006e+00,  2.0672e+00, -4.7615e-01],
        [ 4.3963e+00,  4.6748e+00, -2.2637e-01,  1.9547e+01, -5.7685e+00,
          2.9123e+00, -7.2256e+00,  2.8164e+00,  1.2482e+00,  3.0466e+00],
        [ 1.8831e+00,  3.2841e+00,  4.0538e+00,  4.7681e+00,  2.8000e+00,
          1.9749e+00,  2.0825e+00,  3.1375e+00,  3.5871e+00,  4.1210e+00],
        [ 5.2524e+00,  2.9996e+00,  4.9944e+00,  2.0011e+00,  1.5771e+00,
          5.0016e+00,  1.0100e+00,  1.0275e+01,  4.5709e+00,  2.8167e+00],
        [ 4.0196e+00,  9.7914e-01,  7.6036e+00, -8.5030e+00,  5.0027e+00,
          3.6480e+00,  5.8612e+00,  1.2776e+01,  5.7694e+00,  1.9990e+00],
        [ 6.9952e-01,  4.8144e-01,  4.6375e+00, -1.1169e+00,  1.9977e+00,
          2.8582e-01,  2.9994e+00,  5.0373e+00,  3.0041e+00,  2.9873e+00],
        [ 3.0164e+00,  2.7781e+00,  1.4268e+00,  1.0004e+00,  3.1666e+00,
          4.9979e+00,  1.0501e+00,  2.4987e+00,  1.9833e+00,  2.2796e+00],
        [ 5.7559e+00,  4.9924e+00,  9.6477e-01,  7.2380e-01,  5.0034e+00,
          8.2238e+00,  1.1047e+00,  4.0024e+00,  2.9928e+00,  9.9998e-01],
        [ 1.9086e+00,  4.3765e+00,  3.6471e+00, -1.8230e-02,  7.1279e+00,
          3.0536e+00,  5.0289e+00,  1.0045e+00,  4.0867e+00,  2.8153e+00],
        [ 8.0839e-01,  3.2813e+00,  2.8462e+00,  4.1885e+00,  4.5646e+00,
          3.3629e+00,  2.6508e+00, -7.9362e-01,  2.4387e+00,  5.7568e+00],
        [ 2.1391e+00,  2.7862e+00,  2.0157e+00,  3.7075e+00,  1.4357e+00,
          1.5206e+00,  6.5361e-01,  2.5565e+00,  2.4614e+00,  1.2083e+00],
        [ 3.8541e+00,  3.7919e+00,  1.1576e+00, -4.1922e+00,  4.8565e+00,
          2.1025e+00,  3.1566e+00,  3.8267e+00,  3.4599e+00, -4.4144e+00],
        [ 4.4749e+00,  2.6216e+00,  5.2107e+00,  8.0413e-01,  2.6066e+00,
          5.2284e+00,  1.9287e+00,  9.1641e+00,  4.3544e+00,  3.9514e+00],
        [-6.2355e-01,  2.9661e+00,  1.4762e+00, -1.5889e+00,  7.0237e+00,
          1.1637e+00,  5.0129e+00, -3.9864e+00,  1.9879e+00,  1.9999e+00],
        [-2.0532e+00,  9.4436e-01,  1.0788e+00, -1.5112e+00,  5.2766e+00,
          1.0112e+00,  3.9423e+00, -4.9127e+00,  4.3571e-01,  3.9691e+00],
        [ 2.5509e+00,  3.9951e+00,  4.4605e+00,  7.9626e+00,  1.9209e+00,
          2.3589e+00,  1.1325e+00,  3.9963e+00,  4.0115e+00,  4.9989e+00],
        [ 4.4588e+00,  4.1568e+00,  6.3874e-01,  4.7680e+00,  1.7098e+00,
          5.1372e+00, -8.1905e-01,  3.2126e+00,  2.2777e+00,  8.1924e-01],
        [ 4.0590e+00,  4.8974e+00,  2.2936e+00,  5.0399e+00,  3.7705e+00,
          5.3666e+00,  1.0653e+00,  2.9172e+00,  3.3719e+00,  2.9769e+00],
        [ 1.9058e+00,  2.3902e+00,  1.9088e+00, -2.7564e+00,  5.0644e+00,
          3.5114e+00,  3.3203e+00,  1.5425e+00,  2.3176e+00,  1.2948e+00],
        [ 4.5764e+00,  2.9666e+00,  5.4040e+00, -3.4611e+00,  4.9879e+00,
          4.9381e+00,  4.0789e+00,  9.1713e+00,  5.0415e+00,  2.0002e+00],
        [ 8.1217e-01,  9.9974e-01,  3.0004e+00,  2.8712e+00,  6.2371e-01,
          1.0238e+00,  8.6280e-01,  2.9506e+00,  1.9404e+00,  3.5027e+00],
        [ 8.6320e-01,  5.2823e-01,  6.2913e+00,  5.0601e+00,  1.5222e+00,
          4.8221e+00,  1.6089e+00,  5.2303e+00,  2.7037e+00,  1.1437e+01],
        [ 2.4092e+00,  2.3466e+00,  3.1749e+00,  4.7389e+00,  1.4796e+00,
          4.0645e+00,  4.3717e-01,  3.7633e+00,  2.4378e+00,  5.1463e+00],
        [ 2.9657e+00,  1.9680e+00,  4.9938e+00,  2.0152e+00,  5.0274e+00,
          1.0372e+01,  2.3406e+00,  4.5921e+00,  2.5287e+00,  1.1962e+01],
        [ 9.9360e-01,  2.8139e+00,  4.4274e+00,  4.0010e+00,  4.0218e+00,
          2.9971e+00,  2.9780e+00,  1.7462e+00,  3.2108e+00,  6.5915e+00],
        [ 2.0912e+00,  3.0938e+00,  4.2010e+00,  4.0979e+00,  3.1748e+00,
          3.1397e+00,  2.1953e+00,  3.4810e+00,  3.4843e+00,  5.0422e+00],
        [ 9.0708e-01,  2.1028e+00,  3.8487e+00,  4.9650e+00,  1.5964e+00,
          1.2887e+00,  1.4710e+00,  2.5548e+00,  2.7485e+00,  4.8925e+00],
        [ 3.9220e+00,  3.0327e+00,  9.9923e-01,  4.9932e+00,  4.2979e-02,
          3.9924e+00, -1.4696e+00,  4.1899e+00,  1.9725e+00,  1.0117e+00],
        [-5.1639e-01,  2.2394e+00,  3.5183e+00,  4.6464e+00,  1.2360e+00,
         -3.5196e+00,  2.3021e+00,  9.0593e-01,  3.1064e+00,  1.1263e+00],
        [ 1.6037e+00,  5.1307e+00, -8.8829e-01,  3.0027e+00,  4.9017e+00,
          1.0025e+00,  2.0058e+00, -3.8608e+00,  1.9919e+00, -2.1546e+00],
        [ 2.9648e+00,  2.4034e+00,  1.2029e+00, -7.7679e+00,  4.9274e+00,
          1.0164e+00,  3.9814e+00,  3.9833e+00,  3.0510e+00, -5.3062e+00],
        [ 9.9679e-01,  4.1864e+00,  4.2270e+00, -4.6136e+00,  8.7020e+00,
         -2.4003e-01,  7.5830e+00,  1.0008e+00,  5.0024e+00, -6.6820e-01],
        [ 2.2728e+00,  3.6244e+00,  4.1272e+00,  2.2280e+00,  5.0801e+00,
          4.0399e+00,  3.3965e+00,  2.7825e+00,  3.7393e+00,  4.8698e+00],
        [ 1.6791e+00,  3.3230e+00,  1.9598e+00,  1.0041e-01,  4.8143e+00,
          2.2202e+00,  3.1183e+00,  5.4728e-01,  2.7286e+00,  1.0427e+00],
        [ 3.4507e+00,  1.9917e+00,  4.0081e+00,  4.7036e+00,  3.0002e+00,
          1.0496e+01,  2.8058e-01,  4.6939e+00,  1.8953e+00,  1.1558e+01],
        [ 1.5679e+00,  2.5501e+00,  2.5804e+00,  3.3099e+00,  1.7224e+00,
          7.7095e-01,  1.3122e+00,  2.4241e+00,  2.6655e+00,  1.5801e+00],
        [ 7.8105e-01,  1.4697e+00,  4.6599e+00,  3.0228e+00,  1.8672e+00,
          1.1596e+00,  2.2261e+00,  3.7987e+00,  3.0326e+00,  5.1036e+00],
        [ 3.7187e+00,  3.0509e+00,  2.2057e+00,  7.4038e-01,  2.7456e+00,
          4.1141e+00,  1.2110e+00,  4.7131e+00,  2.9046e+00,  9.1481e-01],
        [ 1.7544e+00,  4.5809e+00,  3.3347e+00,  4.7582e+00,  4.2718e+00,
          9.5751e-01,  2.9658e+00,  1.0462e+00,  3.9560e+00,  2.1825e+00],
        [ 2.8734e+00,  4.2801e+00,  4.8296e+00,  2.8850e+00,  4.4548e+00,
          2.1835e+00,  3.4971e+00,  4.6453e+00,  4.8704e+00,  2.7518e+00],
        [ 1.9752e+00,  3.5589e+00,  2.0709e+00,  2.9926e+00,  3.5946e+00,
          2.4313e+00,  1.9568e+00,  9.7326e-01,  2.7168e+00,  1.9824e+00],
        [ 1.1651e+00,  2.4674e+00,  2.7450e+00,  4.1450e+00,  2.2433e+00,
          1.9527e+00,  1.4024e+00,  1.3823e+00,  2.3369e+00,  3.8748e+00],
        [ 3.2635e+00,  4.4776e+00,  1.8077e+00,  2.3946e+00,  4.9019e+00,
          4.8625e+00,  2.1158e+00,  1.4241e+00,  2.9863e+00,  2.1902e+00],
        [ 3.7890e+00,  7.9927e+00,  1.9485e+00,  2.8839e+00,  7.8015e+00,
          1.0679e+00,  4.6564e+00, -6.0809e-02,  5.5080e+00, -3.2856e+00],
        [-4.0094e+00,  9.9961e-01,  3.7105e+00,  6.7202e+00,  1.0018e+00,
         -6.3401e+00,  2.9366e+00, -3.7277e+00,  1.9999e+00,  3.9998e+00],
        [ 4.9758e+00,  5.6941e+00,  1.3000e+00,  3.4613e+00,  3.1975e+00,
          2.6950e+00,  9.7137e-01,  3.9934e+00,  4.0431e+00, -2.8305e+00],
        [-1.2464e+00, -6.5883e+00,  1.1624e+00, -2.1746e+01,  4.2800e+00,
          5.0436e+00,  4.9288e+00,  3.9156e+00, -2.0051e+00,  1.9364e+00],
        [ 1.7446e+00,  2.9185e+00,  1.7926e+00,  9.9024e-01,  3.9916e+00,
          2.9798e+00,  2.2638e+00,  7.4184e-01,  2.2586e+00,  2.0701e+00],
        [ 3.9972e+00,  6.4872e+00,  2.9988e+00,  1.2683e+01,  8.3564e-01,
          1.0029e+00, -5.6647e-01,  3.3638e+00,  4.6541e+00,  1.3542e+00],
        [ 3.6938e+00,  5.4303e+00,  4.3394e+00,  1.9919e+00,  5.0434e+00,
          9.9244e-01,  3.9476e+00,  5.0027e+00,  5.6507e+00, -7.1759e-01],
        [ 3.2622e+00,  5.0049e+00,  9.9177e-01,  3.6759e+00,  5.8119e+00,
          6.9085e+00,  1.8074e+00, -7.1690e-01,  2.3350e+00,  4.0045e+00]],
       grad_fn=&lt;MmBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now use matrix factorization to predict the ratings</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a class for the model</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MatrixFactorization(nn.Module):</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n_users, n_movies, n_factors<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.user_factors <span class="op">=</span> nn.Embedding(n_users, n_factors)</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.movie_factors <span class="op">=</span> nn.Embedding(n_movies, n_factors)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, user, movie):</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="va">self</span>.user_factors(user) <span class="op">*</span> <span class="va">self</span>.movie_factors(movie)).<span class="bu">sum</span>(<span class="dv">1</span>)      </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> MatrixFactorization(n_users, n_movies, <span class="dv">2</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>MatrixFactorization(
  (user_factors): Embedding(100, 2)
  (movie_factors): Embedding(10, 2)
)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>model(torch.tensor([<span class="dv">0</span>]), torch.tensor([<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>tensor([0.7200], grad_fn=&lt;SumBackward1&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>D[<span class="dv">0</span>, <span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>tensor(4.)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(D)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<pre><code>torch.Tensor</code></pre>
</div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> <span class="op">~</span>torch.isnan(D)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the indices of the non-NaN values</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>i, j <span class="op">=</span> torch.where(mask)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the values of the non-NaN values</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> D[mask]</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Store in PyTorch tensors</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>users <span class="op">=</span> i.to(torch.int64)</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>movies <span class="op">=</span> j.to(torch.int64)</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> v.to(torch.float32)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">'user'</span>: users, <span class="st">'movie'</span>: movies, <span class="st">'rating'</span>: ratings})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>user</th>
      <th>movie</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>3</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>4</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>5</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>7</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>475</th>
      <td>99</td>
      <td>3</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>476</th>
      <td>99</td>
      <td>4</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>477</th>
      <td>99</td>
      <td>5</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>478</th>
      <td>99</td>
      <td>6</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>479</th>
      <td>99</td>
      <td>8</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
<p>480 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the Matrix Factorization model</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> MatrixFactorization(n_users, n_movies, <span class="dv">4</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the loss</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> model(users, movies)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> F.mse_loss(pred, ratings)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Zero the gradients</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Backpropagate</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the parameters</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the loss</span></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>14.76720142364502
5.302879810333252
1.1853851079940796
0.8891506195068359
0.7703914642333984
0.6836224794387817
0.6128221154212952
0.5464457869529724
0.4790089726448059
0.4133472144603729</code></pre>
</div>
</div>
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>model(users, movies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<pre><code>tensor([3.5504, 4.5726, 2.0893, 2.4884, 1.2936, 2.9384, 2.1470, 2.1019, 3.5093,
        4.2946, 4.8612, 4.9779, 0.7723, 2.4426, 4.9019, 2.7154, 4.6238, 4.5157,
        3.9727, 3.1138, 4.8520, 4.0885, 3.1867, 3.5673, 4.2483, 4.7854, 1.5278,
        1.8672, 4.9511, 3.6045, 4.0314, 3.9938, 4.2236, 2.8767, 3.1728, 1.5280,
        2.2486, 1.5754, 4.0558, 4.6967, 2.4291, 2.3517, 2.8293, 1.9220, 0.9125,
        2.4512, 1.9802, 1.6365, 0.8372, 3.9049, 5.2756, 4.9593, 3.9328, 2.9037,
        3.1141, 5.3814, 2.1344, 2.6688, 3.4172, 2.3595, 5.3566, 2.2460, 2.8877,
        1.1667, 2.3674, 4.3707, 4.4671, 1.6232, 2.4872, 0.9337, 0.9816, 5.0356,
        3.9339, 2.0467, 4.0377, 0.9808, 3.9774, 0.9072, 4.0687, 3.5003, 3.4486,
        2.3463, 1.1872, 3.4819, 2.4824, 1.8702, 2.5937, 3.0414, 3.1106, 1.0834,
        0.7252, 4.9046, 1.6202, 2.4190, 1.8594, 3.1568, 1.8595, 2.2732, 2.4453,
        4.7729, 4.4842, 0.7743, 3.3701, 4.0804, 1.6852, 2.0471, 3.1755, 1.9141,
        5.1160, 2.9357, 3.9531, 0.9427, 4.9578, 2.9373, 2.1836, 1.9240, 4.4972,
        1.4154, 4.5825, 3.6304, 4.9335, 2.0749, 1.7073, 4.5244, 0.6666, 2.7636,
        3.1754, 4.6945, 2.2122, 4.2737, 3.8038, 2.1844, 1.1224, 4.6357, 1.5525,
        1.7303, 5.2041, 2.9134, 1.4150, 2.5948, 3.0763, 4.0576, 1.0618, 4.8325,
        2.1248, 1.1957, 0.8336, 2.7950, 1.9650, 0.9979, 3.0467, 3.4920, 1.8927,
        3.9347, 4.4920, 3.7236, 2.5417, 3.5688, 1.8157, 5.0774, 3.3736, 4.3310,
        4.1089, 3.1310, 3.1309, 3.6488, 1.5450, 4.5918, 3.0997, 3.6214, 3.4861,
        1.5617, 1.8908, 5.0735, 1.0031, 1.2261, 3.8872, 1.8437, 1.5890, 4.8111,
        4.6179, 4.7851, 3.6651, 3.3427, 3.9875, 2.0088, 3.9784, 3.9879, 4.6589,
        1.5484, 1.6383, 2.2056, 2.2131, 2.1536, 2.7818, 3.1034, 1.9198, 5.0519,
        3.9291, 3.1162, 1.7061, 4.9571, 2.2661, 1.9295, 1.0611, 5.2397, 4.2658,
        2.6563, 3.1615, 4.7674, 3.9496, 1.2654, 2.2939, 4.4160, 4.0951, 5.0589,
        2.1283, 4.8196, 0.9184, 1.1921, 0.8478, 1.4660, 2.9261, 0.6669, 2.8499,
        3.0275, 2.2024, 1.6987, 2.3080, 1.1716, 5.1204, 3.2879, 4.8894, 2.8906,
        2.7831, 3.9280, 4.1422, 4.8829, 1.7140, 3.2438, 3.3947, 4.9017, 2.0458,
        2.7026, 4.9444, 1.6571, 4.5633, 2.0250, 1.5407, 2.2006, 4.2746, 5.2480,
        1.4201, 1.7007, 4.3778, 2.2966, 3.9923, 1.9333, 3.4057, 4.0327, 3.5390,
        3.9271, 2.9201, 2.7027, 3.3297, 3.0168, 3.0481, 5.1035, 1.8360, 3.9833,
        5.0582, 2.9292, 1.0382, 4.0508, 3.8930, 4.0067, 4.8149, 2.3026, 1.7069,
        3.4267, 3.1120, 3.6164, 2.3082, 1.9987, 0.6232, 1.3492, 2.3994, 2.7838,
        4.6602, 5.0888, 3.9673, 4.9551, 2.0347, 1.9640, 2.9836, 0.9779, 2.0205,
        2.0087, 1.7446, 2.7367, 3.7122, 3.4894, 1.6120, 1.1975, 1.4710, 3.9296,
        3.9017, 2.2767, 2.3583, 3.4504, 2.5856, 3.6031, 1.2024, 3.0122, 5.1747,
        4.5718, 3.8806, 3.2524, 5.3072, 4.7787, 3.7848, 3.5267, 1.6829, 5.0166,
        1.9989, 2.9831, 4.7302, 3.1548, 2.7528, 3.1149, 4.3910, 1.0141, 3.9930,
        0.9875, 0.9372, 3.0393, 3.0338, 1.8012, 1.3336, 4.6768, 3.6524, 2.4870,
        4.3179, 3.0068, 3.9975, 1.0024, 3.1920, 2.1036, 2.4352, 3.3581, 1.4066,
        4.5507, 5.2796, 4.4308, 3.1042, 3.2778, 1.9613, 4.6138, 4.9244, 2.5226,
        4.9642, 4.7832, 1.7949, 3.0818, 5.2887, 1.0500, 3.8949, 1.2380, 4.7658,
        5.2319, 1.2119, 4.4511, 4.9884, 2.0136, 5.0272, 1.8745, 3.6636, 3.9354,
        3.5262, 3.8342, 3.0293, 5.0180, 1.9718, 1.0241, 0.8656, 1.3043, 2.8483,
        3.4284, 2.0108, 3.6046, 2.7003, 2.3305, 3.7959, 2.9962, 3.9723, 1.0880,
        0.9551, 1.8982, 5.0531, 2.0814, 4.6891, 4.0077, 4.0894, 5.0302, 3.6051,
        1.6802, 3.5425, 4.1980, 3.5684, 2.3596, 4.1367, 4.4500, 2.7960, 1.9353,
        0.4775, 2.1907, 2.0642, 0.9823, 1.0218, 1.8203, 2.1463, 1.0953, 3.8434,
        0.4024, 4.7627, 4.9139, 3.1105, 2.5272, 2.4698, 1.0022, 4.0023, 1.0069,
        1.9934, 2.0410, 4.0398, 5.1972, 3.4594, 3.5575, 5.0009, 2.9782, 4.9950,
        4.4440, 4.0633, 4.4900, 2.1110, 2.1829, 3.1008, 4.4881, 3.7592, 1.9632,
        3.0318, 5.0554, 1.9397, 5.0368, 3.6756, 2.9673, 3.3422, 3.5383, 3.0946,
        3.8896, 3.3948, 4.0218, 4.9802, 2.3230, 5.1215, 3.2226, 2.2078, 3.0848,
        0.5148, 4.5484, 3.6065, 4.3127, 2.7101, 2.3162, 4.0013, 4.6726, 3.9981,
        0.9850, 4.5959, 4.6673], grad_fn=&lt;SumBackward1&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let's predict the ratings for our df dataframe</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> torch.from_numpy(df.values)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>D.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<pre><code>torch.Size([45, 10])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> <span class="op">~</span>torch.isnan(D)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the indices of the non-NaN values</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>i, j <span class="op">=</span> torch.where(mask)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the values of the non-NaN values</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> D[mask]</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Store in PyTorch tensors</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>users <span class="op">=</span> i.to(torch.int64)</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>movies <span class="op">=</span> j.to(torch.int64)</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> v.to(torch.float32)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">'user'</span>: users, <span class="st">'movie'</span>: movies, <span class="st">'rating'</span>: ratings})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="119">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>user</th>
      <th>movie</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>2</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>3</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>4</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>371</th>
      <td>44</td>
      <td>3</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>372</th>
      <td>44</td>
      <td>4</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>373</th>
      <td>44</td>
      <td>5</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>374</th>
      <td>44</td>
      <td>6</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>375</th>
      <td>44</td>
      <td>7</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
<p>376 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the Matrix Factorization model</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>n_users <span class="op">=</span> D.shape[<span class="dv">0</span>]</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>n_movies <span class="op">=</span> D.shape[<span class="dv">1</span>]</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> MatrixFactorization(n_users, n_movies, <span class="dv">4</span>)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the loss</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> model(users, movies)</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> F.mse_loss(pred, ratings)</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Zero the gradients</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Backpropagate</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the parameters</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the loss</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>21.0886173248291
4.061213493347168
0.7133367657661438
0.4743851125240326
0.38834860920906067
0.3376193344593048
0.3069866895675659
0.2862914800643921
0.27032995223999023
0.2577725350856781</code></pre>
</div>
</div>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let us predict the ratings for any user and movie from df for which we already have the ratings</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>username <span class="op">=</span> <span class="st">'Dhruv'</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>movie <span class="op">=</span> <span class="st">'The Dark Knight'</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the user and movie indices</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>user_idx <span class="op">=</span> df.index.get_loc(username)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>movie_idx <span class="op">=</span> df.columns.get_loc(movie)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the rating</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model(torch.tensor([user_idx]), torch.tensor([movie_idx]))</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>pred.item(), df.loc[username, movie]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="140">
<pre><code>(5.302472114562988, 5.0)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>df.loc[username]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="141">
<pre><code>Sholay                      NaN
Swades (We The People)      NaN
The Matrix (I)              5.0
Interstellar                5.0
Dangal                      3.0
Taare Zameen Par            NaN
Shawshank Redemption        5.0
The Dark Knight             5.0
Notting Hill                4.0
Uri: The Surgical Strike    5.0
Name: Dhruv, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let us predict the ratings for any user and movie from df for which we do not have the ratings</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>username <span class="op">=</span> <span class="st">'Dhruv'</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>movie <span class="op">=</span> <span class="st">'Sholay'</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the user and movie indices</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>user_idx <span class="op">=</span> df.index.get_loc(username)</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>movie_idx <span class="op">=</span> df.columns.get_loc(movie)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the rating</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model(torch.tensor([user_idx]), torch.tensor([movie_idx]))</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>pred, df.loc[username, movie]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="142">
<pre><code>(tensor([4.1941], grad_fn=&lt;SumBackward1&gt;), nan)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the matrix</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    completed_matrix <span class="op">=</span> pd.DataFrame(model.user_factors.weight <span class="op">@</span> model.movie_factors.weight.t(), index<span class="op">=</span>df.index, columns<span class="op">=</span>df.columns)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># round to nearest integer</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    completed_matrix <span class="op">=</span> completed_matrix.<span class="bu">round</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>completed_matrix.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="144">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
    <tr>
      <th>Your name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Nipun</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Gautam Vashishtha</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Eshan Gujarathi</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Sai Krishna Avula</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Ankit Yadav</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="145">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
    <tr>
      <th>Your name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Nipun</th>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Gautam Vashishtha</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Eshan Gujarathi</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Sai Krishna Avula</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Ankit Yadav</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>